<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>http://xuanguofeng.com</id>
    <title>å¼€é£æœºçš„è€èˆ’å…‹</title>
    <updated>2019-12-28T07:10:02.509Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="http://xuanguofeng.com"/>
    <link rel="self" href="http://xuanguofeng.com/atom.xml"/>
    <subtitle>Follow your heart</subtitle>
    <logo>http://xuanguofeng.com/images/avatar.png</logo>
    <icon>http://xuanguofeng.com/favicon.ico</icon>
    <rights>All rights reserved 2019, å¼€é£æœºçš„è€èˆ’å…‹</rights>
    <entry>
        <title type="html"><![CDATA[æ€æ­»ä¸€åªçŸ¥æ›´é¸Ÿè¯»ä¹¦æ„Ÿæ‚Ÿ]]></title>
        <id>http://xuanguofeng.com/post/ssyzzgn</id>
        <link href="http://xuanguofeng.com/post/ssyzzgn">
        </link>
        <updated>2019-12-18T11:46:28.000Z</updated>
        <summary type="html"><![CDATA[<p>æœ€è¿‘åœ¨é—²æš‡æ—¶é—´è¯»äº†ç¾å›½ä½œå®¶å“ˆç€Â·æçš„æˆåä½œã€Šæ€æ­»ä¸€åªçŸ¥æ›´é¸Ÿã€‹ï¼Œè¿™æ˜¯ä¸€æœ¬è¶Šè¯»è¶Šèƒ½æ„Ÿå—åˆ°å¾ˆæ£’çš„ä½œå“ã€‚è¿™ä¸ªæ•…äº‹è®²çš„æ˜¯ä¸€äº›å…³äºç§æ—æ­§è§†çš„ï¼Œæ•…äº‹å‘ç”Ÿçš„æ—¶æœŸè™½ç„¶å·²ç»è·ç¦»å—åŒ—æˆ˜äº‰å¾ˆä¹…äº†ï¼Œä½†é‚£æ—¶å€™ä»ç„¶æœ‰ä¸€éƒ¨åˆ†äººæŠŠé»‘äººç§°ä¸º&quot;é»‘é¬¼&quot;ã€‚å…¶å®æˆ‘åœ¨æœ¬ä¹¦æ›´å¤šè¯»åˆ°çš„æ˜¯å…³äºæ•™å…»ã€æ¶µå…»ä¸å‹‡æ•¢ï¼Œæˆ‘æœ€å–œæ¬¢æ–‡ä¸­å¥³ä¸»äººå…¬çš„çˆ¶äº²-é˜¿è¿ªå…‹æ–¯ï¼Œåœ¨ä»–èº«ä¸Šæœ‰ç€ä¼˜ç§€çš„å“è´¨ä¸å‹‡æ•¢ï¼Œå¯¹äºå­©å­çš„å½±å“ä¹Ÿå¾ˆå¤§ï¼Œè¿™æ‰æ˜¯çœŸæ­£ä½“ä¼šåˆ°çˆ¶æ¯æ˜¯å­©å­æœ€å¥½çš„è€å¸ˆã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨é—²æš‡æ—¶é—´è¯»äº†ç¾å›½ä½œå®¶å“ˆç€Â·æçš„æˆåä½œã€Šæ€æ­»ä¸€åªçŸ¥æ›´é¸Ÿã€‹ï¼Œè¿™æ˜¯ä¸€æœ¬è¶Šè¯»è¶Šèƒ½æ„Ÿå—åˆ°å¾ˆæ£’çš„ä½œå“ã€‚è¿™ä¸ªæ•…äº‹è®²çš„æ˜¯ä¸€äº›å…³äºç§æ—æ­§è§†çš„ï¼Œæ•…äº‹å‘ç”Ÿçš„æ—¶æœŸè™½ç„¶å·²ç»è·ç¦»å—åŒ—æˆ˜äº‰å¾ˆä¹…äº†ï¼Œä½†é‚£æ—¶å€™ä»ç„¶æœ‰ä¸€éƒ¨åˆ†äººæŠŠé»‘äººç§°ä¸º&quot;é»‘é¬¼&quot;ã€‚å…¶å®æˆ‘åœ¨æœ¬ä¹¦æ›´å¤šè¯»åˆ°çš„æ˜¯å…³äºæ•™å…»ã€æ¶µå…»ä¸å‹‡æ•¢ï¼Œæˆ‘æœ€å–œæ¬¢æ–‡ä¸­å¥³ä¸»äººå…¬çš„çˆ¶äº²-é˜¿è¿ªå…‹æ–¯ï¼Œåœ¨ä»–èº«ä¸Šæœ‰ç€ä¼˜ç§€çš„å“è´¨ä¸å‹‡æ•¢ï¼Œå¯¹äºå­©å­çš„å½±å“ä¹Ÿå¾ˆå¤§ï¼Œè¿™æ‰æ˜¯çœŸæ­£ä½“ä¼šåˆ°çˆ¶æ¯æ˜¯å­©å­æœ€å¥½çš„è€å¸ˆã€‚</p>
<!-- more -->
<p>å°è¯´ä¸»è¦æ˜¯é€šè¿‡ä¸€ä¸ª5å²çš„å°å¥³å­©å™è¿°çš„ï¼Œè¿™ä¸ªå°å¥³å­©å«æ–¯åº“ç‰¹ï¼Œæˆ‘è§‰å¾—å†™çš„å¾ˆå¥½çš„åœ°æ–¹å°±åœ¨äºå¾ˆå¤šåœ°æ–¹å¾ˆå·§å¦™ï¼Œä¹Ÿç•™ç»™è¯»è€…æ€è€ƒçš„ç©ºé—´ï¼Œæ˜¯ä¸€ä¸ªå°å¥³å­©å¯¹å½“æ—¶äº‹ç‰©çš„çœ‹æ³•ï¼Œæœ‰æ—¶å€™çœŸçš„å¾ˆæ„Ÿå¹5å²çš„æ—¶å€™å¯ä»¥æœ‰è¿™äº›ç¨€å¥‡å¤æ€ªçš„æƒ³æ³•ï¼Œå¥½åƒè‡ªå·±åœ¨5å²çš„æ—¶å€™ä»€ä¹ˆéƒ½ä¸ä¼šæƒ³ã€‚æ•…äº‹è®²è¿°çš„æ˜¯ä¸€åä½œä¸ºå¾‹å¸ˆçš„çˆ¶äº²ï¼Œåœ¨æ¥å—äº†ä¸ºä¸€åé»‘äººè¾©æŠ¤çš„æ¡ˆä»¶ä¸­ä¸æ–­ç»å†èº«è¾¹çš„äººçš„ä¸€äº›ä¸å¥½çš„çœ‹æ³•ï¼Œç”šè‡³å­©å­ä¹Ÿå› æ­¤å—åˆ°åŒå­¦çš„å†·çœ¼ç›¸å¯¹ï¼Œä½†æ˜¯çˆ¶äº²å§‹ç»ˆè¡¨ç°çš„å¾ˆç»…å£«ï¼Œå¹¶ä¸”å‹‡æ•¢æ·¡ç„¶çš„é¢å¯¹ã€‚</p>
<p>å…³äºçˆ¶äº²çš„æ¶µå…»ï¼Œæˆ‘è§‰å¾—ä¸€ä¸ªäººå¦‚æœæ˜¯å¾ˆæœ‰æ¶µå…»æ˜¯ä¼šå½±å“èº«è¾¹çš„å®¶äººçš„ã€‚å°è¯´ä¸­çš„æ–¯åº“ç‰¹è¿˜æœ‰ä¸€ä¸ªå“¥å“¥ï¼Œå¥¹ä»¬å®¶é‡Œè¿˜æœ‰ä¸€ä¸ªé»‘äººå®¶åº­ä¿å§†åå«å¡æ³¢å¦®ï¼Œåœ¨å¥¹ä»¬å®¶é‡Œçš„ç›¸å¤„çš„éå¸¸èæ´½ï¼Œå¥¹ä»¬ä¸€å®¶äººå®Œå…¨ä¿¡ä»»å¡æ³¢å¦®ï¼Œå¡æ³¢å¦®ä¹Ÿå®Œå…¨è§‰å¾—è‡ªå·±æ˜¯å®¶é‡Œçš„ä¸€ä»½å­ï¼Œæ‚‰å¿ƒç…§æ–™ï¼ŒæŠŠå®¶é‡Œçš„ä¸€åˆ‡æ­ç†å¥½ä¹‹ä½™ï¼Œåœ¨ä¸¤ä¸ªå­©å­çš„æ•™è‚²ä¸Šä¹Ÿéƒ½èƒ½æœ‰æ­£ç¡®çš„å¼•å¯¼ã€‚ä¾‹å¦‚æ–‡ä¸­å†™åˆ°ï¼Œå°å¥³å­©å«åŒå­¦å»å®¶é‡Œåƒé¥­ï¼Œåœ¨å®¶é‡Œåƒé¥­å‰å’Œè¿™ä¸ªåŒå­¦æ‰“äº†ä¸€æ¶ï¼Œç„¶åå½“è¿™ä¸ªåŒå­¦åƒäº†ä¸€ç½ç³–æµ†åï¼Œå¼€å§‹æŠ±æ€¨åŒå­¦ï¼Œç„¶åå¡æ³¢å¦®æŠŠæ–¯åº“ç‰¹å«åˆ°å¨æˆ¿å¹¶å¯¹å¥¹è¯´ï¼šâ€œæœ‰äº›äººä¸åƒæˆ‘ä»¬è¿™æ ·åƒé¥­ï¼Œå¯æ˜¯ä½ ä¸èƒ½åœ¨é¥­æ¡Œä¸Šç»™äººå®¶å½“é¢æŒ‡å‡ºæ¥ã€‚é‚£å­©å­æ˜¯ä½ çš„å®¢äººï¼Œå°±ç®—ä»–è¦åƒæ¡Œå¸ƒï¼Œä½ ä¹Ÿè¦éšä»–ä¾¿ã€‚â€ç„¶åæ–¯åº“ç‰¹è¯´ï¼šâ€œä»–ä¸æ˜¯å®¢äººï¼Œä»–åªæ˜¯ä¸€ä¸ªåå®å®‰å®¶çš„äººâ€ï¼Œç„¶åå¡æ³¢å¦®ç”Ÿæ°”çš„æ‰“æ–­åˆ°â€œä½ ç»™æˆ‘é—­å˜´ï¼ä¸ç®¡ä»–æ˜¯è°ï¼Œåªè¦è¸è¿›è¿™å®¶é—¨ï¼Œå°±æ˜¯ä½ çš„å®¢äººã€‚åˆ«å†è®©æˆ‘é€®åˆ°ä½ åˆå¯¹äººå®¶è¯´ä¸‰é“å››ï¼Œå¥½åƒä½ æœ‰å¤šé«˜è´µä¼¼çš„ï¼ä½ ä»¬å®¶äººä¹Ÿè®¸æ¯”åå®å®‰å®¶çš„äººè¦å¥½ï¼Œå¯æ˜¯ä½ è¿™æ ·ç¾è¾±äººå®¶ï¼Œå°±æ˜¯ä¸€é’±ä¸å€¼ï¼â€ã€‚æ‰€ä»¥æˆ‘è§‰å¾—å­©å­èƒ½æ˜äº‹ç†ï¼Œæ˜¯ç¦»ä¸å¼€èº«è¾¹çš„æ•™è‚²ä¸å½±å“çš„ï¼Œåœ¨åé¢è¿˜æœ‰ä¸¤ä¸ªæ®µè½è®©æˆ‘å¾ˆæ·±åˆ»ï¼Œä¸€ä¸ªæ˜¯åœ¨å¡æ³¢å¦®ç»™å¥¹ç©¿äº†ä¸€ä»¶å¹²å‡€æ•´æ´çš„è¡£æœçš„æ—¶å€™ï¼Œå¥¹åœ¨åšäº‹çš„æ—¶å€™å°å¿ƒç¿¼ç¿¼çš„æ€•å¼„è„äº†è¡£æœï¼Œå› ä¸ºé‚£æ ·å¡æ³¢å¦®å°±ä¼šé‡æ–°åœ¨æ´—çƒ«ä¸€éï¼Œè€Œä¸”é‚£æ—¶å€™å¡æ³¢å¦®å·²ç»å¤Ÿå¿™äº†ã€‚è¿˜æœ‰ä¸€æ®µæ˜¯åœ¨çˆ¶äº²åšäº†é»‘äººçš„è¾©æŠ¤å¾‹å¸ˆåï¼Œæ–¯åº“ç‰¹åˆ°å­¦æ ¡è¢«åŒå­¦å˜²ç¬‘ï¼Œå¥¹æœ¬æƒ³å¥½å¥½ä¿®ç†ä¸€é¡¿åŒå­¦ï¼Œä½†æ˜¯è®©å¥¹ä¸è¿™ä¹ˆåšçš„åŸå› æ˜¯å› ä¸ºçˆ¶äº²å‘Šè¯‰äº†å¥¹ä¸å…è®¸å› ä¸ºè¿™ä»¶äº‹å’Œåˆ«äººæ‰“æ¶ï¼Œå¥¹ç­”åº”äº†ï¼Œå¥¹æ€•è¿èƒŒç­”åº”çˆ¶äº²çš„è¯è€Œè®©çˆ¶äº²ä¼¤å¿ƒã€‚è€Œä¸”æˆ‘è®¤ä¸ºé˜¿è¿ªå…‹æ–¯æ˜¯ä¸€ä¸ªçœŸæ­£çš„å›å­ï¼Œåœ¨é‡åˆ°äº‹æƒ…ä¸ä½†æ²‰ç€å†·é™ï¼Œè¿˜æœ‰å‹‡æ•¢ä¸æ¸©æƒ…ï¼Œå¯¹ä»»ä½•äººæˆ–äº‹éƒ½å¾ˆæ¸©æš–ï¼Œä¾‹å¦‚æ™šä¸Šå¿«å›åˆ°å®¶çš„æ—¶å€™ä¼šæå‰ç†„ç­æ±½è½¦çš„å‘åŠ¨æœºæ¥æŠŠè½¦æºœå›å»ï¼Œå°±æ˜¯æ€•æ‰“æ‰°å®¶äººã€‚</p>
<p>å…³äºæ•™å…»ä»¥åŠå¯¹å­©å­çš„æ•™è‚²ä¸Šï¼Œé˜¿è¿ªå…‹æ–¯ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ¦œæ ·ï¼Œåœ¨å­©å­å»è°ƒçš®çš„å¯¹é‚»å±…åšå‡ºæ¶ä½œå‰§çš„æ—¶å€™ï¼Œä¼šå‘Šè¯‰å­©å­è¦å¦‚ä½•å°Šé‡åˆ«äººã€‚è¿˜æœ‰æ–‡ä¸­æœ€åçˆ¶äº²ä¸æƒ³ä¸ºäº†è®©å­©å­é€ƒé¿è´£ä»»è€Œéšç’çœŸç›¸æ‰€è¯´çš„è¯ï¼šâ€œä½ ä¹Ÿæœ‰å­©å­ï¼Œåªä¸è¿‡æˆ‘å¹´é¾„æ¯”ä½ å¤§ã€‚ç­‰æˆ‘çš„å­©å­é•¿å¤§æˆäººä¹‹åï¼Œå¦‚æœæˆ‘è¿˜æ´»ç€ï¼Œä¹Ÿå·²ç»æ˜¯ä¸ªè€å®¶ä¼™äº†ï¼Œå¯ç°åœ¨æˆ‘â€”â€”å¦‚æœä»–ä»¬ä¸ä¿¡ä»»æˆ‘ï¼Œä¹Ÿå°±ä¸ä¼šä¿¡ä»»ä»»ä½•äººã€‚æ°å§†å’Œæ–¯åº“ç‰¹çŸ¥é“å½“æ—¶å‘ç”Ÿäº†ä»€ä¹ˆã€‚å¦‚æœä»–ä»¬å¬è§æˆ‘åœ¨é•‡ä¸Šè®²çš„æ˜¯å¦ä¸€ä¸ªæ•…äº‹â€”â€”èµ«å…‹ï¼Œé‚£æ ·æˆ‘å°±ä¼šæ°¸è¿œå¤±å»ä»–ä»¬å•Šã€‚æˆ‘ç»å¯¹ä¸èƒ½å®¶é‡Œä¸€å¥—å¤–é¢ä¸€å¥—ã€‚â€æœ‰å¤šå°‘å®¶é•¿æ•™è‚²å­©å­çš„è¯è¿è‡ªå·±éƒ½åšä¸åˆ°ã€‚è¿˜æœ‰æ–‡ä¸­å½“å“¥å“¥æ°å§†å› ä¸ºæ³•åº­çš„ä¸å…¬å¹³åˆ¤å†³è€Œå¯¹æ–¯åº“ç‰¹å‘ç«çš„æ—¶å€™ï¼Œçˆ¶äº²å¯¹å¥³å„¿è¯´ï¼šâ€œæ°å§†åœ¨åŠªåŠ›å¿˜æ‰ä¸€äº›äº‹æƒ…ï¼Œå¯å®é™…ä¸Šåªæ˜¯æš‚æ—¶æ”¾åœ¨ä¸€è¾¹ã€‚ç­‰è¿‡ä¸€æ®µæ—¶é—´ï¼Œä»–å°±ä¼šé‡æ–°æ€è€ƒè¿™ä¸€åˆ‡ï¼ŒæŠŠäº‹æƒ…æƒ³ä¸ªæ˜ç™½ã€‚ç­‰ä»–å¯ä»¥çµå¢ƒæ€è€ƒé—®é¢˜çš„æ—¶å€™ï¼Œå°±ä¼šæ¢å¤è‡ªå·±åŸæ¥çš„æ ·å­â€ã€‚æˆ‘è§‰å¾—è¿™æ®µè¯å……åˆ†ä½“ç°äº†çˆ¶äº²æ˜¯ç†è§£å­©å­å½“æ—¶çš„å¿ƒæƒ…ï¼Œè€Œåœ¨é‡åˆ°è¿™ç§äº‹æƒ…çš„æ—¶å€™çˆ¶äº²çš„æ€åº¦ä¸æ˜¯é€ƒé¿ä¹Ÿä¸æ˜¯æ¬ºéª—è‡ªå·±ï¼Œè€Œä¸”è‡ªå·±å»åŠªåŠ›ï¼Œç„¶åæŠŠåŠªåŠ›çš„ç»“æœå‘Šè¯‰å­©å­ä»¬ï¼Œåœ¨æœ‰å¸Œæœ›çš„æ—¶å€™å°±å‘Šè¯‰å­©å­ä»¬æœ‰å¸Œæœ›ï¼Œåœ¨ä¸éœ€è¦æ‹…å¿ƒçš„æ—¶å€™å°±å‘Šè¯‰å­©å­è¿˜ä¸æ˜¯è¯¥æ‹…å¿ƒçš„æ—¶å€™ã€‚</p>
<p>æœ€åæˆ‘è¦è¯´çš„æ˜¯å…³äºå‹‡æ•¢ï¼Œæˆ‘è®¤ä¸ºæ–‡ä¸­çš„é˜¿è¿ªå…‹æ–¯ï¼Œæ˜¯ä¸æƒ³æ¥è¿™ä¸ªè¾©æŠ¤é»‘äººçš„æ¡ˆå­çš„ï¼Œä½†æ˜¯åœ¨ä»–æ¥äº†ä¹‹åï¼Œå¹¶äº†è§£çš„çœŸæƒ³ä¹‹åï¼Œåœ¨å½“æ—¶å‘¨å›´çš„éƒ¨åˆ†äººéƒ½å¯¹ä»–å†·è¨€å†·è¯­çš„æƒ…å†µä¸‹ï¼Œä»–ä¾ç„¶ä¹‰æ— åé¡¾çš„å»ç»´æŠ¤é»‘äººï¼Œå»ç»´æŠ¤æ­£ä¹‰ï¼Œå¹¶åœ¨æ¥å—åˆ°ä¸å…¬å¹³çš„åˆ¤å†³ä¸å¨èƒä¹‹åä¾ç„¶è¦ä¸Šè¯‰ï¼Œæˆ‘è§‰å¾—æ— è®ºæ˜¯èˆ†è®ºã€å¨èƒè¿˜æ˜¯å…¶ä»–å› ç´ ä¸‹éƒ½éœ€è¦å¾ˆå¤§çš„å‹‡æ°”æ¥é¢å¯¹ï¼Œè€Œä¸”å¥¹çŸ¥é“ä»–è¿™ä¹ˆåšä¼šå¸¦æ¥çš„å¯èƒ½æ˜¯å¤±è´¥ä¸åˆ«äººçš„è®®è®ºï¼Œæˆ–è€…æ˜¯æ›´å¤§çš„é£æ³¢ã€‚æ­£æ˜¯å› ä¸ºçˆ¶äº²çš„å‹‡æ•¢ï¼Œæ‰€ä»¥å­©å­ä»¬ä¹Ÿæ˜¯å‹‡æ•¢çš„ï¼Œåœ¨çˆ¶äº²é¢ä¸´å±é™©çš„æ—¶å€™å‹‡æ•¢çš„å†²å‡ºå»ç»´æŠ¤è‡ªå·±çš„çˆ¶äº²ï¼Œåœ¨çˆ¶äº²å¿™çš„æ—¶å€™ä¸è®©çˆ¶äº²æ‹…å¿ƒæ¥è‡ªå·±é¢å¯¹è¯¥é¢å¯¹çš„äº‹ã€‚</p>
<p>å…¶å®æ–‡ä¸­è¿˜æœ‰å¾ˆå¤šäººç‰©å’Œå€¼å¾—æˆ‘ä»¬æ·±æ€çš„åœ°æ–¹ï¼Œæœ¬æ–‡æ˜¯æƒ³ç»™è‡ªå·±åšä¸€ä¸ªè¯»ä¹¦ç¬”è®°ä¸æ„Ÿæ‚Ÿã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[é—®é¢˜æ—¥å¿—-RecyclerViewåœ¨notifyæ—¶ç„¦ç‚¹ä¸¢å¤±]]></title>
        <id>http://xuanguofeng.com/post/recyclerview</id>
        <link href="http://xuanguofeng.com/post/recyclerview">
        </link>
        <updated>2019-09-01T13:43:22.000Z</updated>
        <summary type="html"><![CDATA[<p>åœ¨è¿›è¡ŒTVå¼€å‘çš„æ—¶å€™ç»å¸¸éœ€è¦å¤„ç†ç„¦ç‚¹é—®é¢˜ã€‚æœ€è¿‘å‘ç°åœ¨RecyclerViewåˆ—è¡¨ä¸­å¦‚æœéœ€è¦æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨notifyDataSetChangedçš„æ—¶å€™ï¼Œä¼šå¯¼è‡´ç„¦ç‚¹ä¸¢å¤±ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>åœ¨è¿›è¡ŒTVå¼€å‘çš„æ—¶å€™ç»å¸¸éœ€è¦å¤„ç†ç„¦ç‚¹é—®é¢˜ã€‚æœ€è¿‘å‘ç°åœ¨RecyclerViewåˆ—è¡¨ä¸­å¦‚æœéœ€è¦æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨notifyDataSetChangedçš„æ—¶å€™ï¼Œä¼šå¯¼è‡´ç„¦ç‚¹ä¸¢å¤±ã€‚</p>
<!-- more -->
<h2 id="è§£å†³åŠæ³•">è§£å†³åŠæ³•</h2>
<pre><code> @Override
    public long getItemId(int position) {
        return position;
    }
</code></pre>
<p>åœ¨adapterä¸­é‡å†™getItemIdæ–¹æ³•ã€‚</p>
<pre><code>mListAdapter.setHasStableIds(true);
</code></pre>
<p>ç„¶åè°ƒç”¨adapterçš„setHasStableIdsæ–¹æ³•ä¼ å…¥trueï¼Œå°±èƒ½è§£å†³ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[EventBusæºç åˆ†æ]]></title>
        <id>http://xuanguofeng.com/post/eventbus-yuan-ma-fen-xi</id>
        <link href="http://xuanguofeng.com/post/eventbus-yuan-ma-fen-xi">
        </link>
        <updated>2019-07-21T09:50:50.000Z</updated>
        <summary type="html"><![CDATA[<p>EventBus is an open-source library for Android and Java using the publisher/subscriber pattern for loose coupling. EventBus enables central communication to decoupled classes with just a few lines of code â€“ simplifying the code, removing dependencies, and speeding up app development.</p>
]]></summary>
        <content type="html"><![CDATA[<p>EventBus is an open-source library for Android and Java using the publisher/subscriber pattern for loose coupling. EventBus enables central communication to decoupled classes with just a few lines of code â€“ simplifying the code, removing dependencies, and speeding up app development.</p>
<!-- more -->
<figure data-type="image" tabindex="1"><img src="http://xuanguofeng.com/images/EventBus-Publish-Subscribe.png" alt=""></figure>
<p>è¿™æ˜¯æ¥è‡ªå®˜ç½‘çš„ä¸€æ®µä»‹ç»ã€‚</p>
<h2 id="ä½¿ç”¨">ä½¿ç”¨</h2>
<p>å…¶å®ä½¿ç”¨å¾ˆç®€å•ï¼Œå¤§æ¦‚å°±æ˜¯å››ä¸ªæ­¥éª¤ã€‚</p>
<ul>
<li>æ­¥éª¤ä¸€ï¼šæ³¨å†Œ</li>
</ul>
<pre><code>EventBus.getDefault().register(this);
</code></pre>
<ul>
<li>æ­¥éª¤äºŒï¼šç¼–å†™æ¥æ”¶äº‹ä»¶ä»£ç </li>
</ul>
<pre><code> @Subscribe(threadMode = ThreadMode.MAIN)
    public void onEvent(String message) {
        mTextView.setText(message);
    }
</code></pre>
<ul>
<li>æ­¥éª¤ä¸‰ï¼šåœ¨éœ€è¦çš„åœ°æ–¹å‘é€äº‹ä»¶</li>
</ul>
<pre><code> EventBus.getDefault().post(&quot;è¿™æ˜¯ä¸€ä¸ªäº‹ä»¶ï¼Œå¯ä»¥æ˜¯Objectï¼Œæ¥æ”¶æ–¹å°†ä¼šæ¥æ”¶&quot;);
</code></pre>
<ul>
<li>æ­¥éª¤å››ï¼šæ³¨é”€</li>
</ul>
<pre><code>EventBus.getDefault().unregister(this);
</code></pre>
<h2 id="æºç ">æºç </h2>
<p>æ—¢ç„¶ä¸»è¦åˆ†ä¸ºäº†ä¸Šé¢çš„å››ä¸ªæ­¥éª¤ï¼Œæ‰€ä»¥æºç å¯ä»¥ä»å››ä¸ªæ­¥éª¤æ–¹é¢å…¥æ‰‹ã€‚</p>
<h3 id="åˆå§‹åŒ–">åˆå§‹åŒ–</h3>
<p>é¦–å…ˆæ‰€æœ‰çš„æµç¨‹éƒ½è¦å…ˆè°ƒç”¨EventBus.getDefault()ã€‚</p>
<pre><code>
 static volatile EventBus defaultInstance;
 
 public static EventBus getDefault() {
        if (defaultInstance == null) {
            synchronized (EventBus.class) {
                if (defaultInstance == null) {
                    defaultInstance = new EventBus();
                }
            }
        }
        return defaultInstance;
    }
</code></pre>
<p>è¿™é‡Œçœ‹åˆ°æ˜¯ä¸€ä¸ªå•ä¾‹æ¨¡å¼ï¼Œè€Œä¸”ä¹Ÿä½¿ç”¨volatileå…³é”®å­—ï¼Œä¸»è¦æ˜¯ä¿è¯å¹¶å‘æ—¶å€™çš„å¯è§æ€§ã€‚çœ‹EventBusçš„æ„é€ ä¹Ÿèƒ½å‘ç°æ˜¯ä½¿ç”¨äº†builderæ¨¡å¼æ¥åˆ›å»ºEventBusã€‚</p>
<h3 id="registeræ³¨å†Œ">registeræ³¨å†Œ</h3>
<pre><code>public void register(Object subscriber) {
        Class&lt;?&gt; subscriberClass = subscriber.getClass();
        List&lt;SubscriberMethod&gt; subscriberMethods = subscriberMethodFinder.findSubscriberMethods(subscriberClass);//æ ¹æ®å½“å‰æ³¨å†Œå¯¹è±¡æŸ¥æ‰¾è¿™ä¸ªå¯¹è±¡ç›¸å…³çš„è®¢é˜…æ–¹æ³•
        synchronized (this) {
            for (SubscriberMethod subscriberMethod : subscriberMethods) {
                subscribe(subscriber, subscriberMethod);//å¾ªç¯å°†æ³¨å†Œç±»ä¸è®¢é˜…æ–¹æ³•åˆ›å»ºè®¢é˜…å…³ç³»
            }
        }
    }
</code></pre>
<p>è¿™æ®µä»£ç å…¶å®åŒ…å«ä¸€ä¸ªé‡è¦çš„ç±»å°±æ˜¯ï¼šsubscriberMethodFinderï¼Œè®¢é˜…æ–¹æ³•çš„æŸ¥æ‰¾ç±»ï¼Œregisterçš„æ—¶å€™å…ˆæŸ¥æ‰¾è®¢é˜…æ–¹æ³•ï¼Œè¿™ä¸ªè®¢é˜…æ–¹æ³•å…¶å®å°±æ˜¯æˆ‘ä»¬åœ¨æ³¨å†Œçš„ç±»é‡Œé¢é€šè¿‡@Subscribeæ³¨è§£äº§ç”Ÿçš„æ–¹æ³•ã€‚</p>
<pre><code> List&lt;SubscriberMethod&gt; findSubscriberMethods(Class&lt;?&gt; subscriberClass) {
        List&lt;SubscriberMethod&gt; subscriberMethods = METHOD_CACHE.get(subscriberClass);//å…ˆä»ç¼“å­˜ä¸­æŸ¥æ‰¾
        if (subscriberMethods != null) {
            return subscriberMethods;//ç¼“å­˜ä¸­æœ‰çš„è¯ç›´æ¥è¿”å›
        }

        if (ignoreGeneratedIndex) {//é€šè¿‡getDefaulté»˜è®¤ä¸ºfalse
            subscriberMethods = findUsingReflection(subscriberClass);//é€šè¿‡åå°„æŸ¥æ‰¾
        } else {
            subscriberMethods = findUsingInfo(subscriberClass);//ä»indexä¸­æŸ¥æ‰¾ï¼Œè¿™é‡Œåªæœ‰é€šè¿‡å®ç°EventBusBuilderçš„addindexæ–¹æ³•æ—¶æ‰ä¼šæœ‰ï¼Œå¦åˆ™é»˜è®¤è¿˜æ˜¯ä¼šé€šè¿‡åå°„æŸ¥æ‰¾ã€‚
        }
        if (subscriberMethods.isEmpty()) {//åˆ¤æ–­å¦‚æœè®¢é˜…æ–¹æ³•ä¸ºç©ºçš„è¯å°†ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚
            throw new EventBusException(&quot;Subscriber &quot; + subscriberClass
                    + &quot; and its super classes have no public methods with the @Subscribe annotation&quot;);
        } else {//ä¸ä¸ºç©ºçš„è¯ æ·»åŠ åˆ°ç¼“å­˜ä¸­ã€‚
            METHOD_CACHE.put(subscriberClass, subscriberMethods);
            return subscriberMethods;
        }
    }
</code></pre>
<p>è¿™ä¸ªæ–¹æ³•å…¶å®ä¸»è¦æ˜¯åˆ¤æ–­æ€ä¹ˆæŸ¥æ‰¾è®¢é˜…æ–¹æ³•ï¼Œå…¶å®å¤šæ•°æƒ…å†µè¿˜æ˜¯é€šè¿‡åå°„æŸ¥æ‰¾ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„å°±æ˜¯å¦‚æœæˆ‘ä»¬æ³¨å†Œäº†ï¼Œå¦‚æœæ²¡æœ‰é€šè¿‡ @Subscribe(threadMode = ThreadMode.MAIN)è¿™ç§æ³¨è§£æ·»åŠ è®¢é˜…æ–¹æ³•ï¼Œä¼šæŠ›å‡ºEventBusExceptionå¼‚å¸¸ã€‚å¦‚ä¸‹<br>
<img src="http://xuanguofeng.com/images/evenbuserror.png" alt=""></p>
<p>æ¥ä¸‹æ¥ä¸»è¦åˆ†æä»åå°„ä¸­æŸ¥æ‰¾è®¢é˜…æ–¹æ³•</p>
<pre><code>private List&lt;SubscriberMethod&gt; findUsingReflection(Class&lt;?&gt; subscriberClass) {
				 //ä»£ç çœç•¥ä¸»è¦è°ƒç”¨ findUsingReflectionInSingleClassæ–¹æ³•ã€‚
    }
		
    private void findUsingReflectionInSingleClass(FindState findState) {
        Method[] methods;
        try {
            // This is faster than getMethods, especially when subscribers are fat classes like Activities
            methods = findState.clazz.getDeclaredMethods();
        } catch (Throwable th) {
            // Workaround for java.lang.NoClassDefFoundError, see https://github.com/greenrobot/EventBus/issues/149
            methods = findState.clazz.getMethods();
            findState.skipSuperClasses = true;
        }
				//å‰é¢ä¸»è¦æ˜¯é€šè¿‡åå°„æ ¹æ®æ³¨å†Œçš„ç±»è·å–æ–¹æ³•æ•°ç»„ã€‚
        for (Method method : methods) {//å¾ªç¯æ‰€æœ‰æ–¹æ³•
            int modifiers = method.getModifiers();//è·å–æ–¹æ³•çš„ä¿®é¥°ç¬¦
            if ((modifiers &amp; Modifier.PUBLIC) != 0 &amp;&amp; (modifiers &amp; MODIFIERS_IGNORE) == 0) {
                Class&lt;?&gt;[] parameterTypes = method.getParameterTypes();//è·å–å‚æ•°ç±»å‹
                if (parameterTypes.length == 1) {//å¦‚æœä¸€ä¸ªå‚æ•°çš„è¯ç»§ç»­ï¼Œå¦åˆ™ä¼šæŠ¥é”™
                    Subscribe subscribeAnnotation = method.getAnnotation(Subscribe.class);//è·å–å®šä¹‰çš„æ³¨è§£
                    if (subscribeAnnotation != null) {//å¦‚æœèƒ½æ­£å¸¸è·å–åˆ°æ³¨è§£
                        Class&lt;?&gt; eventType = parameterTypes[0];
                        if (findState.checkAdd(method, eventType)) {
                            ThreadMode threadMode = subscribeAnnotation.threadMode();
                            findState.subscriberMethods.add(new SubscriberMethod(method, eventType, threadMode,
                                    subscribeAnnotation.priority(), subscribeAnnotation.sticky()));//å¦‚æœæ£€æŸ¥æ­£å¸¸çš„è¯å°†ä¼šåˆ›å»ºä¸€ä¸ªSubscriberMethodæ·»åŠ åˆ°findStateé‡Œé¢çš„è®¢é˜…æ–¹æ³•é›†åˆ
                        }
                    }
                } else if (strictMethodVerification &amp;&amp; method.isAnnotationPresent(Subscribe.class)) {
                    String methodName = method.getDeclaringClass().getName() + &quot;.&quot; + method.getName();
                    throw new EventBusException(&quot;@Subscribe method &quot; + methodName +
                            &quot;must have exactly 1 parameter but has &quot; + parameterTypes.length);
                }
            } else if (strictMethodVerification &amp;&amp; method.isAnnotationPresent(Subscribe.class)) {
                String methodName = method.getDeclaringClass().getName() + &quot;.&quot; + method.getName();
                throw new EventBusException(methodName +
                        &quot; is a illegal @Subscribe method: must be public, non-static, and non-abstract&quot;);
            }
        }
    }
</code></pre>
<p>ç”±äºstrictMethodVerificationå¦‚æœé€šè¿‡getDefault()æ–¹å¼çš„è¯é»˜è®¤ä¸ºfalseæ‰€ä»¥ä¸ä¼šèµ°åé¢çš„ä»£ç ã€‚SubscriberMethodè¿™ä¸ªç±»å¾ˆæ˜æ˜¾å°±æ˜¯å¯¹åº”ä¸€ä¸ªè®¢é˜…çš„æ–¹æ³•åŒ…æ‹¬ä¸€äº›å±æ€§ã€‚</p>
<pre><code>public class SubscriberMethod {
    final Method method;//æ–¹æ³•
    final ThreadMode threadMode;//çº¿ç¨‹ç±»å‹å¯¹åº”POSTINGã€MAINã€MAIN_ORDEREDã€BACKGROUNDã€ASYNC
    final Class&lt;?&gt; eventType;//åœ¨åå°„æ—¶å€™è·å–çš„å‚æ•°ç±»å‹
    final int priority;//ä¼˜å…ˆçº§
    final boolean sticky;//æ˜¯å¦æ˜¯ç²˜æ€§äº‹ä»¶
    /** Used for efficient comparison */
    String methodString;
		//çœç•¥åé¢ä»£ç ã€‚ã€‚ã€‚
</code></pre>
<p>å†å›æ¥çœ‹registeré‡Œé¢æœ‰ä¸€ä¸ªå¾ªç¯è®¢é˜…çš„è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯subscribe()è¿™ä¸ªæ–¹æ³•ã€‚</p>
<pre><code> // Must be called in synchronized block
    private void subscribe(Object subscriber, SubscriberMethod subscriberMethod) {
        Class&lt;?&gt; eventType = subscriberMethod.eventType;
        Subscription newSubscription = new Subscription(subscriber, subscriberMethod);//Subscriptionå…¶å®å°±æ˜¯æ ¹æ®æ³¨å†Œå¯¹è±¡å’Œæ–¹æ³•åˆ›å»ºçš„ä¸€ä¸ªè®¢é˜…å…³ç³»çš„ç»´æŠ¤ç±»ï¼Œé‡Œé¢é‡å†™äº†equalså’ŒhashCodeæ–¹æ³•ã€‚
        CopyOnWriteArrayList&lt;Subscription&gt; subscriptions = subscriptionsByEventType.get(eventType);//subscriptionsByEventTypeæ˜¯ä¸€ä¸ªè®¢é˜…è€…é˜Ÿåˆ—
        if (subscriptions == null) {//é‡Œé¢æ²¡æœ‰è®¢é˜…è€…çš„è¯åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—å¹¶æ ¹æ®keyæ·»åŠ subscriptions
            subscriptions = new CopyOnWriteArrayList&lt;&gt;();
            subscriptionsByEventType.put(eventType, subscriptions);
        } else {
            if (subscriptions.contains(newSubscription)) {//å¦‚æœåŒ…å«äº†æŠ›å‡ºå¼‚å¸¸
                throw new EventBusException(&quot;Subscriber &quot; + subscriber.getClass() + &quot; already registered to event &quot;
                        + eventType);
            }
        }

        int size = subscriptions.size();
        for (int i = 0; i &lt;= size; i++) {
            if (i == size || subscriberMethod.priority &gt; subscriptions.get(i).subscriberMethod.priority) {
                subscriptions.add(i, newSubscription);//æ ¹æ®ä¼˜å…ˆçº§å°†è®¢é˜…å…³ç³»æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­
                break;
            }
        }

        List&lt;Class&lt;?&gt;&gt; subscribedEvents = typesBySubscriber.get(subscriber);//typesBySubscriberä¿å­˜çš„æ˜¯è®¢é˜…è€…ä¸è®¢é˜…è€…çš„äº‹ä»¶çš„mapï¼Œåç»­é€šè¿‡è¿™ä¸ªè§£é™¤æ³¨å†Œå’Œåˆ¤æ–­æ˜¯å¦æ³¨å†Œ
        if (subscribedEvents == null) {
            subscribedEvents = new ArrayList&lt;&gt;();
            typesBySubscriber.put(subscriber, subscribedEvents);
        }
        subscribedEvents.add(eventType);//å°†äº‹ä»¶æ·»åŠ åˆ°äº‹ä»¶é˜Ÿåˆ—ä¸­

        if (subscriberMethod.sticky) {//å¦‚æœæ˜¯ç²˜æ€§äº‹ä»¶ å°†ä¼šç«‹å³å‘é€æ‰§è¡Œ
            if (eventInheritance) {
                // Existing sticky events of all subclasses of eventType have to be considered.
                // Note: Iterating over all events may be inefficient with lots of sticky events,
                // thus data structure should be changed to allow a more efficient lookup
                // (e.g. an additional map storing sub classes of super classes: Class -&gt; List&lt;Class&gt;).
                Set&lt;Map.Entry&lt;Class&lt;?&gt;, Object&gt;&gt; entries = stickyEvents.entrySet();
                for (Map.Entry&lt;Class&lt;?&gt;, Object&gt; entry : entries) {
                    Class&lt;?&gt; candidateEventType = entry.getKey();
                    if (eventType.isAssignableFrom(candidateEventType)) {
                        Object stickyEvent = entry.getValue();
                        checkPostStickyEventToSubscription(newSubscription, stickyEvent);
                    }
                }
            } else {
                Object stickyEvent = stickyEvents.get(eventType);
                checkPostStickyEventToSubscription(newSubscription, stickyEvent);
            }
        }
    }

</code></pre>
<p>ç²˜æ€§äº‹ä»¶ä¸»è¦å°±æ˜¯å¯ä»¥å…ˆå‘é€ï¼Œç„¶ååœ¨æ³¨å†Œçš„è¯ä¹Ÿå¯ä»¥ç›´æ¥æ”¶åˆ°äº‹ä»¶ã€‚å…¶å®æ•´ä¸ªæ³¨å†Œæµç¨‹å°±æ˜¯å°†æ—¶é—´æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ï¼Œä¸è¿‡è¿™é‡Œçš„é˜Ÿåˆ—ä¹Ÿä¸æ­¢ä¸€ä¸ªã€‚è¿™é‡Œæœ‰å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„æ¦‚å¿µåé¢ä¹Ÿè¦ç”¨çš„åˆ°ã€‚</p>
<h3 id="postå‘é€äº‹ä»¶">postå‘é€äº‹ä»¶</h3>
<pre><code>  public void post(Object event) {
        PostingThreadState postingState = currentPostingThreadState.get();//é€šè¿‡ThreadLocalç»´æŠ¤ä¸€ä¸ªPostingThreadStateé‡Œé¢æœ‰å¯¹åº”çš„queue
        List&lt;Object&gt; eventQueue = postingState.eventQueue;
        eventQueue.add(event);//å°†eventäº‹ä»¶æ·»åŠ åˆ°äº‹ä»¶é˜Ÿåˆ—ä¸­

        if (!postingState.isPosting) {//isPostingé»˜è®¤ä¸ºfalse
            postingState.isMainThread = isMainThread();//åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦ä¸»çº¿ç¨‹å¹¶ä¿å­˜çŠ¶æ€
            postingState.isPosting = true;
            if (postingState.canceled) {//åˆ¤æ–­çŠ¶æ€æ˜¯å¦è¢«canceled
                throw new EventBusException(&quot;Internal error. Abort state was not reset&quot;);
            }
            try {
                while (!eventQueue.isEmpty()) {//å¾ªç¯æ¶ˆæ¯é˜Ÿåˆ—ä¸æ–­è°ƒç”¨postSingleEvent
                    postSingleEvent(eventQueue.remove(0), postingState);//è¿™é‡Œç”¨çš„æ˜¯removeä¹Ÿå°±æ˜¯è¯´äº‹ä»¶æ‰§è¡Œä¸€ä¸ªç§»é™¤ä¸€ä¸ª
                }
            } finally {
                postingState.isPosting = false;
                postingState.isMainThread = false;
            }
        }
    }
</code></pre>
<p>è¿™ä¸ªæ–¹æ³•ä¸»è¦æ˜¯åˆ›å»ºå¯¹åº”çš„PostingThreadStateï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•çš„å¯¹è±¡ï¼Œå¯ä»¥ç†è§£ä¸ºçº¿ç¨‹å‘é€çŠ¶æ€ç„¶åé‡Œé¢æœ‰ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—å’Œä¸€äº›çŠ¶æ€å€¼ã€‚PostingThreadStateæ˜¯é€šè¿‡ThreadLocalä¿å­˜çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ˜¯å’Œçº¿ç¨‹ç»‘å®šçš„ã€‚ä¸‹é¢çœ‹postSingleEventæ–¹æ³•ï¼š</p>
<pre><code>private void postSingleEvent(Object event, PostingThreadState postingState) throws Error {
        Class&lt;?&gt; eventClass = event.getClass();
        boolean subscriptionFound = false;//ä¿å­˜æ˜¯å¦èƒ½æ‰¾åˆ°è®¢é˜…å…³ç³»çš„æ ‡è®°
        if (eventInheritance) {//é»˜è®¤ä¸ºtrue æ˜¯å¦æ”¯æŒç»§æ‰¿å…³ç³»
            List&lt;Class&lt;?&gt;&gt; eventTypes = lookupAllEventTypes(eventClass);
            int countTypes = eventTypes.size();
            for (int h = 0; h &lt; countTypes; h++) {
                Class&lt;?&gt; clazz = eventTypes.get(h);
                subscriptionFound |= postSingleEventForEventType(event, postingState, clazz);//é€šè¿‡postSingleEventForEventTypeæ–¹æ³•å‘é€äº‹ä»¶
            }
        } else {//å¦‚æœfalseä¸æŸ¥æ‰¾ç»§æ‰¿å…³ç³»
            subscriptionFound = postSingleEventForEventType(event, postingState, eventClass);
        }
        if (!subscriptionFound) {
            if (logNoSubscriberMessages) {
                logger.log(Level.FINE, &quot;No subscribers registered for event &quot; + eventClass);
            }
            if (sendNoSubscriberEvent &amp;&amp; eventClass != NoSubscriberEvent.class &amp;&amp;
                    eventClass != SubscriberExceptionEvent.class) {
                post(new NoSubscriberEvent(this, event));
            }
        }
    }

</code></pre>
<pre><code>    private boolean postSingleEventForEventType(Object event, PostingThreadState postingState, Class&lt;?&gt; eventClass) {
        CopyOnWriteArrayList&lt;Subscription&gt; subscriptions;
        synchronized (this) {
            subscriptions = subscriptionsByEventType.get(eventClass);//subscriptionsByEventTypeä¹‹å‰åœ¨æ³¨å†Œçš„æ—¶å€™ä¿å­˜çš„è®¢é˜…è€…é˜Ÿåˆ—ï¼Œåœ¨è¿™é‡Œæ ¹æ®keyæŸ¥è¯¢åˆ°è¿™ä¸ªäº‹ä»¶çš„æ‰€æœ‰è®¢é˜…è€…
        }
        if (subscriptions != null &amp;&amp; !subscriptions.isEmpty()) {
            for (Subscription subscription : subscriptions) {//è¿­ä»£æ‰€æœ‰çš„è®¢é˜…è€…ç»´æŠ¤postingState
                postingState.event = event;
                postingState.subscription = subscription;
                boolean aborted = false;
                try {
                    postToSubscription(subscription, event, postingState.isMainThread);//æ ¹æ®subscriptionå’Œäº‹ä»¶ å»è¿›è¡Œçº¿ç¨‹åˆ†å‘ç„¶åè°ƒç”¨
                    aborted = postingState.canceled;
                } finally {
                    postingState.event = null;
                    postingState.subscription = null;
                    postingState.canceled = false;
                }
                if (aborted) {
                    break;
                }
            }
            return true;
        }
        return false;
    }

</code></pre>
<pre><code>private void postToSubscription(Subscription subscription, Object event, boolean isMainThread) {
        switch (subscription.subscriberMethod.threadMode) {
            case POSTING:
                invokeSubscriber(subscription, event);
                break;
            case MAIN:
                if (isMainThread) {
                    invokeSubscriber(subscription, event);
                } else {
                    mainThreadPoster.enqueue(subscription, event);
                }
                break;
            case MAIN_ORDERED:
                if (mainThreadPoster != null) {
                    mainThreadPoster.enqueue(subscription, event);
                } else {
                    // temporary: technically not correct as poster not decoupled from subscriber
                    invokeSubscriber(subscription, event);
                }
                break;
            case BACKGROUND:
                if (isMainThread) {
                    backgroundPoster.enqueue(subscription, event);
                } else {
                    invokeSubscriber(subscription, event);
                }
                break;
            case ASYNC:
                asyncPoster.enqueue(subscription, event);
                break;
            default:
                throw new IllegalStateException(&quot;Unknown thread mode: &quot; + subscription.subscriberMethod.threadMode);
        }
    }
</code></pre>
<p>ä¸Šé¢è¿™æ®µä»£ç å…¶å®å°±æ˜¯æ ¹æ®ä¹‹å‰ç»‘å®šçš„Subscriptioné‡Œçš„Methodåˆ¤æ–­çº¿ç¨‹æ¨¡å¼ï¼Œç„¶åæ ¹æ®ä¸åŒçš„æ–¹å¼å¤„ç†äº‹ä»¶ï¼Œå…¶å®è¿™å‡ ç§æ–¹å¼ä¸»è¦æ˜¯é€šè¿‡Posterçš„å®ç°ç±»ã€‚<br>
<img src="http://xuanguofeng.com/images/1566533005873.png" alt=""><br>
ä¸»è¦æ˜¯æœ‰4ç§æ–¹å¼ï¼šåå°„ç›´æ¥è°ƒç”¨ã€åœ¨ä¸»çº¿ç¨‹å‘å°„äº‹ä»¶ã€åœ¨å•ç‹¬å­çº¿ç¨‹å‘é€ã€å¼‚æ­¥å‘é€ã€‚å…¶å®æ— è®ºå“ªç§æ–¹å¼æœ€åéƒ½æ˜¯é€šè¿‡invokeSubscriber()æ–¹æ³•è¿”å›åˆ°Eventbusé€šè¿‡åå°„è°ƒç”¨ï¼Œåªä¸è¿‡é€šè¿‡Handlerã€é“¾è¡¨ã€é˜Ÿåˆ—å’Œçº¿ç¨‹æ± ç­‰æŠ€æœ¯æ‰‹æ®µå®ç°åœ¨åœ¨åå°æˆ–è€…ä¸»çº¿ç¨‹æ‰§è¡Œã€‚å…¶å®çº¿ç¨‹æ± åœ¨EventBusBuilderä¸­å·²ç»åœ¨åˆå§‹åŒ–çš„æ—¶å€™å°±åˆ›å»ºäº†ã€‚</p>
<pre><code> void invokeSubscriber(Subscription subscription, Object event) {
        try {
            subscription.subscriberMethod.method.invoke(subscription.subscriber, event);
        } catch (InvocationTargetException e) {
            handleSubscriberException(subscription, event, e.getCause());
        } catch (IllegalAccessException e) {
            throw new IllegalStateException(&quot;Unexpected exception&quot;, e);
        }
    }
</code></pre>
<p>è¿™å°±æ˜¯æœ€ç»ˆé€šè¿‡åå°„è°ƒç”¨æ–¹æ³•ã€‚</p>
<h3 id="è§£æ³¨å†Œ">è§£æ³¨å†Œ</h3>
<pre><code>  /** Unregisters the given subscriber from all event classes. */
    public synchronized void unregister(Object subscriber) {
        List&lt;Class&lt;?&gt;&gt; subscribedTypes = typesBySubscriber.get(subscriber);
        if (subscribedTypes != null) {
            for (Class&lt;?&gt; eventType : subscribedTypes) {
                unsubscribeByEventType(subscriber, eventType);
            }
            typesBySubscriber.remove(subscriber);
        } else {
            logger.log(Level.WARNING, &quot;Subscriber to unregister was not registered before: &quot; + subscriber.getClass());
        }
    }

</code></pre>
<p>å…¶å®è§£æ³¨å†Œä¸»è¦å°±æ˜¯åœ¨ä¹‹å‰åˆ†æçš„typesBySubscriberé›†åˆå’ŒsubscriptionsByEventTypeé›†åˆæ ¹æ®subscriberç§»é™¤æ‰ã€‚</p>
<h3 id="æ€»ç»“">æ€»ç»“</h3>
<p>å…¶å®æ–‡ç« ä¸­æœ‰ä¸€äº›ç»†èŠ‚æ²¡æœ‰å†™å‡ºæ¥ï¼Œä¸è¿‡ç¬”è€…å·²ç»çœ‹è¿‡äº†ï¼Œå»ºè®®è¯»è€…è‡ªå·±ä¹Ÿæƒ³æƒ³æœ‰ä»€ä¹ˆé—®é¢˜å»çœ‹çœ‹ï¼Œè¿™é‡Œåˆ†æçš„æ˜¯åŸºæœ¬æµç¨‹ã€‚</p>
<p>EventBusæ„Ÿè§‰å¯ä»¥åˆ†å¼€ä¸¤ä¸ªè¯Event Busï¼Œè€Œä¸”ä¸»è¦è¿˜æ˜¯ä»¥EventBusè¿™ç±»ä¸ºä¸»å»¶ä¼¸å‡ºæ¥çš„ä¸€äº›å¤„ç†ç±»ï¼Œæ¯”å¦‚SubscriberMethodFinderã€EventBusBuilderï¼ŒPosterç­‰ç­‰ï¼Œç„¶ååˆå›åˆ°EventBusæ¥å¤„ç†ç›¸å…³çš„é€»è¾‘ã€‚</p>
<h3 id="thanks">Thanks</h3>
<p><a href="https://juejin.im/entry/59409f178d6d810058b1d2a5">Android æ¡†æ¶å­¦ä¹ ï¼šæºç åˆ†æ EventBus 3.0 å¦‚ä½•å®ç°äº‹ä»¶æ€»çº¿</a></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[é—®é¢˜æ—¥å¿—-Frescoåº“çš„libimagepipeline.soé—®é¢˜]]></title>
        <id>http://xuanguofeng.com/post/wen-ti-ri-zhi-fresco-ku-de-libimagepipelineso-wen-ti</id>
        <link href="http://xuanguofeng.com/post/wen-ti-ri-zhi-fresco-ku-de-libimagepipelineso-wen-ti">
        </link>
        <updated>2019-07-07T12:20:14.000Z</updated>
        <summary type="html"><![CDATA[<p>ä½¿ç”¨äº†Frescoçš„å›¾ç‰‡åº“ä¼šå‘ç°åœ¨éƒ¨åˆ†æœºå‹ä¸Šä¼šæŠ¥java.lang.UnsatisfiedLinkError: couldn't find DSO to load: libimagepipeline.so caused by: dlopen failed: &quot;/data/data/cn.krcom.tv/lib-main/libimagepipeline.so&quot; is 64-bit instead of 32-bité”™è¯¯ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>ä½¿ç”¨äº†Frescoçš„å›¾ç‰‡åº“ä¼šå‘ç°åœ¨éƒ¨åˆ†æœºå‹ä¸Šä¼šæŠ¥java.lang.UnsatisfiedLinkError: couldn't find DSO to load: libimagepipeline.so caused by: dlopen failed: &quot;/data/data/cn.krcom.tv/lib-main/libimagepipeline.so&quot; is 64-bit instead of 32-bité”™è¯¯ã€‚</p>
<!-- more -->
<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<pre><code>java.lang.UnsatisfiedLinkError: couldn't find DSO to load: libimagepipeline.so caused by: dlopen failed: &quot;/data/data/cn.krcom.tv/lib-main/libimagepipeline.so&quot; is 64-bit instead of 32-bit
at com.facebook.soloader.SoLoader.initSoSources(SoLoader.java)
     doLoadLibraryBySoName(SoLoader.java)
     makeNonZipPath(SoLoader.java)
     getNativeLoadRuntimeMethod(SoLoader.java)
    at com.facebook.soloader.SoLoader.init(SoLoader.java)
     loadLibrary(SoLoader.java)
     init(SoLoader.java)
     makePrepareFlags(SoLoader.java)
     loadLibraryBySoName(SoLoader.java)
     initSoLoader(SoLoader.java)
//åé¢çš„çœç•¥äº†
</code></pre>
<h2 id="åŸå› ä¸è§£å†³">åŸå› ä¸è§£å†³</h2>
<p>é¦–å…ˆæœ‰ä¸€å¥logå¾ˆé‡è¦é‚£å°±æ˜¯â€œlibimagepipeline.so caused by: dlopen failed: &quot;/data/data/cn.krcom.tv/lib-main/libimagepipeline.so&quot; is 64-bit instead of 32-bitâ€è¿™é‡Œçš„ä¿¡æ¯èƒ½çœ‹å‡ºæ¥ä¸»è¦æ˜¯libimagepipeline.soçš„soæ–‡ä»¶å¼•èµ·çš„ã€‚</p>
<p>æ‰€ä»¥ä¸»è¦è€ƒè™‘æ˜¯cpuæŒ‡ä»¤é›†ä¸soæ–‡ä»¶çš„å…¼å®¹é—®é¢˜ã€‚å…¶å®å¤§éƒ¨åˆ†soæ˜¯ç›¸äº’å…¼å®¹çš„ï¼Œä½†æ˜¯æŸ¥çœ‹é¡¹ç›®å‘ç°é‡Œé¢åŒæ—¶æœ‰arm64-v8aæ–‡ä»¶å¤¹å’Œarmeabi-v7aï¼Œæ‰€ä»¥é€šè¿‡è§£æapkå‘ç°é‡Œé¢çš„soå¯¹åº”çš„ä¸ä¸€æ ·ã€‚æ‰€ä»¥å‘ç°åœ¨arm64-v8açš„è®¾å¤‡ä¸Šå…ˆæ‰¾åˆ°äº†é‡Œé¢çš„soï¼Œå¦‚æœæœ‰äº›ä¸‰æ–¹åº“æ”¯æŒçš„soæ–‡ä»¶å¤¹ä¸ä¸€è‡´å°±ä¼šå¯¼è‡´crashã€‚</p>
<p>æ‰€ä»¥è¦è§£å†³çš„è¯é¦–å…ˆè¦ä¿è¯æ”¯æŒçš„ç›®å½•é‡Œçš„soæ–‡ä»¶æ˜¯ä¸€æ ·çš„ã€‚æˆ–è€…å¯ä»¥åªä½¿ç”¨ä¸€ä¸ªå…¼å®¹çš„æ–‡ä»¶å¤¹ã€‚</p>
<p>å‚è€ƒæ–‡ç« ï¼š<br>
https://developer.android.com/ndk/guides/abis<br>
https://blog.csdn.net/u013531824/article/details/53931307<br>
https://www.jianshu.com/p/ad95c885c2f8</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[é—®é¢˜æ—¥å¿—-ä½ç‰ˆæœ¬Didn't find class "~FileProvider"]]></title>
        <id>http://xuanguofeng.com/post/ã€é—®é¢˜æ—¥å¿—ã€‘ä½ç‰ˆæœ¬dexæ‹†åˆ†é—®é¢˜</id>
        <link href="http://xuanguofeng.com/post/ã€é—®é¢˜æ—¥å¿—ã€‘ä½ç‰ˆæœ¬dexæ‹†åˆ†é—®é¢˜">
        </link>
        <updated>2019-06-20T03:58:40.000Z</updated>
        <summary type="html"><![CDATA[<p>ç”±äºåœ¨ä½ç‰ˆæœ¬çš„ç³»ç»Ÿä¸­ï¼Œä¼šæç¤ºDidn't find class &quot;android.support.v4.content.FileProvider&quot;é—®é¢˜ï¼Œæ‰€ä»¥æŸ¥æ‰¾äº†ä¸‹è§£å†³æ–¹æ¡ˆã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>ç”±äºåœ¨ä½ç‰ˆæœ¬çš„ç³»ç»Ÿä¸­ï¼Œä¼šæç¤ºDidn't find class &quot;android.support.v4.content.FileProvider&quot;é—®é¢˜ï¼Œæ‰€ä»¥æŸ¥æ‰¾äº†ä¸‹è§£å†³æ–¹æ¡ˆã€‚</p>
<!-- more -->
<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<ul>
<li>ç”±äºåœ¨é¡¹ç›®ä¸­ä½¿ç”¨äº†providerï¼Œå¹¶å¦‚ä¸‹é…ç½®</li>
</ul>
<pre><code>&lt;provider
	android:name=&quot;android.support.v4.content.FileProvider&quot;
	android:authorities=&quot;${applicationId}.fileprovider&quot;
	android:exported=&quot;false&quot;
	android:grantUriPermissions=&quot;true&quot;&gt;
	&lt;meta-data
	android:name=&quot;android.support.FILE_PROVIDER_PATHS&quot;
	android:resource=&quot;@xml/file_paths&quot; /&gt;
&lt;/provider&gt;

</code></pre>
<ul>
<li>è€Œä¸”ç”±äºé¡¹ç›®ä¸­çš„æ–¹æ³•æ•°å¤§äº65536ï¼Œæ‰€ä»¥è¦åœ¨defaultConfigä¸­ä½¿ç”¨å¦‚ä¸‹æ–¹å¼è¿›è¡Œå¯¹dexæ‹†åˆ†æ‰“åŒ…</li>
</ul>
<pre><code> multiDexEnabled true
</code></pre>
<p>è¿™æ ·å°±å¯èƒ½ä¼šå¯¼è‡´å¦‚ä¸‹é—®é¢˜ï¼š</p>
<pre><code>Caused by: java.lang.ClassNotFoundException: Didn't find class &quot;android.support.v4.content.FileProvider&quot; on path: DexPathList[[zip file &quot;/data/app/cn.krcom.tv.beta-1.apk&quot;],nativeLibraryDirectories=[/data/app-lib/é¡¹ç›®çš„åŒ…å-1, /system/lib]]
        at dalvik.system.BaseDexClassLoader.findClass(BaseDexClassLoader.java:56)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:497)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:457)
        at android.app.ActivityThread.installProvider(ActivityThread.java:4762)
        at android.app.ActivityThread.installContentProviders(ActivityThread.java:4369)Â 
        at android.app.ActivityThread.handleBindApplication(ActivityThread.java:4309)Â 
        at android.app.ActivityThread.access$1500(ActivityThread.java:135)Â 
        at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1256)Â 
        at android.os.Handler.dispatchMessage(Handler.java:102)Â 
        at android.os.Looper.loop(Looper.java:136)Â 
        at android.app.ActivityThread.main(ActivityThread.java:5001)Â 
        at java.lang.reflect.Method.invokeNative(Native Method)Â 
        at java.lang.reflect.Method.invoke(Method.java:515)Â 
        at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:785)Â 
        at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:601)Â 
        at dalvik.system.NativeStart.main(Native Method)Â 
</code></pre>
<!-- more -->
<h2 id="åŸå› ä¸è§£å†³æ–¹å¼">åŸå› ä¸è§£å†³æ–¹å¼</h2>
<p>äºæ˜¯å°±æŸ¥æ‰¾é—®é¢˜ï¼Œå…¶å®åŸå› åœ¨å®˜æ–¹æ–‡æ¡£çš„åˆ†åŒ…æ–¹æ³•ä¸­æ—©å·²å†™æ˜ã€‚ä¹Ÿè¯´æ˜äº†åŸå› <br>
<a href="https://developer.android.com/studio/build/multidex.html#mdex-gradle">é…ç½®æ‚¨çš„åº”ç”¨è¿›è¡Œ Dalvik å¯æ‰§è¡Œæ–‡ä»¶åˆ†åŒ…</a></p>
<p>ä¸»è¦è§£å†³åŠæ³•å°±æ˜¯</p>
<ul>
<li>å¼•å…¥multidex</li>
</ul>
<pre><code> compile 'com.android.support:multidex:1.0.3'
</code></pre>
<ul>
<li>åœ¨Applicationä¸­åˆå§‹åŒ–</li>
</ul>
<pre><code>public class MyApplication extends MultiDexApplication { ... }
</code></pre>
<p>æˆ–è€…ç›´æ¥è°ƒç”¨</p>
<pre><code>MultiDex.install(this);

</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[AsyncTaskæºç è§£æ]]></title>
        <id>http://xuanguofeng.com/post/AsyncTaskæºç è§£æ</id>
        <link href="http://xuanguofeng.com/post/AsyncTaskæºç è§£æ">
        </link>
        <updated>2019-03-15T11:19:26.000Z</updated>
        <summary type="html"><![CDATA[<p>AsyncTaskæ˜¯ç”¨æ¥åœ¨å®ç°åœ¨å­çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ååˆ‡æ¢åˆ°UIçº¿ç¨‹ï¼Œå¸¸è§çš„æ¯”å¦‚ä¸‹è½½ä»»åŠ¡çš„æ›´æ–°ï¼Œæ‰§è¡Œä¸‹è½½ååœ¨UIçº¿ç¨‹å®æ—¶æ›´æ–°è¿›åº¦æ¡ã€‚ç”±äºæ˜¯åŸºæœ¬çš„APIæ‰€ä»¥è¿˜æ˜¯å¾ˆæœ‰å¿…è¦äº†è§£æºç çš„ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>AsyncTaskæ˜¯ç”¨æ¥åœ¨å®ç°åœ¨å­çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ååˆ‡æ¢åˆ°UIçº¿ç¨‹ï¼Œå¸¸è§çš„æ¯”å¦‚ä¸‹è½½ä»»åŠ¡çš„æ›´æ–°ï¼Œæ‰§è¡Œä¸‹è½½ååœ¨UIçº¿ç¨‹å®æ—¶æ›´æ–°è¿›åº¦æ¡ã€‚ç”±äºæ˜¯åŸºæœ¬çš„APIæ‰€ä»¥è¿˜æ˜¯å¾ˆæœ‰å¿…è¦äº†è§£æºç çš„ã€‚</p>
<!-- more -->
<h2 id="ä½¿ç”¨">ä½¿ç”¨</h2>
<p>ä½¿ç”¨å…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œä¸»è¦æ˜¯å®ç°AsyncTaskç±»ï¼Œç„¶åæ‰§è¡Œexcuteæ–¹æ³•ã€‚å…¶ä¸­æœ‰3ä¸ªå‚æ•°å’Œ4ä¸ªæ–¹æ³•æ˜¯å¿…é¡»è¦æŒæ¡çš„ã€‚</p>
<pre><code>  private class MyAsyncTask extends AsyncTask&lt;String, String, String&gt; {

        @Override
        protected void onPreExecute() {
            super.onPreExecute();
        }

        @Override
        protected void onPostExecute(String s) {
            super.onPostExecute(s);
        }

        @Override
        protected void onProgressUpdate(String... values) {
            super.onProgressUpdate(values);
        }

        @Override
        protected String doInBackground(String... strings) {
            return null;
        }
    }
</code></pre>
<h3 id="onpreexecute">onPreExecute</h3>
<p>è¿™ä¸ªæ–¹æ³•æ˜¯åœ¨UIçº¿ç¨‹æ‰§è¡Œï¼Œå¹¶ä¸”åœ¨åå°ä»»åŠ¡å¼€å§‹å‰æ‰§è¡Œã€‚</p>
<h3 id="doinbackground">doInBackground</h3>
<p>è¿™ä¸ªåœ¨çº¿ç¨‹æ‰§è¡Œï¼Œè¿™é‡Œä¸»è¦æ˜¯åšè€—æ—¶ä»»åŠ¡ã€‚è¿™ä¸ªæ–¹æ³•æœ‰å‚æ•°å’Œè¿”å›å€¼ï¼Œå‚æ•°å°±æ˜¯åœ¨è°ƒç”¨executeä¼ è¿›æ¥çš„å‚æ•°ï¼Œè¿”å›å€¼å°±æ˜¯æˆ‘ä»¬ç»è¿‡ä¸€äº›åˆ—æ“ä½œåè¿”å›ç»™onProgressUpdateæ–¹æ³•çš„ï¼Œä¸»è¦ç”¨äºUIçš„æ›´æ–°ã€‚ä¾‹å¦‚æˆ‘ä¸‹è½½åˆ°50%ç„¶ååŒå¿—UIå®æ—¶æ›´æ–°ã€‚</p>
<h3 id="onprogressupdate">onProgressUpdate</h3>
<p>ä»æ–¹æ³•åçœ‹å°±æ˜¯æ›´æ–°è¿›åº¦ï¼Œè¿™ä¸ªå‚æ•°å°±æ˜¯doInBackgroundä¸­è¿”å›çš„ã€‚</p>
<h3 id="onpostexecute">onPostExecute</h3>
<p>è¿™ä¸ªæ–¹æ³•å°±æ˜¯ä»»åŠ¡æ‰§è¡Œå®Œæˆåè¦æ‰§è¡Œçš„æ–¹æ³•ã€‚å‚æ•°ä¹Ÿæ˜¯æ‰§è¡Œçš„ç»“æœã€‚</p>
<h3 id="ä¸‰ä¸ªå‚æ•°">ä¸‰ä¸ªå‚æ•°</h3>
<p>æŒæ¡äº†è¿™4ä¸ªæ–¹æ³•ï¼Œè¿™ä¸‰ä¸ªå‚æ•°å°±å¾ˆå®¹æ˜“ç†è§£äº†ã€‚</p>
<p>ç¬¬ä¸€ä¸ªï¼Œæ˜¯ä¼ å…¥çš„å‚æ•°ã€‚</p>
<p>ç¬¬äºŒä¸ªï¼Œæ˜¯æ‰§è¡Œä»»åŠ¡æ—¶è¿›åº¦æ›´æ–°çš„å€¼ã€‚</p>
<p>ç¬¬ä¸‰ä¸ªï¼Œä»»åŠ¡æ‰§è¡Œç»“æŸçš„è¿”å›å€¼ã€‚</p>
<h2 id="æºç ">æºç </h2>
<p>å…¶å®æºç æ— éå°±æ˜¯çœ‹å†…éƒ¨çš„æ ¸å¿ƒæœºåˆ¶ï¼Œå’Œè¿™å‡ ä¸ªæ–¹æ³•çš„è°ƒç”¨æµç¨‹ã€‚æœ€ç›´è§‚çš„å°±ä»executeæ–¹æ³•å¼€å§‹ã€‚</p>
<pre><code> @MainThread
    public final AsyncTask&lt;Params, Progress, Result&gt; execute(Params... params) {
        return executeOnExecutor(sDefaultExecutor, params);
    }
</code></pre>
<p>è¿™é‡Œç›´æ¥è°ƒç”¨äº†executeOnExecutorï¼Œä¼ å…¥äº†sDefaultExecutorå’Œå‚æ•°ã€‚</p>
<pre><code> @MainThread
    public final AsyncTask&lt;Params, Progress, Result&gt; executeOnExecutor(Executor exec,
            Params... params) {
        if (mStatus != Status.PENDING) {
            switch (mStatus) {
                case RUNNING:
                    throw new IllegalStateException(&quot;Cannot execute task:&quot;
                            + &quot; the task is already running.&quot;);
                case FINISHED:
                    throw new IllegalStateException(&quot;Cannot execute task:&quot;
                            + &quot; the task has already been executed &quot;
                            + &quot;(a task can be executed only once)&quot;);
            }
        }

        mStatus = Status.RUNNING;

        onPreExecute();

        mWorker.mParams = params;
        exec.execute(mFuture);

        return this;
    }
</code></pre>
<p>å…ˆçœ‹ä¸‹è¿™ä¸ªå‡½æ•°é‡Œé¢éƒ½åšäº†ä»€ä¹ˆï¼Œåœ¨åˆ†æsDefaultExecutorã€‚executeOnExecutorè¿™ä¸ªå‡½æ•°æ˜¯publicçš„æ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡è¿™ä¸ªå‡½æ•°æ‰§è¡Œä»»åŠ¡ã€‚å¦‚æœæˆ‘ä»¬é€šè¿‡executeOnExecutor()è¿™ä¸ªæ–¹æ³•çš„è¯å°±è¦è‡ªå·±åˆ›å»ºä¸€ä¸ªExecutorï¼Œå› ä¸ºé»˜è®¤çš„Executoræ˜¯ä½¿ç”¨é˜Ÿåˆ—ç»´æŠ¤åŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œå¤šä»»åŠ¡æ—¶ä¼šè¢«æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ï¼Œåé¢ä¼šè®²åˆ°ã€‚</p>
<p>é¦–å…ˆï¼Œè¿›æ¥å…ˆåˆ¤æ–­çŠ¶æ€ï¼Œå¦‚æœå¦‚æœä¸æ˜¯æ²¡æ‰§è¡Œè¿‡çš„è¦æŠ›å‡ºå¼‚å¸¸ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå¦‚æœæ‰§è¡Œä¸¤æ¬¡ä»»åŠ¡ä¼šæŠ¥java.lang.IllegalStateExceptionè¿™ä¸ªé”™çš„åŸå› ã€‚</p>
<p>å…¶æ¬¡ï¼Œå°†çŠ¶æ€æ”¹ä¸ºæ­£åœ¨æ‰§è¡Œã€‚</p>
<p>ç„¶åï¼Œæ‰§è¡ŒonPreExecute()æ–¹æ³•ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¿™ä¸ªæ–¹æ³•åœ¨ä¸»çº¿ç¨‹ï¼Œè€Œä¸”åœ¨ä»»åŠ¡å‰æ‰§è¡Œã€‚</p>
<p>å†ç„¶åå¼€å§‹æ‰§è¡ŒExecutorçš„ä»»åŠ¡ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥åˆ†æsDefaultExecutoräº†ã€‚</p>
<p>ç±»é‡Œå¯ä»¥çœ‹åˆ°</p>
<pre><code>private static volatile Executor sDefaultExecutor = SERIAL_EXECUTOR;

public static final Executor SERIAL_EXECUTOR = new SerialExecutor();

</code></pre>
<p>è¿™ä¸¤ä¸ªå¸¸é‡å…¶å®å°±æ˜¯é»˜è®¤åˆ›å»ºäº†ä¸€ä¸ªExecutor</p>
<pre><code>
    private static class SerialExecutor implements Executor {
        final ArrayDeque&lt;Runnable&gt; mTasks = new ArrayDeque&lt;Runnable&gt;();
        Runnable mActive;

        public synchronized void execute(final Runnable r) {
            mTasks.offer(new Runnable() {
                public void run() {
                    try {
                        r.run();
                    } finally {
                        scheduleNext();
                    }
                }
            });
            if (mActive == null) {
                scheduleNext();
            }
        }

        protected synchronized void scheduleNext() {
            if ((mActive = mTasks.poll()) != null) {
                THREAD_POOL_EXECUTOR.execute(mActive);
            }
        }
    }
</code></pre>
<p>è¿™ä¸ªSerialExecutoré‡Œé¢ç»´æŠ¤äº†ä¸€ä¸ªé˜Ÿåˆ—ï¼Œç„¶åé€šè¿‡offer()åœ¨é˜Ÿåˆ—çš„æœ«å°¾åŠ å…¥ä»»åŠ¡ï¼Œé€šè¿‡poll()åœ¨å¤´éƒ¨æ£€ç´¢å‡ºä»»åŠ¡å¹¶åˆ é™¤ï¼Œæ£€ç´¢åèµ‹å€¼ç»™mActiveã€‚å› ä¸ºé¦–æ¬¡mActiveä¸ºnullï¼Œæ‰€ä»¥åŠ å…¥äº†åˆ¤æ–­mActive==nullçš„æ—¶å€™æ‰§è¡ŒscheduleNext(),åé¢å†æœ‰ä»»åŠ¡æ¥çš„è¯mActiveå°±ä¸æ˜¯nulläº†ï¼Œæ‰€ä»¥æ˜¯åœ¨runableä¸­ï¼Œé€šè¿‡finallyè°ƒç”¨äº†scheduleNext()ï¼Œè¿™æ—¶å€™å°±ä¼šç­‰ä»»åŠ¡æ‰§è¡Œå®Œæˆååœ¨æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚è¿™å°±æ˜¯ä¸Šé¢è¯´çš„ä¸ºä»€ä¹ˆé»˜è®¤çš„SerialExecutoråªèƒ½åŒæ—¶åœ¨ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ã€‚</p>
<pre><code>    /**
     * An {@link Executor} that can be used to execute tasks in parallel.
     */
    public static final Executor THREAD_POOL_EXECUTOR;

    static {
        ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(
                CORE_POOL_SIZE, MAXIMUM_POOL_SIZE, KEEP_ALIVE_SECONDS, TimeUnit.SECONDS,
                sPoolWorkQueue, sThreadFactory);
        threadPoolExecutor.allowCoreThreadTimeOut(true);
        THREAD_POOL_EXECUTOR = threadPoolExecutor;
    }
</code></pre>
<p>è¿™ä¸ªä¸»è¦å°±æ˜¯é€šè¿‡å„ç§é»˜è®¤ä¸ºçš„å‚æ•°åˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹æ± å»æ‰§è¡Œä»»åŠ¡ã€‚</p>
<p>è¿™å°±æ˜¯ä¸»è¦æµç¨‹ï¼Œä½†æ˜¯åœ¨è¿™ä¸ªæµç¨‹ä¸­è¿˜å¿½ç•¥äº†å¾ˆå¤šå†…å®¹ï¼Œåœ¨æˆ‘ä»¬äº†è§£äº†æ•´ä½“æ¡†æ¶æµç¨‹åï¼Œåœ¨å»å¡«å……æˆ‘ä»¬æƒ³çŸ¥é“çš„ç»†èŠ‚ï¼Œå°±æ›´å®¹æ˜“ç†è§£äº†ã€‚</p>
<p>é¦–å…ˆçœ‹executeOnExecutor()æ–¹æ³•ä¸­æœ‰ä¸¤ä¸ªå¾ˆé‡è¦çš„å†…å®¹ä¸€ä¸ªæ˜¯mWorkerå’ŒmFutureã€‚å…¶å®æ‰§è¡Œä»»åŠ¡çš„æ—¶å€™ä¼ å…¥äº†mFutureï¼Œè€ŒmFutureæ˜¯ä¸€ä¸ªmFutureTaskçœŸæ­£æ‰§è¡Œçš„æ˜¯mWorkerã€‚</p>
<pre><code>     /**
     * Creates a new asynchronous task. This constructor must be invoked on the UI thread.
     */
    public AsyncTask() {
        this((Looper) null);
    }

    /**
     * Creates a new asynchronous task. This constructor must be invoked on the UI thread.
     *
     * @hide
     */
    public AsyncTask(@Nullable Handler handler) {
        this(handler != null ? handler.getLooper() : null);
    }

    /**
     * Creates a new asynchronous task. This constructor must be invoked on the UI thread.
     *
     * @hide
     */
    public AsyncTask(@Nullable Looper callbackLooper) {
        mHandler = callbackLooper == null || callbackLooper == Looper.getMainLooper()
            ? getMainHandler()
            : new Handler(callbackLooper);

        mWorker = new WorkerRunnable&lt;Params, Result&gt;() {
            public Result call() throws Exception {
                mTaskInvoked.set(true);
                Result result = null;
                try {
                    Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);
                    //noinspection unchecked
                    result = doInBackground(mParams);
                    Binder.flushPendingCommands();
                } catch (Throwable tr) {
                    mCancelled.set(true);
                    throw tr;
                } finally {
                    postResult(result);
                }
                return result;
            }
        };

        mFuture = new FutureTask&lt;Result&gt;(mWorker) {
            @Override
            protected void done() {
                try {
                    postResultIfNotInvoked(get());
                } catch (InterruptedException e) {
                    android.util.Log.w(LOG_TAG, e);
                } catch (ExecutionException e) {
                    throw new RuntimeException(&quot;An error occurred while executing doInBackground()&quot;,
                            e.getCause());
                } catch (CancellationException e) {
                    postResultIfNotInvoked(null);
                }
            }
        };
    }

</code></pre>
<p>åœ¨æ„é€ é‡Œåˆ›å»ºäº†ä¸‰éƒ¨åˆ†å†…å®¹ï¼ŒmHandlerã€mWorkerã€mFutur</p>
<p>å¯ä»¥çœ‹åˆ°é¦–å…ˆä¼šåˆ›å»ºhandlerå› ä¸ºï¼Œçº¿ç¨‹é€šä¿¡è¿˜æ˜¯éœ€è¦ä¾é Handlerã€‚ç„¶åmWorkerä¸­ä¸»è¦å°±æ˜¯æ‰§è¡ŒdoInBackground()ç„¶åå°†resultä¼ ç»™postResultã€‚</p>
<pre><code>private Result postResult(Result result) {
        @SuppressWarnings(&quot;unchecked&quot;)
        Message message = getHandler().obtainMessage(MESSAGE_POST_RESULT,
                new AsyncTaskResult&lt;Result&gt;(this, result));
        message.sendToTarget();
        return result;
    }

  
</code></pre>
<p>postResultä¸»è¦å°±æ˜¯é€šè¿‡handlerå‘é€ä¸€ä¸ªwhatä¸ºMESSAGE_POST_RESULTï¼Œobjä¸ºresultçš„messageã€‚</p>
<pre><code> private static class InternalHandler extends Handler {
        public InternalHandler(Looper looper) {
            super(looper);
        }

        @SuppressWarnings({&quot;unchecked&quot;, &quot;RawUseOfParameterizedType&quot;})
        @Override
        public void handleMessage(Message msg) {
            AsyncTaskResult&lt;?&gt; result = (AsyncTaskResult&lt;?&gt;) msg.obj;
            switch (msg.what) {
                case MESSAGE_POST_RESULT:
                    // There is only one result
                    result.mTask.finish(result.mData[0]);
                    break;
                case MESSAGE_POST_PROGRESS:
                    result.mTask.onProgressUpdate(result.mData);
                    break;
            }
        }
    }
    
</code></pre>
<p>è¿™æ—¶å€™çœ‹handleMessageæ˜¯æ€ä¹ˆå¤„ç†çš„ã€‚<br>
è¿™é‡Œä¸»è¦æ˜¯è°ƒç”¨åŒºåˆ†whatæ˜¯å®Œæˆè¿˜æ˜¯æœªå®Œæˆå®Œæˆçš„è¯å°±æ˜¯è°ƒç”¨finishæ–¹æ³•ï¼Œæœªå®Œæˆå°±æ˜¯onProgressUpdateæ–¹æ³•ï¼Œ</p>
<pre><code>    private void finish(Result result) {
        if (isCancelled()) {
            onCancelled(result);
        } else {
            onPostExecute(result);
        }
        mStatus = Status.FINISHED;
    }

</code></pre>
<p>åœ¨çœ‹finishæ–¹æ³•å°±æ˜¯åˆ¤æ–­æ˜¯å¦å–æ¶ˆç„¶åè°ƒç”¨onPostExecutæ–¹æ³•å°†ç»“æœä¼ å…¥ã€‚<br>
hadlerMessageè¿˜å¤„ç†ä¸€ä¸ªå°±æ˜¯æ›´æ–°è¿›åº¦ï¼Œé‚£è¿™ä¸ªmessageæ˜¯åœ¨å“ªé‡Œå‘çš„å‘¢ï¼Ÿ</p>
<pre><code>   protected final void publishProgress(Progress... values) {
        if (!isCancelled()) {
            getHandler().obtainMessage(MESSAGE_POST_PROGRESS,
                    new AsyncTaskResult&lt;Progress&gt;(this, values)).sendToTarget();
        }
    }
</code></pre>
<p>å¯ä»¥çœ‹åˆ°æ˜¯é€šè¿‡publishProgressè¿™ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬å¦‚æœéœ€è¦æ›´æ–°è¿›åº¦çš„è¯è¦è‡ªå·±åœ¨doInBackgroundè¿™ä¸ªæ–¹æ³•é‡Œè°ƒç”¨publishProgress()æ–¹æ³•ä¼ å…¥è¿›åº¦ã€‚ç„¶ååœ¨æ‰ä¼šåœ¨onProgressUpdate()è¿™ä¸ªæ–¹æ³•ä¸­æ”¶åˆ°ã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>è‡³æ­¤ æ•´ä¸ªæµç¨‹ä¹Ÿå°±æ¸…æ™°äº†ï¼Œè¿™å››ä¸ªæ–¹æ³•æ˜¯åˆ†åˆ«åœ¨å“ªé‡Œè°ƒç”¨çš„åœ¨èƒ½å®ç°å¼‚æ­¥ç„¶åæ›´æ–°UIçš„åŠŸèƒ½ï¼Œå…¶å®åŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯ç”¨äº†ä¸€ä¸ªçº¿åŸæ± ç„¶åæˆ‘ä»¬åœ¨å­çº¿ç¨‹å®æ—¶é€šè¿‡Handlerå‘é€Messageåˆ°UIçº¿ç¨‹ä¸­æ‰§è¡Œè¿›åº¦çš„ä»»åŠ¡ï¼Œé»˜è®¤é€šè¿‡ä¸€ä¸ªé˜Ÿåˆ—ç»´æŠ¤ä»»åŠ¡ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰Executoræ¥å®ç°å¤šçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hello Gridea]]></title>
        <id>http://xuanguofeng.com/post/hello-gridea</id>
        <link href="http://xuanguofeng.com/post/hello-gridea">
        </link>
        <updated>2018-12-11T16:00:00.000Z</updated>
        <summary type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼</p>
]]></summary>
        <content type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼</p>
<!-- more -->
<p>âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
<p><a href="https://github.com/getgridea/gridea">Github</a><br>
<a href="http://hvenotes.fehey.com/">Gridea ä¸»é¡µ</a><br>
<a href="http://fehey.com/">ç¤ºä¾‹ç½‘ç«™</a></p>
<h2 id="ç‰¹æ€§">ç‰¹æ€§ğŸ‘‡</h2>
<p>ğŸ“  ä½ å¯ä»¥ä½¿ç”¨æœ€é…·çš„ <strong>Markdown</strong> è¯­æ³•ï¼Œè¿›è¡Œå¿«é€Ÿåˆ›ä½œ</p>
<p>ğŸŒ‰  ä½ å¯ä»¥ç»™æ–‡ç« é…ä¸Šç²¾ç¾çš„å°é¢å›¾å’Œåœ¨æ–‡ç« ä»»æ„ä½ç½®æ’å…¥å›¾ç‰‡</p>
<p>ğŸ·ï¸  ä½ å¯ä»¥å¯¹æ–‡ç« è¿›è¡Œæ ‡ç­¾åˆ†ç»„</p>
<p>ğŸ“‹  ä½ å¯ä»¥è‡ªå®šä¹‰èœå•ï¼Œç”šè‡³å¯ä»¥åˆ›å»ºå¤–éƒ¨é“¾æ¥èœå•</p>
<p>ğŸ’»  ä½ å¯ä»¥åœ¨ <strong>ğ–¶ğ—‚ğ—‡ğ–½ğ—ˆğ—ğ—Œ</strong> æˆ– <strong>ğ–¬ğ–ºğ–¼ğ–®ğ–²</strong> è®¾å¤‡ä¸Šä½¿ç”¨æ­¤å®¢æˆ·ç«¯</p>
<p>ğŸŒ  ä½ å¯ä»¥ä½¿ç”¨ <strong>ğ–¦ğ—‚ğ—ğ—ğ—ğ–» ğ–¯ğ–ºğ—€ğ–¾ğ—Œ</strong> æˆ– <strong>Coding Pages</strong> å‘ä¸–ç•Œå±•ç¤ºï¼Œæœªæ¥å°†æ”¯æŒæ›´å¤šå¹³å°</p>
<p>ğŸ’¬  ä½ å¯ä»¥è¿›è¡Œç®€å•çš„é…ç½®ï¼Œæ¥å…¥ <a href="https://github.com/gitalk/gitalk">Gitalk</a> æˆ– <a href="https://github.com/SukkaW/DisqusJS">DisqusJS</a> è¯„è®ºç³»ç»Ÿ</p>
<p>ğŸ‡¬ğŸ‡§  ä½ å¯ä»¥ä½¿ç”¨<strong>ä¸­æ–‡ç®€ä½“</strong>æˆ–<strong>è‹±è¯­</strong></p>
<p>ğŸŒ  ä½ å¯ä»¥ä»»æ„ä½¿ç”¨åº”ç”¨å†…é»˜è®¤ä¸»é¢˜æˆ–ä»»æ„ç¬¬ä¸‰æ–¹ä¸»é¢˜ï¼Œå¼ºå¤§çš„ä¸»é¢˜è‡ªå®šä¹‰èƒ½åŠ›</p>
<p>ğŸ–¥  ä½ å¯ä»¥è‡ªå®šä¹‰æºæ–‡ä»¶å¤¹ï¼Œåˆ©ç”¨ OneDriveã€ç™¾åº¦ç½‘ç›˜ã€iCloudã€Dropbox ç­‰è¿›è¡Œå¤šè®¾å¤‡åŒæ­¥</p>
<p>ğŸŒ± å½“ç„¶ <strong>Gridea</strong> è¿˜å¾ˆå¹´è½»ï¼Œæœ‰å¾ˆå¤šä¸è¶³ï¼Œä½†è¯·ç›¸ä¿¡ï¼Œå®ƒä¼šä¸åœå‘å‰ğŸƒ</p>
<p>æœªæ¥ï¼Œå®ƒä¸€å®šä¼šæˆä¸ºä½ ç¦»ä¸å¼€çš„ä¼™ä¼´</p>
<p>å°½æƒ…å‘æŒ¥ä½ çš„æ‰åå§ï¼</p>
<p>ğŸ˜˜ Enjoy~</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ã€Flutterç¬”è®°ã€‘ä¹‹Widgetçš„ä¸€äº›æ€»ç»“]]></title>
        <id>http://xuanguofeng.com/post/ã€Flutterç¬”è®°ã€‘ä¹‹Widgetçš„ä¸€äº›æ€»ç»“</id>
        <link href="http://xuanguofeng.com/post/ã€Flutterç¬”è®°ã€‘ä¹‹Widgetçš„ä¸€äº›æ€»ç»“">
        </link>
        <updated>2018-09-03T08:00:49.000Z</updated>
        <summary type="html"><![CDATA[<p>å¯ä»¥è¯´flutterä¸­æ˜¯åŸºäºWidgetsçš„ï¼Œä¸€ä¸ªTextViewæ˜¯Widgetsï¼Œä¸€ä¸ªå¸ƒå±€ä¹Ÿæ˜¯ä¸€ä¸ªWidgetsã€‚ä½¿ç”¨Widgetså»ç»„è£…å‡ºä½ æƒ³è¦çš„ UIï¼Œäº†è§£Widgetsä¹Ÿæ˜¯éå¸¸é‡è¦çš„ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>å¯ä»¥è¯´flutterä¸­æ˜¯åŸºäºWidgetsçš„ï¼Œä¸€ä¸ªTextViewæ˜¯Widgetsï¼Œä¸€ä¸ªå¸ƒå±€ä¹Ÿæ˜¯ä¸€ä¸ªWidgetsã€‚ä½¿ç”¨Widgetså»ç»„è£…å‡ºä½ æƒ³è¦çš„ UIï¼Œäº†è§£Widgetsä¹Ÿæ˜¯éå¸¸é‡è¦çš„ã€‚</p>
<!-- more -->
<p>Flutteré»˜è®¤ä¹Ÿæä¾›äº†ä¸°å¯Œæˆ‘Widgetsï¼ŒåŒ…æ‹¬Android Material Designé£æ ¼çš„æ§ä»¶ï¼Œä¹Ÿæœ‰iOSé£æ ¼çš„Cupertinoç»„ä»¶åº“ã€‚è€Œä¸”æ‰€æœ‰ç»„ä»¶çš„ä½¿ç”¨æ–¹å¼å‡ ä¹æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥åœ¨å†™UIçš„æ—¶å€™åªè¦å¯¹è¿™äº›ç»„ä»¶è¿›è¡Œç»„è£…å³å¯ã€‚</p>
<h2 id="ä¸€äº›å¸¸ç”¨ç»„ä»¶çš„å¸¸ç”¨ç”¨æ³•">ä¸€äº›å¸¸ç”¨ç»„ä»¶çš„å¸¸ç”¨ç”¨æ³•ã€‚</h2>
<pre><code> import 'package:flutter/material.dart';

void main() {
  runApp(
    new Center(
      child: new Text(
        'Hello, world!',
        textDirection: TextDirection.ltr,
      ),
    ),
  );
}

</code></pre>
<p>è¿™æ˜¯ä¸€æ®µhello wordä»£ç ï¼Œé¦–å…ˆ runApp æ˜¯ç¨‹åºçš„å…¥å£ï¼Œæ¥ä¸‹æ¥ä¾¿æ˜¯ä¸€ä¸ªWidgetsï¼ŒCenterè¿™æ˜¯ä¸€å¸ƒå±€ Widgets,ç„¶åé‡Œé¢æ˜¯ä¸€ä¸ªText Widgetsã€‚<br>
åœ¨Flutterä¸­å°±æ˜¯è¿™æ ·çš„ï¼Œå¯èƒ½ä¸æ˜¯æ‰€æœ‰Widgetséƒ½æœ‰é€šç”¨çš„æ–¹æ³•ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡åŒ…è£¹åµŒå¥—æ¥å®ç°ã€‚ä¾‹å¦‚ texté»˜è®¤æ²¡æœ‰äº‹ä»¶ï¼Œå¯ä»¥é€šè¿‡äº‹ä»¶Widgetsè¿›è¡ŒåµŒå¥—å®ç°ã€‚</p>
<h2 id="statelesswidget-å’Œ-statefulwidget">StatelessWidget å’Œ StatefulWidget</h2>
<p>æˆ‘ä»¬å†™çš„æ§ä»¶åŸºæœ¬éƒ½è¦ç»§æ‰¿è¿™ä¸¤ä¸ªï¼Œè¿™ä¸¤ä¸ªçš„ä¸»è¦åŒºåˆ«æ˜¯çœ‹é¡µé¢æ˜¯å¦éœ€è¦åŠ¨æ€åˆ·æ–°ï¼Œå»ºè®®ä¸éœ€è¦åˆ·æ–°æ—¶ä½¿ç”¨StatelessWidgetï¼Œå¦‚æœéœ€è¦åˆ·æ–°çš„è¯å¯ä»¥ä½¿ç”¨StatefulWidgetå¹¶é€šè¿‡è°ƒç”¨setStateæ¥é€šçŸ¥æ¡†æ¶æ”¹å˜çŠ¶æ€ã€‚</p>
<p>é‡Œé¢çš„buildå‡½æ•°å¼ widgets çš„å…¥å£å‡½æ•°ï¼Œå¯ä»¥åœ¨é‡Œé¢åˆ›å»ºå…¶ä»–çš„widgetsã€‚æ¡†æ¶å°†ä¼šä¸€æ¬¡æ„å»ºè¿™äº›widgetsï¼Œç›´åˆ°æœ€åº•å±‚çš„  RenderObject ä¹‹ä¸‹ï¼Œç„¶åè®¡ç®—æœºè¿›è¡Œè®¡ç®—ç›¸å…³çš„å›¾å½¢å¹¶æ¸²æŸ“å‡ºã€‚</p>
<h2 id="ä¸€äº›å¸¸ç”¨wigets">ä¸€äº›å¸¸ç”¨Wigets</h2>
<p>ç”±äºWidgetsçš„æ ·å¼ä»¥åŠç”¨æ³•ï¼Œä¹‹å‰æ€»ç»“äº†ä¸€ä¸ªå•ç‹¬çš„demoï¼Œå¤§å®¶å¯ä»¥çœ‹demoï¼Œé‡Œé¢æœ‰å±•ç¤ºä»¥åŠä»£ç å…·ä½“å®ç°ã€‚</p>
<p>åœ°å€ï¼šhttps://github.com/xuanguofeng/flutter_widgets</p>
<h3 id="å¸¸ç”¨widgets">å¸¸ç”¨Widgets</h3>
<p>Flutterå†…ç½®äº†ä¸°å¯Œçš„å¸¸ç”¨çš„ç»„ä»¶ï¼ŒåŒ…æ‹¬æ–‡æœ¬ã€æŒ‰é’®ã€å›¾ç‰‡ã€è¡Œã€åˆ—ç­‰ç»„ä»¶ã€‚</p>
<h3 id="material-designé£æ ¼widgets">Material Designé£æ ¼Widgets</h3>
<p>Flutterdå¯¹Material Designçš„æ”¯æŒå¾ˆä¸°å¯Œï¼Œä¹Ÿæä¾›äº†å¸‚é¢ç›®å‰æ¯”è¾ƒæµè¡Œçš„é£æ ¼ï¼Œæ¯”å¦‚Androidçš„ä¾§æ»‘ã€åº•éƒ¨çš„å¯¼èˆªç­‰ï¼Œå…·ä½“å¯ä»¥çœ‹æœ¬æ–‡åœ°ä¸‹çš„demoã€‚</p>
<h3 id="cupertinoçš„iosé£æ ¼ç»„ä»¶">Cupertinoçš„iOSé£æ ¼ç»„ä»¶</h3>
<p>è¿™é‡Œä¹Ÿæ˜¯ä¸¾äº†ä¸€äº›æ§ä»¶çš„åç§°ï¼Œå¯¹iOSçš„æ”¯æŒä¹Ÿå¾ˆä¸°å¯Œï¼ŒåŒ…å«å¸¸ç”¨çš„titleæ ·å¼ã€åº•éƒ¨å¯¼èˆªã€iOSé£æ ¼çš„æŒ‰é’®ã€Dialodã€åŠ è½½ä¸­çš„loadingç­‰ã€‚</p>
<h3 id="layout-widgets">Layout Widgets</h3>
<p>Layoutçš„æ§ä»¶æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„ï¼Œå› ä¸ºå¥½å¤šåŠŸèƒ½è¦é€šè¿‡åµŒå¥—æ¥å®ç°ã€‚ä¾‹å¦‚ marginã€paddingã€äº‹ä»¶çš„widgetsã€material designé£æ ¼çš„å¸ƒå±€ã€ç±»ä¼¼å¸§å¸ƒå±€çš„Stackã€GridViewã€ListViewã€Centerã€Alignç­‰ã€‚</p>
<p>å…¶ä»–è¿˜æœ‰å¾ˆå¤šæ§ä»¶ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚</p>
<p>æ–‡æ¡£åœ°å€ï¼šhttp://doc.flutter-dev.cn/widgets/</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[é—®é¢˜æ—¥å¿—-Flutteré¡µé¢è·³è½¬æ— ååº”çš„é—®é¢˜]]></title>
        <id>http://xuanguofeng.com/post/é—®é¢˜æ—¥å¿—-Flutteré¡µé¢è·³è½¬æ— ååº”çš„é—®é¢˜</id>
        <link href="http://xuanguofeng.com/post/é—®é¢˜æ—¥å¿—-Flutteré¡µé¢è·³è½¬æ— ååº”çš„é—®é¢˜">
        </link>
        <updated>2018-07-11T13:28:21.000Z</updated>
        <summary type="html"><![CDATA[<p>æè¿°ï¼šåœ¨ä½¿ç”¨Flutteråšé¡µé¢è·³è½¬æ—¶å€™ï¼Œå®˜æ–¹çš„æè¿°ä½¿ç”¨æ–¹æ³•æ˜¯è¿™æ ·çš„ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>æè¿°ï¼šåœ¨ä½¿ç”¨Flutteråšé¡µé¢è·³è½¬æ—¶å€™ï¼Œå®˜æ–¹çš„æè¿°ä½¿ç”¨æ–¹æ³•æ˜¯è¿™æ ·çš„ã€‚</p>
<!-- more -->
<pre><code>void main() {
  runApp(new MaterialApp(
    home: new MyAppHome(), // becomes the route named '/'
    routes: &lt;String, WidgetBuilder&gt; {
      '/a': (BuildContext context) =&gt; new MyPage(title: 'page A'),
      '/b': (BuildContext context) =&gt; new MyPage(title: 'page B'),
      '/c': (BuildContext context) =&gt; new MyPage(title: 'page C'),
    },
  ));
}
</code></pre>
<p>æ¥ç€å°±å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼æ¥æ“ä½œ Routeã€‚</p>
<pre><code>Navigator.of(context).pushNamed('/b');
</code></pre>
<p>çœ‹ä¸€äº›ä»£ç ç¡®å®ä¹Ÿæ˜¯è¿™æ ·ä½¿ç”¨çš„ï¼Œä½†æ˜¯ä¹‹å‰è‡ªå·±ä½¿ç”¨çš„æ—¶å€™å°±æ˜¯æ— æ³•è·³è½¬ã€‚<br>
æç¤ºï¼š</p>
<pre><code>The context used to push or pop routes from the Navigator 
must be that of a widget that is a descendant of a 
Navigator widget.
</code></pre>
<h2 id="è§£å†³æ­¥éª¤">è§£å†³æ­¥éª¤</h2>
<p>ä¸Šç½‘æŸ¥è¯¢èµ„æ–™ï¼Œæ­¤æ—¶Flutterçš„èµ„æ–™è¿˜ä¸æ˜¯å¾ˆå¤šã€‚</p>
<h2 id="è§£å†³æ–¹æ³•">è§£å†³æ–¹æ³•</h2>
<pre><code>
class _FWMainAppState extends State&lt;FWMainApp&gt; {
  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      theme: ThemeData(
          primaryColor: AppColors.colorPrimary, accentColor: Colors.blue),
      home: _Home(),
      routes: &lt;String, WidgetBuilder&gt;{
        '/BtnSamplePage': (BuildContext context) =&gt; BtnSamplePage(),
        '/TextSamplePage': (BuildContext context) =&gt; TextSamplePage(),
        '/DialogSamplePage': (BuildContext context) =&gt; DialogSamplePage(),
        '/LayoutSamplePage': (BuildContext context) =&gt; LayoutSamplePage(),
      },
    );
  }
}

</code></pre>
<p>ä¸»è¦çœ‹home:ç”±äºè¿™æ˜¯é¦–é¡µä¹‹å‰åœ¨homeæ˜¯ç›´æ¥åˆ›å»ºçš„æ§ä»¶ï¼Œä¸€ç›´æç¤ºå¤±è´¥ã€‚</p>
<p>åæ¥é€šè¿‡homeï¼šåé¢å¼•å…¥ä¸€ä¸ªç±»ï¼Œåœ¨ç±»é‡Œåˆ›å»ºæƒ³è¦åˆ›å»ºçš„æ§ä»¶å°±è§£å†³äº†ã€‚</p>
<pre><code>class _Home extends StatelessWidget {

  @override
  Widget build(BuildContext context) {
  
    return new Scaffold(
      appBar: AppBar(
        title: Text(AppStrings.appBarTitle),
        actions: &lt;Widget&gt;[
          new IconButton(
            icon: const Icon(Icons.build),
            onPressed: () async {},
            tooltip: 'tool',
          )
        ],
      ),
      body: _body,
    );
  }
}
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ã€Flutterç¬”è®°ã€‘ä¹‹Dartä¸Javaçš„ä¸€äº›ç›´è§‚åŒºåˆ«]]></title>
        <id>http://xuanguofeng.com/post/ã€Flutterç¬”è®°ã€‘ä¹‹Dartä¸Javaçš„ä¸€äº›ç›´è§‚åŒºåˆ«</id>
        <link href="http://xuanguofeng.com/post/ã€Flutterç¬”è®°ã€‘ä¹‹Dartä¸Javaçš„ä¸€äº›ç›´è§‚åŒºåˆ«">
        </link>
        <updated>2018-07-05T11:43:39.000Z</updated>
        <summary type="html"><![CDATA[<p>Dart æ˜¯ Flutter çš„ä¸»è¦å¼€å‘è¯­è¨€ï¼ŒFlutter æ˜¯ä¸€ä¸ªæ¥è‡ª Google ç”¨äºç§»åŠ¨åº”ç”¨å¼€å‘çš„ SDKã€‚å…¶å®å¯¹äºJavaå¼€å‘äººå‘˜æ¥è¯´Dartï¼Œè¿˜æ˜¯ç›¸å¯¹å¥½ç†è§£çš„ï¼Œè¿™ç¯‡ç¬”è®°å°†è®°å½•åˆå­¦Dartæ—¶ï¼Œç›¸æ¯”è¾ƒJavaçš„ä¸€äº›åŒºåˆ«ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>Dart æ˜¯ Flutter çš„ä¸»è¦å¼€å‘è¯­è¨€ï¼ŒFlutter æ˜¯ä¸€ä¸ªæ¥è‡ª Google ç”¨äºç§»åŠ¨åº”ç”¨å¼€å‘çš„ SDKã€‚å…¶å®å¯¹äºJavaå¼€å‘äººå‘˜æ¥è¯´Dartï¼Œè¿˜æ˜¯ç›¸å¯¹å¥½ç†è§£çš„ï¼Œè¿™ç¯‡ç¬”è®°å°†è®°å½•åˆå­¦Dartæ—¶ï¼Œç›¸æ¯”è¾ƒJavaçš„ä¸€äº›åŒºåˆ«ã€‚</p>
<!-- more -->
<p>##åŒºåˆ«</p>
<h3 id="æ„é€ å‡½æ•°">æ„é€ å‡½æ•°</h3>
<p>åœ¨Dartçš„æ„é€ ä¸­å¯ä»¥æ²¡æœ‰æ–¹æ³•ä½“ã€‚</p>
<pre><code>//è¿™æ ·å†™å¾ˆç®€å•
User(this.cadence, this.speed, this.gear);

//ä¹Ÿå¯ä»¥å†™æˆè¿™æ ·
Bicycle(int cadence, int speed, int gear) {
  this.cadence = cadence;
  this.speed = speed;
  this.gear = gear;
}

</code></pre>
<h3 id="å¯é€‰å‚æ•°">å¯é€‰å‚æ•°</h3>
<p>åœ¨Dartä¸­å¯ä»¥ä½¿ç”¨å¯é€‰å‚æ•°ã€æ— è®ºæ˜¯æ„é€ è¿˜æ˜¯æ™®é€šæ–¹æ³•ã€‚</p>
<pre><code>Book({this.money = 100, this.size = 0, this.author = null});
</code></pre>
<p>è°ƒç”¨çš„æ—¶å€™è¦æŒ‡å®šå‚æ•°å</p>
<pre><code>main() {
  print(Book(money:100 , size: 88, author:'test'));
  print(Book(money:99,   size:100));
  print(Rectangle());
}
</code></pre>
<h3 id="å…³é”®å­—">å…³é”®å­—</h3>
<ul>
<li>åœ¨ Dart ä¸­æ²¡æœ‰è¯¸å¦‚ publicã€privateã€protected è¿™æ ·çš„å…³é”®è¯ã€‚<br>
å¦‚æœä¸€ä¸ªæ ‡è¯†ç¬¦ä»¥ (_) å¼€å¤´ï¼Œåˆ™è¯¥æ ‡è¯†ç¬¦ åœ¨åº“å†…æ˜¯ç§æœ‰çš„</li>
<li>Dart2ä¸­ï¼Œå¯ä»¥ä¸ä½¿ç”¨newå…³é”®å­—åˆ›å»ºï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚</li>
</ul>
<h3 id="å˜é‡">å˜é‡</h3>
<ul>
<li>Dartä¸­å˜é‡åˆå§‹å€¼ä¸ºnullï¼Œå³ä½¿æ˜¯intç±»å‹ä¹Ÿæ˜¯nullã€‚</li>
<li>Dartæ”¯æŒè‡ªè¯†åˆ«ï¼Œå¯ä»¥æ˜¯ç”¨varå®šä¹‰å˜é‡ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æŒ‡å®šå…·ä½“ç±»å‹ã€‚</li>
<li>å¦‚æœä½ ä»¥åä¸æ‰“ç®—ä¿®æ”¹ä¸€ä¸ªå˜é‡ï¼Œä½¿ç”¨ final æˆ–è€… constã€‚ ä¸€ä¸ª final å˜é‡åªèƒ½èµ‹å€¼ä¸€æ¬¡ï¼›ä¸€ä¸ª const å˜é‡æ˜¯ç¼–è¯‘æ—¶å¸¸é‡ã€‚</li>
</ul>
<h3 id="åŸºæœ¬ç±»å‹">åŸºæœ¬ç±»å‹</h3>
<ul>
<li>intå’Œdoubleæ˜¯numçš„å­ç±»ã€‚æ²¡æœ‰floatç±»å‹ã€‚</li>
<li>Dartä¸­æ‰€æœ‰çš„ç±»éƒ½æ˜¯Objectçš„å­ç±»ã€‚</li>
<li>Stringå¯ä»¥ä½¿ç”¨å•å¼•å·æˆ–è€…åŒå¼•å·ã€‚</li>
<li>Stringæ”¯æŒæ¨¡æ¿ï¼Œä½¿ç”¨ ${expression} çš„æ–¹å¼æ¥å®ç°å­—ç¬¦ä¸²æ¨¡æ¿çš„æ•ˆæœï¼Œå¦‚æœè¯¥è¡¨è¾¾å¼ä»…ä»…æ˜¯ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œè¿˜å¯ä»¥å»æ‰èŠ±æ‹¬å· $variableNameã€‚</li>
<li>å­—ç¬¦ä¸²å‰åŠ rä»£è¡¨åŸå§‹å­—ç¬¦ä¸²ã€‚</li>
<li>åªæœ‰trueå’Œflaseæ˜¯boolç±»å‹ï¼Œè¿™ä¸¤ä¸ªå¯¹è±¡ä¹Ÿæ˜¯ç¼–è¯‘æ—¶å¸¸é‡ã€‚å½“Dartéœ€è¦ä¸€ä¸ªå¸ƒå°”å€¼çš„æ—¶å€™ï¼Œåªæœ‰trueå¯¹è±¡æ‰è¢«è®¤ä¸ºtrue,å…¶ä»–éƒ½æ˜¯falseã€‚</li>
</ul>
<h3 id="æ–¹æ³•">æ–¹æ³•</h3>
<ul>
<li>Dartæ˜¯ä¸€ä¸ªçœŸæ­£é¢å‘å¯¹è±¡çš„è¯­è¨€ï¼Œæ–¹æ³•ä¹Ÿæ˜¯å¯¹è±¡å¹¶ä¸”å…·æœ‰ä¸€ç§ç±»å‹Functionã€‚</li>
<li>å¯ä»¥ä½¿ç”¨ä¸Šæ–‡è¯´çš„å¯é€‰æ–¹æ³•ã€‚</li>
<li>æ”¯æŒç›´æ¥è®¾ç½®é»˜è®¤å‚æ•°å€¼ã€‚</li>
<li>æ‰€æœ‰å‡½æ•°éƒ½è¿”å›ä¸€ä¸ªå€¼ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šè¿”å›å€¼ï¼Œåˆ™ é»˜è®¤æŠŠè¯­å¥ return null; ä½œä¸ºå‡½æ•°çš„æœ€åä¸€ä¸ªè¯­å¥æ‰§è¡Œã€‚</li>
<li>å¯ä»¥æŠŠæ–¹æ³•å½“åšå‚æ•°è°ƒç”¨å¦ä¸€ä¸ªæ–¹æ³•ã€‚</li>
</ul>
<pre><code>printElement(element) {
  print(element);
}

var list = [1, 2, 3];

// Pass printElement as a parameter.
list.forEach(printElement);
</code></pre>
<ul>
<li>æ–¹æ³•ä¹Ÿå¯ä»¥èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡</li>
</ul>
<pre><code>var loudify = (msg) =&gt; '!!! ${msg.toUpperCase()} !!!';
assert(loudify('hello') == '!!! HELLO !!!');
</code></pre>
<h3 id="æ“ä½œç¬¦">æ“ä½œç¬¦</h3>
<ul>
<li>??</li>
</ul>
<pre><code>expr1 ?? expr2
å¦‚æœ expr1 æ˜¯ non-nullï¼Œè¿”å›å…¶å€¼ï¼› å¦åˆ™æ‰§è¡Œ expr2 å¹¶è¿”å›å…¶ç»“æœã€‚
</code></pre>
<ul>
<li>
<p>.? å¯ä»¥é¿å…è¡¨è¾¾å¼å·¦è¾¹å¯¹è±¡ä¸ºnullæ—¶å€™æŠ›å‡ºå¼‚å¸¸ã€‚</p>
</li>
<li>
<p>çº§è”æ“ä½œç¬¦,çº§è”æ“ä½œç¬¦ (..) å¯ä»¥åœ¨åŒä¸€ä¸ªå¯¹è±¡ä¸Š è¿ç»­è°ƒç”¨å¤šä¸ªå‡½æ•°ä»¥åŠè®¿é—®æˆå‘˜å˜é‡ã€‚</p>
</li>
</ul>
<pre><code>querySelector('#button') // Get an object.
  ..text = 'Confirm'   // Use its members.
  ..classes.add('important')
  ..onClick.listen((e) =&gt; window.alert('Confirmed!'));
</code></pre>
<ul>
<li>ç±»å‹åˆ¤å®šæ“ä½œç¬¦</li>
</ul>
<p>asã€ isã€ å’Œ is! æ“ä½œç¬¦æ˜¯åœ¨è¿è¡Œæ—¶åˆ¤å®šå¯¹è±¡ ç±»å‹çš„æ“ä½œç¬¦ï¼š</p>
<h4 id="as-ç±»å‹è½¬æ¢">as ç±»å‹è½¬æ¢</h4>
<h4 id="is-å¦‚æœå¯¹è±¡æ˜¯æŒ‡å®šçš„ç±»å‹è¿”å›-true">is å¦‚æœå¯¹è±¡æ˜¯æŒ‡å®šçš„ç±»å‹è¿”å› True</h4>
<h4 id="is-å¦‚æœå¯¹è±¡æ˜¯æŒ‡å®šçš„ç±»å‹è¿”å›-false">is! å¦‚æœå¯¹è±¡æ˜¯æŒ‡å®šçš„ç±»å‹è¿”å› False</h4>
<pre><code>åªæœ‰å½“ obj å®ç°äº† T çš„æ¥å£ï¼Œ obj is T æ‰æ˜¯ trueã€‚ä¾‹å¦‚ obj is Object æ€»æ˜¯ trueã€‚


</code></pre>
<h3 id="æ–­è¨€">æ–­è¨€</h3>
<p>Dartä¸­æ”¯æŒassertè¿™ä¸ªæ–­è¨€æ–¹æ³•ã€‚å¦‚æœæ–¹æ³•ç»“æœtrue,ç»§ç»­æ‰§è¡Œï¼Œå¦‚æœfalseåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚è¿™ä¸ªæ–¹æ³•åœ¨æ­£å¼åŒ…ä¸­å°†ä¸æ‰§è¡Œã€‚</p>
<pre><code>// assert(æ¡ä»¶);
</code></pre>
<p>##æ€»ç»“<br>
Dartå’ŒJavaè¿˜æ˜¯å¾ˆç›¸ä¼¼çš„ï¼Œå¯¹äºJavaç¨‹åºå‘˜ä¹Ÿæ˜¯ç›¸å¯¹å®¹æ˜“ä¸Šæ‰‹çš„ï¼Œç”±äºç°åœ¨æ˜¯åˆå­¦ï¼Œåªæ€»ç»“äº†ä¸€äº›å¸¸ç”¨çš„ï¼Œå½“ç„¶åŒºåˆ«è¿œè¿œä¸æ­¢è¿™äº›ï¼Œæ€»ç»“å¤§å¤šæ˜¯Dartä¸­æœ‰çš„Javaä¸­æ²¡æœ‰çš„ä¸œè¥¿ï¼Œä¼šä¸æ–­è¡¥å……ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ã€Flutterç¬”è®°ã€‘ä¹‹Flutterçš„ç†è§£]]></title>
        <id>http://xuanguofeng.com/post/ã€Flutterç¬”è®°ã€‘ä¹‹Flutterçš„ç†è§£</id>
        <link href="http://xuanguofeng.com/post/ã€Flutterç¬”è®°ã€‘ä¹‹Flutterçš„ç†è§£">
        </link>
        <updated>2018-07-02T09:43:39.000Z</updated>
        <summary type="html"><![CDATA[<p>ç›®å‰å¯¹Flutterçš„ç†è§£è¿˜æ˜¯å¾ˆå°‘çš„ï¼Œåªæ˜¯æƒ³ä½œä¸ºä¸€ä¸ªç¬”è®°ï¼Œåœ¨ä¸æ–­ç†è§£çš„åŸºç¡€ä¸Šè¿›è¡Œä¸æ–­çš„ä¿®æ”¹ä¸å®Œå–„ï¼ŒæŸ¥æ¼è¡¥ç¼ºï¼Œçœ‹çœ‹è‡ªå·±å­¦ä¹‹å‰ä¸å­¦ä¹‹åæ˜¯çš„ç†è§£æ˜¯ä¸€ä¸ªä»€ä¹ˆçŠ¶æ€ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>ç›®å‰å¯¹Flutterçš„ç†è§£è¿˜æ˜¯å¾ˆå°‘çš„ï¼Œåªæ˜¯æƒ³ä½œä¸ºä¸€ä¸ªç¬”è®°ï¼Œåœ¨ä¸æ–­ç†è§£çš„åŸºç¡€ä¸Šè¿›è¡Œä¸æ–­çš„ä¿®æ”¹ä¸å®Œå–„ï¼ŒæŸ¥æ¼è¡¥ç¼ºï¼Œçœ‹çœ‹è‡ªå·±å­¦ä¹‹å‰ä¸å­¦ä¹‹åæ˜¯çš„ç†è§£æ˜¯ä¸€ä¸ªä»€ä¹ˆçŠ¶æ€ã€‚</p>
<!-- more -->
<h2 id="flutterä»‹ç»">Flutterä»‹ç»</h2>
<p>Flutter æ˜¯è°·æ­Œçš„ç§»åŠ¨ç«¯ UI æ¡†æ¶ï¼Œå¯åœ¨æçŸ­çš„æ—¶é—´å†…æ„å»º Android å’Œ iOS ä¸Šé«˜è´¨é‡çš„åŸç”Ÿçº§åº”ç”¨ã€‚ Flutter å¯ä¸ç°æœ‰ä»£ç ä¸€èµ·å·¥ä½œ, å®ƒè¢«ä¸–ç•Œå„åœ°çš„å¼€å‘è€…å’Œç»„ç»‡ä½¿ç”¨, å¹¶ä¸” Flutter æ˜¯å…è´¹å’Œå¼€æºçš„.<br>
è¿™æ˜¯å®˜ç½‘çš„ä»‹ç»ï¼Œå¤§æ ‡é¢˜æ˜¯â€œä»¥æçŸ­çš„æ—¶é—´æ„å»ºä¼˜é›…çš„åŸç”Ÿçº§åº”ç”¨â€ï¼Œå¯ä»¥äº†è§£åˆ°Flutteræ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œé€šè¿‡è¿™ä¸ªæ¡†æ¶å¯ä»¥ä½¿ç”¨Dartè¯­è¨€é€šè¿‡ä¸€å¥—ä»£ç æ„å»ºAndroidå’ŒiOSåº”ç”¨ç¨‹åºã€‚</p>
<p>Flutteré‡Œé¢åŒæ—¶æä¾›äº†ä¸¤ç§UIåº“çš„é£æ ¼ï¼Œç¬¬ä¸€ç§è‚¯å®šæ˜¯Material Designé£æ ¼ï¼Œè¿˜è¦å°±æ˜¯Cupertinoé£æ ¼ï¼Œä¹Ÿå°±æ˜¯iOSä¸­é‡‡ç”¨çš„é£æ ¼ã€‚</p>
<p>ä¸ªäººç†è§£åº”è¯¥æ˜¯Flutterå°è£…äº†ä¸€å¥—å®Œæ•´çš„UIçš„APIï¼Œåœ¨å¼€å‘æ—¶å€™å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œé€šè¿‡å®˜ç½‘ä»‹ç»äº†è§£åº”è¯¥ä¹Ÿå¯ä»¥ç›´æ¥è°ƒç”¨Androidå’ŒiOSä¸­çš„åŸç”ŸAPIã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆä½¿ç”¨dartè¯­è¨€">ä¸ºä»€ä¹ˆä½¿ç”¨Dartè¯­è¨€ï¼Ÿ</h2>
<p>ä¸ªäººå¯¹å…¶ä»–è¯­è¨€å¹¶æ²¡æœ‰äº†è§£é‚£ä¹ˆæ·±ï¼Œè¿™ä¸ªé—®é¢˜åªæ˜¯è¯´ä¸‹è‡ªå·±çš„æƒ³æ³•å’Œåœ¨ç½‘ä¸ŠæŸ¥åˆ°çš„ä¸€äº›äººçš„è§è§£ã€‚</p>
<p>é¦–å…ˆæˆ‘ä¸€çœ¼çœ‹ä¸Šå»ï¼Œæ„Ÿè§‰Dartçš„æ ¼å¼å¹¶ä¸å‹å¥½ï¼Œç›¸æ¯”Kotlinè§‰å¾—æ›´æ˜¯å¯è¯»æ€§å·®å¾ˆå¤šï¼Œæ®çŸ¥ä¹ä¸Šä¸€ä½å¤§ç¥è¯´å’ŒFlutterçš„å·¥ç¨‹å¸ˆå’¨è¯¢ï¼Œæ˜¯å› ä¸ºDartçš„å›¢é˜Ÿè·ç¦»ä»–ä»¬å¾ˆè¿‘ï¼Œèƒ½å¾ˆå¥½çš„å¾—åˆ°æ”¯æŒï¼Œä¸çŸ¥é“æ˜¯å¦ç©ç¬‘ã€‚ç”¨Dartä»£ç å†™é¡µé¢è¿˜æ˜¯å¾ˆå®¹æ˜“ç†è§£çš„ï¼Œè‡³äºä¸mxlç›¸æ¯”å“ªç§æ–¹å¼æ›´å¥½ç°åœ¨æˆ‘è¿˜ä½“ä¼šä¸å¥½ï¼Œå› ä¸ºè¿˜æ²¡æœ‰æ·±åº¦æ˜¯ä½¿ç”¨Dartã€‚</p>
<p>DartåŒæ—¶æ”¯æŒAOTç¼–è¯‘å’ŒJITç¼–è¯‘ï¼ŒDartçš„ç¼–è¯‘å’Œæ‰§è¡Œä¸ä»…éå¸¸çµæ´»ï¼Œè€Œä¸”é€Ÿåº¦å¾ˆå¿«ã€‚è¿˜æœ‰æˆ‘è§‰å¾—Dartæ˜¯ç›¸å¯¹å®¹æ˜“å­¦ä¹ çš„ã€‚ç”¨Flautterçš„æ—¶å€™è¿˜æ”¯æŒçƒ­é‡è½½ï¼Œè¿™ç›¸æ¯”Instant Runçš„ä½“éªŒè¦å¥½å¾ˆå¤šçš„ï¼Œç¡®å®æé«˜äº†æ•ˆç‡ï¼Œä¸ä¼šå› ä¸ºåªæ”¹äº†ä¸€ç‚¹é¡µé¢è€Œç¼–è¯‘å¥½ä¹…çš„çŠ¶å†µã€‚Dartæ˜¯åŸºäºå•çº¿ç¨‹æ¨¡å‹çš„è¯­è¨€ï¼Œä½†æ˜¯ä¹Ÿæœ‰è‡ªå·±çš„æœºåˆ¶å«isolateã€‚ä¹‹é—´æ— æ³•ç›´æ¥å…±äº«å†…å­˜ï¼Œè¿™ä¹Ÿå°±æ˜¯é¿å…äº†å¤§éƒ¨åˆ†ä½¿ç”¨é”çš„æƒ…å†µã€‚</p>
<p>è¿˜æœ‰å°±æ˜¯è¿™æ˜¯Googleè‡ªå·±çš„è¯­è¨€ï¼Œä¹Ÿæ˜¯å¼€æºçš„ï¼Œä¸ä¼šæƒ¹å‡º88äº¿ç¾å…ƒçš„çš„å®˜å¸å§ã€‚æ€»ä½“æ„Ÿè§‰é€šè¿‡äº†è§£ï¼Œè¿˜æ˜¯ä¸€é—¨å¾ˆä¼˜ç§€çš„è¯­è¨€ï¼Œè€Œä¸”åœ¨Googleå†…å¤–æ®è¯´ä¹Ÿå¾—åˆ°å¾ˆå¥½çš„ä½¿ç”¨ï¼Œè€Œä¸”éšç€Flutterä»¥åŠæ–°ç³»ç»Ÿçš„æ¨å‡ºï¼Œè¿™é—¨è¯­è¨€ä¹Ÿæœ‰å¯èƒ½è¶Šæ¥è¶Šå¥½ï¼Œä¸è¿‡åé¢æƒ…å†µè°ä¹Ÿè¯´ä¸å¥½ï¼Œè¿˜è¦çœ‹Googleæ€ä¹ˆæ”¯æŒä¸æ¨å¹¿ã€‚</p>
<h2 id="flutteræ˜¯å¦‚ä½•æ¸²æŸ“ç•Œé¢çš„">Flutteræ˜¯å¦‚ä½•æ¸²æŸ“ç•Œé¢çš„ï¼Ÿ</h2>
<p>ç§»åŠ¨è®¾å¤‡ä¸­æœ‰GPUå’ŒCPUï¼Œä¸€èˆ¬æ˜¯GPUæ§åˆ¶å°†æ•°æ®æ¸²æŸ“åˆ°æ˜¾ç¤ºè®¾å¤‡ä¸Šçš„ï¼ŒGPUä¸»è¦æ˜¯é€šè¿‡å‘å‡ºVSyncåŒæ­¥ä¿¡å·å»å¸§æ•°æ®æ¥ä¼ é€’ç»™æ˜¾ç¤ºå™¨ã€‚</p>
<p>FPSè¡¨ç¤ºæ¯ç§’ä¼ é€’çš„å¸§æ•°ï¼Œæˆ‘ä»¬çŸ¥é“åœ¨ç†æƒ³æƒ…å†µä¸‹60FPSå°±æ„Ÿè§‰ä¸åˆ°çˆ±çœ‹ï¼Œè¿™æ„å‘³ç€æ¯ä¸ªç»˜åˆ¶æ—¶é•¿åº”è¯¥åœ¨16msä»¥å†…ï¼ŒAndroidç³»ç»Ÿæ¯éš”16mså‘å‡ºVSyncä¿¡å·ï¼Œè§¦å‘å¯¹UIè¿›è¡Œæ¸²æŸ“ï¼Œå¦‚æœæ¯æ¬¡æ¸²æŸ“éƒ½æˆåŠŸï¼Œè¿™æ ·å°±èƒ½å¤Ÿè¾¾åˆ°åˆ˜ç•…çš„ç”»é¢æ‰€éœ€çš„60FPSã€‚å¦‚æœæŸä¸ªæ“ä½œèŠ±è´¹å››ä»¶æ¯”è¾ƒåƒé•¿ æ¯”å¦‚ç”¨äº†30msï¼Œç³»ç»Ÿåœ¨å¾—åˆ°VSyncä¿¡å·æ—¶å°±æ— æ³•è¿›è¡Œæ­£å¸¸æ¸²æŸ“ï¼Œè¿™æ ·å°±å‘ç”Ÿäº†ä¸¢å¸§ç°è±¡ï¼Œå°±ä¼šæ„Ÿè§‰å¡é¡¿ã€‚<br>
æ‰€ä»¥ç©æ¸¸æˆçš„æ—¶å€™éœ€è¦æ›´å¥½çš„CPUä¸GPUçš„æ”¯æŒã€‚</p>
<p>Flutteråªå…³å¿ƒå‘GPUæä¾›è§†å›¾æ•°æ®ï¼Œåªå…³å¿ƒVSyncä¿¡å·ï¼Œç„¶åé€šè¿‡Googleè‡ªå·±çš„Skiaæ¸²æŸ“å¼•æ“æƒ³GPUæä¾›æ•°æ®ã€‚æ‰€ä»¥è¯´Flutteræ˜¯ç›´æ¥é€šè¿‡Skiaè‡ªå·±è¿›è¡Œæ¸²æŸ“ï¼Œè€Œä¸æ˜¯è°ƒç”¨æŸäº›APIï¼Œè¿™ä¹Ÿæ˜¯Flutterä¸€ç›´å®£ç§°åŸç”Ÿä½“éªŒçš„åŸå› ã€‚</p>
<h2 id="flutterå‰æ™¯å¦‚ä½•æ˜¯å¦å€¼å¾—å­¦ä¹ ">Flutterå‰æ™¯å¦‚ä½•ï¼Œæ˜¯å¦å€¼å¾—å­¦ä¹ ï¼Ÿ</h2>
<p>è¿™ä¸ªæ¯ä¸ªäººçš„çœ‹æ³•ä¸åŒï¼Œä¸ªäººè®¤ä¸ºå‰æ™¯è¿˜å¯ä»¥ï¼Œä¸React NativeåŸç†ä¸åŒï¼ŒFlutteræ˜¯é€šè¿‡è‡ªå·±æ¸²æŸ“ï¼Œå¯èƒ½ä¼šä½“éªŒä¼šæ›´å¥½ã€‚ä½¿ç”¨Dartè¯­è¨€ï¼Œè¿™é—¨è¯­è¨€ç›®å‰çœ‹æ¥è¯´å¯¹äºæœ‰ç¼–ç¨‹ç»éªŒçš„äººæ¥è¯´å¯èƒ½è¿˜æ˜¯ç›¸å¯¹å®¹æ˜“äº›çš„ï¼Œè€Œæ”¯æŒåº“ç›®å‰æ¥çœ‹ä¹Ÿè¿˜å¯ä»¥ï¼Œä¹Ÿè¦çœ‹Googleåç»­çš„åŠ¨ä½œå§ã€‚</p>
<p>å¯¹äºå…¬å¸æ¥è¯´å¦‚æœç»´æŠ¤ä¸€å¥—ä»£ç æ¥å®ç°ä¸¤ä¸ªç«¯æ— ç–‘æ—¶é—´å¥½äº‹ï¼Œä»èŠ‚çº¦æˆæœ¬ã€åˆ°æ–¹ä¾¿ç»´æŠ¤ã€ç•Œé¢ç»Ÿä¸€éƒ½æ˜¯å¾ˆå¥½çš„ï¼Œä½†æ˜¯Flutterå•†ç”¨åº”è¯¥ä»æœ‰ä¸€æ®µè·ç¦»å§ã€‚</p>
<p>å¦‚æœæœ‰æ—¶é—´åˆæœ‰å…´è¶£çš„è¯ï¼Œå¯ä»¥æä¸€ä¸‹çš„ï¼Œæ¯•ç«Ÿç¨‹åºå‘˜å°±æ˜¯åœ¨ä¸æ–­å­¦ä¹ çš„é“è·¯ä¸Šã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ã€Flutterç¬”è®°ã€‘ä¹‹ç¯å¢ƒæ­å»º]]></title>
        <id>http://xuanguofeng.com/post/ã€Flutterç¬”è®°ã€‘ä¹‹ç¯å¢ƒæ­å»º</id>
        <link href="http://xuanguofeng.com/post/ã€Flutterç¬”è®°ã€‘ä¹‹ç¯å¢ƒæ­å»º">
        </link>
        <updated>2018-06-28T07:10:08.000Z</updated>
        <summary type="html"><![CDATA[<p>Flutter æ˜¯ Google ç”¨ä»¥å¸®åŠ©å¼€å‘è€…åœ¨ iOS å’Œ Android ä¸¤ä¸ªå¹³å°å¼€å‘é«˜è´¨é‡åŸç”Ÿ UI çš„ç§»åŠ¨ SDKã€‚Flutter å…¼å®¹ç°æœ‰çš„ä»£ç ï¼Œå…è´¹ä¸”å¼€æºã€‚ä½¿ç”¨Dartè¯­è¨€ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>Flutter æ˜¯ Google ç”¨ä»¥å¸®åŠ©å¼€å‘è€…åœ¨ iOS å’Œ Android ä¸¤ä¸ªå¹³å°å¼€å‘é«˜è´¨é‡åŸç”Ÿ UI çš„ç§»åŠ¨ SDKã€‚Flutter å…¼å®¹ç°æœ‰çš„ä»£ç ï¼Œå…è´¹ä¸”å¼€æºã€‚ä½¿ç”¨Dartè¯­è¨€ã€‚</p>
<!-- more -->
<h2 id="åŸºäºandroid-studioç¯å¢ƒæ­å»º">åŸºäºAndroid Studioç¯å¢ƒæ­å»º</h2>
<p>æ”¯æŒflutterçš„IDE ç›®å‰æœ‰Android Studioã€ IntelliJã€Visual Studioã€‚</p>
<h3 id="å®‰è£…-flutter-å’Œ-dart-æ’ä»¶">å®‰è£… Flutter å’Œ Dart æ’ä»¶</h3>
<p>åœ¨Android Studioä¸­å®‰è£…è¿™ä¸¤ä¸ªæ’ä»¶ã€‚</p>
<ul>
<li>Flutter æ’ä»¶å¯ä»¥æé«˜ Flutter åœ¨å¼€å‘è¿‡ç¨‹ä¸­çš„å¼€å‘æ•ˆç‡ï¼ˆè¿è¡Œï¼Œè°ƒè¯•ï¼Œçƒ­é‡è½½ç­‰ç­‰ï¼‰ã€‚</li>
<li>Dart æ’ä»¶ææå‡äº†ä»£ç å±‚é¢çš„å¼€å‘æ•ˆç‡ï¼ˆåœ¨ä½ æ•²ä»£ç çš„åŒæ—¶è¿›è¡Œä»£ç æ ¡éªŒï¼Œä»£ç è‡ªåŠ¨è¡¥å…¨ç­‰ç­‰ï¼‰ã€‚</li>
</ul>
<h3 id="å®‰è£…æ­¥éª¤">å®‰è£…æ­¥éª¤</h3>
<ul>
<li>å¯åŠ¨ Android Studioã€‚</li>
<li>æ‰“å¼€æ’ä»¶è®¾ç½®ï¼ˆåœ¨ macOS ä¸Šè·¯å¾„ä¸º Preferences&gt;Pluginsï¼Œåœ¨ Windows å’Œ Linux ä¸Šè·¯å¾„ä¸º File&gt;Settings&gt;Pluginsï¼‰ã€‚</li>
<li>å½“å¼¹å‡ºå¯¹è¯æ¡†æç¤ºè¦å®‰è£… Dart æ’ä»¶çš„æ—¶å€™ï¼Œç‚¹å‡» Yes æ¥å—ã€‚</li>
<li>å¦‚æœå¼¹å‡º Restart éœ€è¦é‡å¯ç¼–è¾‘å™¨çš„æ—¶å€™ï¼Œç‚¹å‡» Yes æ¥å—ã€‚<br>
<img src="https://upload-images.jianshu.io/upload_images/1980287-2c1c28773b246f12.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="åˆ›å»ºFlutteré¡¹ç›®"><br>
ã€æ³¨æ„ã€‘<br>
ç¬¬ä¸€æ¬¡è¿è¡Œæ—¶å€™è¦é€‰æ‹©æŒ‡å®šçš„æ–‡ä»¶å¤¹ï¼Œç„¶åç‚¹å‡»install SDK æ¥å®‰è£…Flutter SDKç¯å¢ƒï¼Œå¯èƒ½éœ€è¦ä¸‹è½½ä¸€ä¼šã€‚</li>
</ul>
<h2 id="hello-word">Hello Word</h2>
<p>åœ¨Android Studioä¸­åˆ›å»ºé¡¹ç›®çš„æ—¶å€™ä¼šæœ‰New Flutter Projecté€‰é¡¹è¿™æ—¶å€™å¦‚æœæœ¬åœ°æ²¡æœ‰Flutterç¯å¢ƒçš„è¯ ä¼šè®©ä½ ä¸‹è½½ã€‚</p>
<p>åˆ›å»ºåå¯ä»¥çœ‹åˆ°IDEçš„å³ä¸Šè§’æœ‰äº›åŠŸèƒ½æŒ‰é’®ã€‚<br>
<img src="https://upload-images.jianshu.io/upload_images/1980287-f98ccb4eaaa2d27a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é¡¹ç›®ç›®å½•ç»“æ„"><br>
å¯ä»¥çœ‹åˆ°è¿™é‡Œä¸ä½†æœ‰Androidçš„ç›®å½•ï¼Œè¿˜æœ‰iOSçš„ç›®å½•ï¼Œè¿è¡Œçš„æ—¶å€™å¦‚æœæœ‰iOSè®¾å¤‡ä»¥åŠæ¨¡æ‹Ÿå™¨çš„è¯ æ˜¯å¯ä»¥ç›´æ¥é€‰æ‹©è¿è¡Œçš„ã€‚</p>
<p>å³ä¾§é—ªç”µçš„æ ‡å¿—æ”¯æŒçƒ­é‡è½½ç¼–è¯‘è¿è¡Œã€‚</p>
<figure data-type="image" tabindex="1"><img src="https://upload-images.jianshu.io/upload_images/1980287-fb8c9b740ab9da93.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è¿è¡Œæ•ˆæœ"></figure>
<p>ç”±äºæˆ‘æ˜¯macç”µè„‘ï¼Œç‰¹æ„é€‰äº†ä¸€ä¸ªiOSæ¨¡æ‹Ÿå™¨ï¼Œåœ¨Android Studioç›´æ¥è¿è¡Œåœ¨iOSè®¾å¤‡ä¸Šè¿˜æ˜¯å¾ˆçˆ½çš„ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Androidçƒ­é—¨å¼€æºæ¡†æ¶-OkHttpæºç æ¢ç©¶äº”]]></title>
        <id>http://xuanguofeng.com/post/OkHttp_No.5</id>
        <link href="http://xuanguofeng.com/post/OkHttp_No.5">
        </link>
        <updated>2017-12-30T08:21:55.000Z</updated>
        <summary type="html"><![CDATA[<p>å‰é¢åŸºæœ¬ä»‹ç»äº†OkHttpçš„æµç¨‹ä»¥åŠæºç ï¼Œè¿™é‡Œçœ‹æœ€åä¸€ä¸ªé‡è¦çš„æ ¸å¿ƒæºç OkHttpä¸­çš„æ‹¦æˆªå™¨ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>å‰é¢åŸºæœ¬ä»‹ç»äº†OkHttpçš„æµç¨‹ä»¥åŠæºç ï¼Œè¿™é‡Œçœ‹æœ€åä¸€ä¸ªé‡è¦çš„æ ¸å¿ƒæºç OkHttpä¸­çš„æ‹¦æˆªå™¨ã€‚</p>
<!-- more-->
<h2 id="æ‹¦æˆªå™¨æœºåˆ¶">æ‹¦æˆªå™¨æœºåˆ¶</h2>
<p>æ‹¦æˆªå™¨æ˜¯OkHttpä¸­ä¸€ä¸ªå¼ºå¤§çš„æœºåˆ¶ï¼Œèƒ½å®ç°ç½‘ç»œç›‘å¬ï¼Œè¯·æ±‚ä»¥åŠå“åº”é‡å†™ï¼Œè¯·ç¤ºå¤±è´¥é‡è¯•ç­‰åŠŸèƒ½ã€‚</p>
<h2 id="æ‹¦æˆªå™¨é“¾">æ‹¦æˆªå™¨é“¾</h2>
<figure data-type="image" tabindex="1"><img src="http://upload-images.jianshu.io/upload_images/1980287-577aecbf9dea4152.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è¿æ¥å™¨ç»ƒæµç¨‹å›¾"></figure>
<h2 id="getresponsewithinterceptorchain-æ–¹æ³•">getResponseWithInterceptorChain  æ–¹æ³•</h2>
<p>ä¹‹å‰è¯´åˆ°ä¸»è¦æ˜¯é€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥è¿”å›responseé‚£ä¹ˆæ¥çœ‹çœ‹è¿™ä¸ªæ–¹æ³•é‡Œç©¶ç«Ÿæ˜¯åšäº†ä»€ä¹ˆå‘¢</p>
<pre><code> Response getResponseWithInterceptorChain() throws IOException {
    // Build a full stack of interceptors.
    List&lt;Interceptor&gt; interceptors = new ArrayList&lt;&gt;();
    interceptors.addAll(client.interceptors());
    interceptors.add(retryAndFollowUpInterceptor);
    interceptors.add(new BridgeInterceptor(client.cookieJar()));
    interceptors.add(new CacheInterceptor(client.internalCache()));
    interceptors.add(new ConnectInterceptor(client));
    if (!forWebSocket) {
      interceptors.addAll(client.networkInterceptors());
    }
    interceptors.add(new CallServerInterceptor(forWebSocket));

    Interceptor.Chain chain = new RealInterceptorChain(interceptors, null, null, null, 0,
        originalRequest, this, eventListener, client.connectTimeoutMillis(),
        client.readTimeoutMillis(), client.writeTimeoutMillis());

    return chain.proceed(originalRequest);
  }
</code></pre>
<p>é¦–å…ˆæ·»åŠ è‡ªå®šä¹‰é…ç½®çš„æ‹¦æˆªå™¨</p>
<p>ç„¶åä»¥æ­¤æ·»åŠ ç³»ç»Ÿå†…ç½®çš„æ‹¦æˆªå™¨</p>
<p>ç„¶ååˆ›å»ºRealInterceptorChainå¹¶æŠŠè¿™ä¸ªé›†åˆæ·»åŠ è¿›å»ï¼Œè¿™ä¸ªå°±æ˜¯ä¸ªæ‹¦æˆªå™¨é“¾</p>
<p>é€šè¿‡chain.proceed(originalRequest);è¿™ä¸ªæ–¹æ³•æ‰§è¡Œ</p>
<p>proceedè¿™ä¸ªæ–¹æ³•ä¹Ÿå¾ˆé‡è¦ å¯ä»¥çœ‹ä¸€ä¸‹</p>
<pre><code> public Response proceed(Request request, StreamAllocation streamAllocation, HttpCodec httpCodec,
      RealConnection connection) throws IOException {
    if (index &gt;= interceptors.size()) throw new AssertionError();

    calls++;

    // If we already have a stream, confirm that the incoming request will use it.
    if (this.httpCodec != null &amp;&amp; !this.connection.supportsUrl(request.url())) {
      throw new IllegalStateException(&quot;network interceptor &quot; + interceptors.get(index - 1)
          + &quot; must retain the same host and port&quot;);
    }

    // If we already have a stream, confirm that this is the only call to chain.proceed().
    if (this.httpCodec != null &amp;&amp; calls &gt; 1) {
      throw new IllegalStateException(&quot;network interceptor &quot; + interceptors.get(index - 1)
          + &quot; must call proceed() exactly once&quot;);
    }

    //æ³¨æ„å¤„
    // Call the next interceptor in the chain.
    RealInterceptorChain next = new RealInterceptorChain(interceptors, streamAllocation, httpCodec,
        connection, index + 1, request, call, eventListener, connectTimeout, readTimeout,
        writeTimeout);
    Interceptor interceptor = interceptors.get(index);
    Response response = interceptor.intercept(next);

    // Confirm that the next interceptor made its required call to chain.proceed().
    if (httpCodec != null &amp;&amp; index + 1 &lt; interceptors.size() &amp;&amp; next.calls != 1) {
      throw new IllegalStateException(&quot;network interceptor &quot; + interceptor
          + &quot; must call proceed() exactly once&quot;);
    }

    // Confirm that the intercepted response isn't null.
    if (response == null) {
      throw new NullPointerException(&quot;interceptor &quot; + interceptor + &quot; returned null&quot;);
    }

    if (response.body() == null) {
      throw new IllegalStateException(
          &quot;interceptor &quot; + interceptor + &quot; returned a response with no body&quot;);
    }

    return response;
  }
</code></pre>
<p>è¿™é‡Œä¸»è¦çœ‹æ ‡æ³¨çš„æ³¨æ„å¤„  è¿™é‡Œä¸»è¦é€šè¿‡index+1åˆ›å»ºäº†ä¸‹ä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œä¹Ÿå°±è¡Œç¨‹äº†æ‹¦æˆªå™¨é“¾</p>
<p>ç„¶åé€šè¿‡æ¯ä¸ªæ‹¦æˆªå™¨ä¸­éƒ½æœ‰interceptè¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¸­è¿”å›responseç„¶åè¿›è¡Œè¿”å›ã€‚</p>
<p>è¿™é‡Œæœ‰ä¸ªæµç¨‹æ˜¯å¾ˆæœ‰æ„æ€çš„å°±æ˜¯åœ¨proceed()æ–¹æ³•é‡Œä¼šä¼šè¿”å›ä¸€ä¸ªResponse è€Œ è¿™ä¸ªResponseæ˜¯é€šè¿‡intercep()è¿™ä¸ªæ–¹æ³•å¹¶ä¼ å…¥ä¸€ä¸ªæ‹¦æˆªå™¨è¿”å›çš„ï¼Œè€Œåœ¨å„ä¸ªæ‹¦æˆªå™¨ä¸­åˆé€šè¿‡ä¼ å…¥çš„æ‹¦æˆªå™¨è°ƒå›å»ï¼Œè¿™ä¹Ÿæ˜¯æ‹¦æˆªå™¨æµç¨‹çš„æ ¸å¿ƒæœºåˆ¶ã€‚ä»è€Œå®ç°äº†æ‹¦æˆªå™¨é“¾ï¼Œåªæœ‰æ‰€æœ‰çš„æ‹¦æˆªå™¨æ‰§è¡Œå®Œæ¯•åï¼Œä¸€ä¸ªç½‘ç»œè¯·æ±‚çš„å“åº”response æ‰ä¼šè¢«è¿”å›ã€‚</p>
<h2 id="å†…ç½®æ‹¦æˆªå™¨">å†…ç½®æ‹¦æˆªå™¨</h2>
<figure data-type="image" tabindex="2"><img src="http://upload-images.jianshu.io/upload_images/1980287-73b7d59f185d741e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å±å¹•å¿«ç…§ 2018-01-02 ä¸‹åˆ5.48.12.png"></figure>
<p>OkHttpä¸­çš„å†…ç½®è¿æ¥å™¨éƒ½åŸºå®ç°äº†é€šç”¨çš„æ¥å£</p>
<h3 id="retryandfollowupinterceptor-æ¥å£é‡å®šå‘æ‹¦æˆªå™¨">RetryAndFollowUpInterceptor æ¥å£é‡å®šå‘æ‹¦æˆªå™¨</h3>
<p>è¿™ä¸ªæ‹¦æˆªå™¨ä¸»è¦æ˜¯æ ¹æ®ç»“æœåˆ¤æ–­ç„¶åè¿›è¡Œé‡è¯•çš„æ‹¦æˆªå™¨</p>
<pre><code> @Override public Response intercept(Chain chain) throws IOException {
    Request request = chain.request();
    RealInterceptorChain realChain = (RealInterceptorChain) chain;
    Call call = realChain.call();
    EventListener eventListener = realChain.eventListener();

    streamAllocation = new StreamAllocation(client.connectionPool(), createAddress(request.url()),
        call, eventListener, callStackTrace);

    int followUpCount = 0;
    Response priorResponse = null;
    while (true) {
      if (canceled) {//æ³¨æ„å¤„1
        streamAllocation.release();
        throw new IOException(&quot;Canceled&quot;);
      }

      Response response;
      boolean releaseConnection = true;
      try {//æ³¨æ„å¤„2
        response = realChain.proceed(request, streamAllocation, null, null);
        releaseConnection = false;
      } catch (RouteException e) {
        // The attempt to connect via a route failed. The request will not have been sent.
        if (!recover(e.getLastConnectException(), false, request)) {
          throw e.getLastConnectException();
        }
        releaseConnection = false;
        continue;
      } catch (IOException e) {
        // An attempt to communicate with a server failed. The request may have been sent.
        boolean requestSendStarted = !(e instanceof ConnectionShutdownException);
        if (!recover(e, requestSendStarted, request)) throw e;
        releaseConnection = false;
        continue;
      } finally {
        // We're throwing an unchecked exception. Release any resources.
        if (releaseConnection) {
          streamAllocation.streamFailed(null);
          streamAllocation.release();
        }
      }

      // Attach the prior response if it exists. Such responses never have a body.
      if (priorResponse != null) {
        response = response.newBuilder()
            .priorResponse(priorResponse.newBuilder()
                    .body(null)
                    .build())
            .build();
      }

      Request followUp = followUpRequest(response);

      if (followUp == null) {
        if (!forWebSocket) {
          streamAllocation.release();
        }
        return response;
      }

      closeQuietly(response.body());

      if (++followUpCount &gt; MAX_FOLLOW_UPS) {
        streamAllocation.release();
        throw new ProtocolException(&quot;Too many follow-up requests: &quot; + followUpCount);
      }

      if (followUp.body() instanceof UnrepeatableRequestBody) {
        streamAllocation.release();
        throw new HttpRetryException(&quot;Cannot retry streamed HTTP body&quot;, response.code());
      }

      if (!sameConnection(response, followUp.url())) {
        streamAllocation.release();
        streamAllocation = new StreamAllocation(client.connectionPool(),
            createAddress(followUp.url()), call, eventListener, callStackTrace);
      } else if (streamAllocation.codec() != null) {
        throw new IllegalStateException(&quot;Closing the body of &quot; + response
            + &quot; didn't close its backing stream. Bad interceptor?&quot;);
      }

      request = followUp;
      priorResponse = response;
    }
  }
</code></pre>
<p>å…·ä½“åˆ†æä¸‹æµç¨‹<br>
é¦–å…ˆä¼šåˆ›å»ºä¸€ä¸ªStreamAllocationå¯¹è±¡</p>
<p>å…¶å®ä¸»è¦çœ‹whileå¾ªç¯é‡Œé¢çš„æ–¹æ³•ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªæ­»å¾ªç¯æ¥è¿›è¡Œå°è¯•ï¼Œé¦–å…ˆä¼šåˆ¤æ–­æ˜¯å¦å–æ¶ˆäº†è¯·æ±‚ï¼Œå¦‚æœå–æ¶ˆè¿›è¡Œé‡Šæ”¾ï¼Œå¹¶æŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æ³¨æ„å¤„1.</p>
<p>ç„¶åä¸»æ³¨æ„å¤„2è¦è¿›è¡Œè¯·æ±‚ï¼Œç„¶åé€šè¿‡catchåˆ¤æ–­å„ç§éœ€è¦é‡æ–°è¿æ¥çš„æƒ…å†µï¼Œå¦‚æœé‡æ–°è¿æ¥å°±é€šè¿‡continueç›´æ¥åœ¨è¿›è¡Œä¸€éå¾ªç¯ã€‚</p>
<p>å½“ä»£ç å¯ä»¥æ‰§è¡Œåˆ° followUpRequest æ–¹æ³•å°±è¡¨ç¤ºè¿™ä¸ªè¯·æ±‚æ˜¯æˆåŠŸçš„ï¼Œä½†æ˜¯æœåŠ¡å™¨è¿”å›çš„çŠ¶æ€ç å¯èƒ½ä¸æ˜¯ 200 ok çš„æƒ…å†µï¼Œè¿™æ—¶è¿˜éœ€è¦å¯¹è¯¥è¯·æ±‚è¿›è¡Œæ£€æµ‹ï¼Œå…¶ä¸»è¦å°±æ˜¯é€šè¿‡è¿”å›ç è¿›è¡Œåˆ¤æ–­çš„ï¼Œç„¶åå¦‚æœæ²¡é—®é¢˜å°±ä¼šè¿”å›respnseå¹¶ç»“æŸå¾ªç¯ã€‚</p>
<p>å¦‚æœæ²¡æœ‰æ­£å¸¸è¿”å›ç»“æœçš„è¯åé¢ä¼šå…³é—­è¯·æ±‚è¿˜ä¼šåšä¸€äº›å¼‚å¸¸æ£€æŸ¥ï¼Œå¦‚é‡æ–°è¿æ¥çš„æ¬¡æ•°æ˜¯å¦è¶…è¿‡äº†æœ€å¤§æ¬¡æ•°ä¹‹ç±»çš„ã€‚</p>
<h3 id="bridgeinterceptor-è¯·æ±‚å’Œå“åº”è½¬åŒ–æ‹¦æˆªå™¨">BridgeInterceptor è¯·æ±‚å’Œå“åº”è½¬åŒ–æ‹¦æˆªå™¨</h3>
<p>è¿™ä¸ªæ‹¦æˆªå™¨ä¸»è¦è´Ÿè´£è®¾ç½®å†…å®¹é•¿åº¦ï¼Œç¼–ç æ–¹å¼ä»¥åŠä¸€äº›å‹ç¼©ç­‰é…ç½®ï¼Œä¸»è¦æ˜¯æ·»åŠ å¤´éƒ¨ä¿¡æ¯çš„åŠŸèƒ½ã€‚</p>
<pre><code> @Override public Response intercept(Chain chain) throws IOException {
    Request userRequest = chain.request();
    Request.Builder requestBuilder = userRequest.newBuilder();

    RequestBody body = userRequest.body();
    if (body != null) {
      MediaType contentType = body.contentType();
      if (contentType != null) {
        requestBuilder.header(&quot;Content-Type&quot;, contentType.toString());
      }

      long contentLength = body.contentLength();
      if (contentLength != -1) {
        requestBuilder.header(&quot;Content-Length&quot;, Long.toString(contentLength));
        requestBuilder.removeHeader(&quot;Transfer-Encoding&quot;);
      } else {
        requestBuilder.header(&quot;Transfer-Encoding&quot;, &quot;chunked&quot;);
        requestBuilder.removeHeader(&quot;Content-Length&quot;);
      }
    }

    if (userRequest.header(&quot;Host&quot;) == null) {
      requestBuilder.header(&quot;Host&quot;, hostHeader(userRequest.url(), false));
    }

    if (userRequest.header(&quot;Connection&quot;) == null) {
      requestBuilder.header(&quot;Connection&quot;, &quot;Keep-Alive&quot;);
    }

    // If we add an &quot;Accept-Encoding: gzip&quot; header field we're responsible for also decompressing
    // the transfer stream.
    boolean transparentGzip = false;
    if (userRequest.header(&quot;Accept-Encoding&quot;) == null &amp;&amp; userRequest.header(&quot;Range&quot;) == null) {
      transparentGzip = true;
      requestBuilder.header(&quot;Accept-Encoding&quot;, &quot;gzip&quot;);
    }

    List&lt;Cookie&gt; cookies = cookieJar.loadForRequest(userRequest.url());
    if (!cookies.isEmpty()) {
      requestBuilder.header(&quot;Cookie&quot;, cookieHeader(cookies));
    }

    if (userRequest.header(&quot;User-Agent&quot;) == null) {
      requestBuilder.header(&quot;User-Agent&quot;, Version.userAgent());
    }

    Response networkResponse = chain.proceed(requestBuilder.build());

    HttpHeaders.receiveHeaders(cookieJar, userRequest.url(), networkResponse.headers());

    Response.Builder responseBuilder = networkResponse.newBuilder()
        .request(userRequest);

    if (transparentGzip
        &amp;&amp; &quot;gzip&quot;.equalsIgnoreCase(networkResponse.header(&quot;Content-Encoding&quot;))
        &amp;&amp; HttpHeaders.hasBody(networkResponse)) {
      GzipSource responseBody = new GzipSource(networkResponse.body().source());
      Headers strippedHeaders = networkResponse.headers().newBuilder()
          .removeAll(&quot;Content-Encoding&quot;)
          .removeAll(&quot;Content-Length&quot;)
          .build();
      responseBuilder.headers(strippedHeaders);
      String contentType = networkResponse.header(&quot;Content-Type&quot;);
      responseBuilder.body(new RealResponseBody(contentType, -1L, Okio.buffer(responseBody)));
    }

    return responseBuilder.build();
  }
</code></pre>
<p>è¿™é‡Œé€šè¿‡æ³¨æ„å‡ºå¯ä»¥çœ‹åˆ°å…¶ä¸­ä¸€ä¸ªä¸»è¦çš„åŠŸèƒ½å°±æ˜¯ï¼Œå¦‚æœåˆšå¼€å§‹æˆ‘ä»¬æ²¡æœ‰é…ç½®ä¸€äº›è¯·æ±‚å¤´ä¿¡æ¯ä¼šæ·»åŠ ä¸€äº›é»˜è®¤çš„è¯·æ±‚å¤´ä¿¡æ¯ã€‚</p>
<p>è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªé‡è¦åŠŸèƒ½å°±æ˜¯ åˆ¤æ–­æ˜¯å¦éœ€è¦ä½¿ç”¨Gzipå‹ç¼©åŠŸèƒ½ã€‚ä»¥åŠå°†ç½‘ç»œè¯·æ±‚å›æ¥çš„å“åº”Responseè½¬åŒ–ä¸ºæ°¸åå¯ç”¨çš„response</p>
<h3 id="cacheinterceptor-ç¼“å­˜æ‹¦æˆªå™¨">CacheInterceptor ç¼“å­˜æ‹¦æˆªå™¨</h3>
<pre><code>@Override public Response intercept(Chain chain) throws IOException {
   Response cacheCandidate = cache != null
       ? cache.get(chain.request())
       : null;

   long now = System.currentTimeMillis();

   CacheStrategy strategy = new CacheStrategy.Factory(now, chain.request(), cacheCandidate).get();
   Request networkRequest = strategy.networkRequest;
   Response cacheResponse = strategy.cacheResponse;

   if (cache != null) {
     cache.trackResponse(strategy);
   }

   if (cacheCandidate != null &amp;&amp; cacheResponse == null) {
     closeQuietly(cacheCandidate.body()); // The cache candidate wasn't applicable. Close it.
   }

   // If we're forbidden from using the network and the cache is insufficient, fail.
   if (networkRequest == null &amp;&amp; cacheResponse == null) {
     return new Response.Builder()
         .request(chain.request())
         .protocol(Protocol.HTTP_1_1)
         .code(504)
         .message(&quot;Unsatisfiable Request (only-if-cached)&quot;)
         .body(Util.EMPTY_RESPONSE)
         .sentRequestAtMillis(-1L)
         .receivedResponseAtMillis(System.currentTimeMillis())
         .build();
   }

   // If we don't need the network, we're done.
   if (networkRequest == null) {
     return cacheResponse.newBuilder()
         .cacheResponse(stripBody(cacheResponse))
         .build();
   }

   Response networkResponse = null;
   try {
     networkResponse = chain.proceed(networkRequest);
   } finally {
     // If we're crashing on I/O or otherwise, don't leak the cache body.
     if (networkResponse == null &amp;&amp; cacheCandidate != null) {
       closeQuietly(cacheCandidate.body());
     }
   }

   // If we have a cache response too, then we're doing a conditional get.
   if (cacheResponse != null) {
     if (networkResponse.code() == HTTP_NOT_MODIFIED) {
       Response response = cacheResponse.newBuilder()
           .headers(combine(cacheResponse.headers(), networkResponse.headers()))
           .sentRequestAtMillis(networkResponse.sentRequestAtMillis())
           .receivedResponseAtMillis(networkResponse.receivedResponseAtMillis())
           .cacheResponse(stripBody(cacheResponse))
           .networkResponse(stripBody(networkResponse))
           .build();
       networkResponse.body().close();

       // Update the cache after combining headers but before stripping the
       // Content-Encoding header (as performed by initContentStream()).
       cache.trackConditionalCacheHit();
       cache.update(cacheResponse, response);
       return response;
     } else {
       closeQuietly(cacheResponse.body());
     }
   }

   Response response = networkResponse.newBuilder()
       .cacheResponse(stripBody(cacheResponse))
       .networkResponse(stripBody(networkResponse))
       .build();

   if (cache != null) {
     if (HttpHeaders.hasBody(response) &amp;&amp; CacheStrategy.isCacheable(response, networkRequest)) {
       // Offer this request to the cache.
       CacheRequest cacheRequest = cache.put(response);
       return cacheWritingResponse(cacheRequest, response);
     }

     if (HttpMethod.invalidatesCache(networkRequest.method())) {
       try {
         cache.remove(networkRequest);
       } catch (IOException ignored) {
         // The cache cannot be written.
       }
     }
   }

   return response;
 }
</code></pre>
<p>ä¸»è¦æµç¨‹ï¼Œå…ˆåˆ¤æ–­æ˜¯å¦æœ‰ç¼“å­˜ã€‚ç„¶åå¦‚æœç¼“å­˜ä¸å¯ç”¨ä¼šå…³é—­ï¼Œç„¶ååœ¨ä¼šåˆ¤æ–­ç½‘ç»œç¦æ­¢çš„è¯å’Œç¼“å­˜éƒ½ä¸å¯ç”¨çš„è¯ä¼šåˆ›å»ºä¸€ä¸ªå“åº”è¿”å›504</p>
<pre><code>   // If we're forbidden from using the network and the cache is insufficient, fail.
    if (networkRequest == null &amp;&amp; cacheResponse == null) {
      return new Response.Builder()
          .request(chain.request())
          .protocol(Protocol.HTTP_1_1)
          .code(504)
          .message(&quot;Unsatisfiable Request (only-if-cached)&quot;)
          .body(Util.EMPTY_RESPONSE)
          .sentRequestAtMillis(-1L)
          .receivedResponseAtMillis(System.currentTimeMillis())
          .build();
    }
</code></pre>
<p>å¦‚æœå‰é¢çš„æ¡ä»¶éƒ½ä¸ç¬¦åˆï¼Œä¼šè¯»å–ç½‘ç»œç»“æœä¹Ÿå°±æ˜¯ä¼šè·³è½¬åˆ°ä¸‹ä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œ if (networkResponse.code() == HTTP_NOT_MODIFIED)  è¿™é‡Œä¼šåˆ¤æ–­å¦‚æœæ˜¯304çš„è¯ä½¿ç”¨ç¼“å­˜ï¼Œè¿˜ä¼šå¯¹ç¼“å­˜è¿›è¡Œæ¯”å¯¹å’Œæ›´æ–°ã€‚ç„¶åå¹¶è¿”å›responseã€‚åœ¨è¿™ä¹‹å‰ä¼šå…ˆåˆ¤æ–­cacheResponseæ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºåˆ™èµ°åé¢çš„ä»£ç ï¼Œä¼šåˆ›å»ºä¸€ä¸ªresponseã€‚</p>
<h3 id="connectinterceptor-ç½‘ç»œè¿æ¥æ‹¦æˆªå™¨">ConnectInterceptor ç½‘ç»œè¿æ¥æ‹¦æˆªå™¨</h3>
<pre><code>@Override public Response intercept(Chain chain) throws IOException {
    RealInterceptorChain realChain = (RealInterceptorChain) chain;
    Request request = realChain.request();
    StreamAllocation streamAllocation = realChain.streamAllocation();

    // We need the network to satisfy this request. Possibly for validating a conditional GET.
    boolean doExtensiveHealthChecks = !request.method().equals(&quot;GET&quot;);
    HttpCodec httpCodec = streamAllocation.newStream(client, chain, doExtensiveHealthChecks);
    RealConnection connection = streamAllocation.connection();

    return realChain.proceed(request, streamAllocation, httpCodec, connection);
  }
</code></pre>
<p>è¿™é‡Œçš„StreamAllocationå…¶å®æ˜¯åœ¨é‡å®šå‘æ‹¦æˆªå™¨ä¸­åˆ›å»ºï¼Œä½†æ˜¯ä»–ä¼ å…¥åˆ°ConnectInterceptorä¸­è¿›è¡Œä½¿ç”¨ã€‚ç„¶åä¼šé€šè¿‡streamAllocationæ¥åˆ›å»ºhttpCodecï¼ŒhttpCodecç”¨æ¥ç¼–ç requestå’Œè§£ç responseã€‚ç„¶åä¼šé€šè¿‡streamAllocation.connection();æ¥åˆ›å»ºä¸€ä¸ªRealConnectionï¼ŒRealConnectionä¸»è¦æ¥è¿›è¡Œå®é™…çš„ç½‘ç»œä¼ è¾“ã€‚ç„¶åè¿˜æ˜¯é€šè¿‡proceedæ–¹æ³•ä¼ å…¥åˆ°ä¸‹ä¸€ä¸ªæ‹¦æˆªå™¨ã€‚</p>
<h3 id="callserverinterceptor">CallServerInterceptor</h3>
<p>è¿™ä¸ªæ‹¦æˆªå™¨æ˜¯æ‹¦æˆªå™¨é“¾ä¸­æœ€åä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œæ˜¯çœŸæ­£çš„å‘èµ·è¯·æ±‚å’Œå¤„ç†è¿”å›å“åº”çš„æ‹¦æˆªå™¨ã€‚</p>
<pre><code>@Override public Response intercept(Chain chain) throws IOException {
   RealInterceptorChain realChain = (RealInterceptorChain) chain;
   HttpCodec httpCodec = realChain.httpStream();
   StreamAllocation streamAllocation = realChain.streamAllocation();
   RealConnection connection = (RealConnection) realChain.connection();
   Request request = realChain.request();

   long sentRequestMillis = System.currentTimeMillis();

   realChain.eventListener().requestHeadersStart(realChain.call());
   httpCodec.writeRequestHeaders(request);
   realChain.eventListener().requestHeadersEnd(realChain.call(), request);

   Response.Builder responseBuilder = null;
   if (HttpMethod.permitsRequestBody(request.method()) &amp;&amp; request.body() != null) {
     // If there's a &quot;Expect: 100-continue&quot; header on the request, wait for a &quot;HTTP/1.1 100
     // Continue&quot; response before transmitting the request body. If we don't get that, return
     // what we did get (such as a 4xx response) without ever transmitting the request body.
     if (&quot;100-continue&quot;.equalsIgnoreCase(request.header(&quot;Expect&quot;))) {
       httpCodec.flushRequest();
       realChain.eventListener().responseHeadersStart(realChain.call());
       responseBuilder = httpCodec.readResponseHeaders(true);
     }

     if (responseBuilder == null) {
       // Write the request body if the &quot;Expect: 100-continue&quot; expectation was met.
       realChain.eventListener().requestBodyStart(realChain.call());
       long contentLength = request.body().contentLength();
       CountingSink requestBodyOut =
           new CountingSink(httpCodec.createRequestBody(request, contentLength));
       BufferedSink bufferedRequestBody = Okio.buffer(requestBodyOut);

       request.body().writeTo(bufferedRequestBody);
       bufferedRequestBody.close();
       realChain.eventListener()
           .requestBodyEnd(realChain.call(), requestBodyOut.successfulCount);
     } else if (!connection.isMultiplexed()) {
       // If the &quot;Expect: 100-continue&quot; expectation wasn't met, prevent the HTTP/1 connection
       // from being reused. Otherwise we're still obligated to transmit the request body to
       // leave the connection in a consistent state.
       streamAllocation.noNewStreams();
     }
   }

   httpCodec.finishRequest();

   if (responseBuilder == null) {
     realChain.eventListener().responseHeadersStart(realChain.call());
     responseBuilder = httpCodec.readResponseHeaders(false);
   }

   Response response = responseBuilder
       .request(request)
       .handshake(streamAllocation.connection().handshake())
       .sentRequestAtMillis(sentRequestMillis)
       .receivedResponseAtMillis(System.currentTimeMillis())
       .build();

   realChain.eventListener()
       .responseHeadersEnd(realChain.call(), response);

   int code = response.code();
   if (forWebSocket &amp;&amp; code == 101) {
     // Connection is upgrading, but we need to ensure interceptors see a non-null response body.
     response = response.newBuilder()
         .body(Util.EMPTY_RESPONSE)
         .build();
   } else {
     response = response.newBuilder()
         .body(httpCodec.openResponseBody(response))
         .build();
   }

   if (&quot;close&quot;.equalsIgnoreCase(response.request().header(&quot;Connection&quot;))
       || &quot;close&quot;.equalsIgnoreCase(response.header(&quot;Connection&quot;))) {
     streamAllocation.noNewStreams();
   }

   if ((code == 204 || code == 205) &amp;&amp; response.body().contentLength() &gt; 0) {
     throw new ProtocolException(
         &quot;HTTP &quot; + code + &quot; had non-zero Content-Length: &quot; + response.body().contentLength());
   }

   return response;
 }
</code></pre>
<p>æµç¨‹<br>
è¿™é‡Œé¦–å…ˆä¼šè·å–åˆ°ä¹‹å‰å„ä¸ªæ‹¦æˆªå™¨ä¸­çš„ä¸€äº›å‚æ•°ï¼Œé¦–å…ˆä¼š httpCodec.writeRequestHeaders(request);é€šè¿‡è¿™ä¸ªhttpCodecå†™å…¥è¯·æ±‚å¤´ä¿¡æ¯ï¼Œç„¶åä¼šå†™å…¥è¯·æ±‚çš„bodyä¿¡æ¯ï¼Œå®Œæˆå†™å…¥åä¼šè°ƒç”¨  httpCodec.finishRequest();<br>
æ–¹æ³•è¡¨ç¤ºå†™å…¥ä¿¡æ¯å®Œæˆã€‚</p>
<p>ç„¶åä¼šè¯»å–å“åº”ä¿¡æ¯ï¼Œä¼šå…ˆè¯»å–å“åº”å¤´ä¿¡æ¯ï¼Œå“åº”å¦‚æœè¯»å–æˆ–è€…åˆ›å»ºå®Œæˆåä¼š é€šè¿‡streamAllocation.noNewStreams();è¿™ä¸ªæ–¹æ³•è¿›è¡Œå…³é—­æµï¼Œè¿˜ä¼šåˆ¤æ–­å¦‚æœå“åº”ç æ˜¯204æˆ–è€…205çš„è¯æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚</p>
<p>å…¶å®è¿™ä¸ªæ‹¦æˆªå™¨é“¾æ— éå°±æ˜¯2ä¸ªå·¥ä½œï¼Œå‘èµ·è¯·æ±‚ï¼Œç„¶åå¤„ç†å“åº”ã€‚è‡³äºä¸­é—´ä¼šæœ‰ä¸€äº›å°è£…è¯·æ±‚ä¿¡æ¯åˆ¤æ–­å“åº”ä¿¡æ¯ç­‰æ“ä½œã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>è¿™é‡Œæ‹¦æˆªå™¨çš„æµç¨‹åŸºæœ¬åˆ†æå®Œäº†ï¼Œå…¶å®ä¸»è¦è¿˜æ˜¯çœ‹æ¸…å¤§ä½“æµç¨‹å’Œè®¾è®¡æ€è·¯ï¼Œå…·ä½“ç»†èŠ‚çš„éƒ¨åˆ†æ²¡æœ‰è¿‡å¤šæ·±å…¥ï¼Œå› ä¸ºè¿™äº›æµç¨‹è®¾è®¡æ¨¡å¼æ‰æ˜¯çœŸæ­£è¦å­¦ä¹ çš„é‡ç‚¹ã€‚ä»æºç çœ‹æ¥ å¥½å¤šåœ°æ–¹è¿˜æ˜¯å¾ˆå€¼å¾—å­¦ä¹ çš„ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Androidçƒ­é—¨å¼€æºæ¡†æ¶-OkHttpæºç æ¢ç©¶å››]]></title>
        <id>http://xuanguofeng.com/post/OkHttp_No.4</id>
        <link href="http://xuanguofeng.com/post/OkHttp_No.4">
        </link>
        <updated>2017-12-25T07:55:17.000Z</updated>
        <summary type="html"><![CDATA[<p>æœ¬ç¯‡ç»§ç»­æ¢ç©¶OkHttpï¼Œè¿™æ¬¡ä¸»è¦çœ‹OkHttpä¸­çš„ä¸€ä¸ªæ ¸å¿ƒæœºåˆ¶Dispatcher</p>
]]></summary>
        <content type="html"><![CDATA[<p>æœ¬ç¯‡ç»§ç»­æ¢ç©¶OkHttpï¼Œè¿™æ¬¡ä¸»è¦çœ‹OkHttpä¸­çš„ä¸€ä¸ªæ ¸å¿ƒæœºåˆ¶Dispatcher</p>
<!-- more -->
<h2 id="dispatcheræ˜¯ä»€ä¹ˆ">Dispatcheræ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<pre><code>/**
 * Policy on when async requests are executed.
 *
 * &lt;p&gt;Each dispatcher uses an {@link ExecutorService} to run calls internally. If you supply your
 * own executor, it should be able to run {@linkplain #getMaxRequests the configured maximum} number
 * of calls concurrently.
 */
</code></pre>
<p>è¿™æ˜¯Dispatcherçš„æ³¨é‡Šæ–‡æ¡£ï¼Œå¼‚æ­¥è¯·æ±‚çš„æ‰§è¡Œç­–ç•¥ï¼Œå…¶å®Dispatcherä¸»è¦ç”¨åœ¨å¼‚æ­¥è¯·æ±‚ä¸­ï¼Œä½†æ˜¯åŒæ­¥è¯·æ±‚ä¹Ÿä¼šæ¶‰åŠã€‚å‘é€åŒæ­¥å’Œå¼‚æ­¥è¯·æ±‚éƒ½ä¼šåœ¨Dispatcherä¸­ç®¡ç†å…¶çŠ¶æ€ï¼ŒDispatcherç»´æŠ¤è¯·æ±‚çŠ¶æ€ï¼Œå¹¶ä¸”ç»´æŠ¤ä¸€ä¸ªçº¿ç¨‹æ± ã€‚</p>
<pre><code> private int maxRequests = 64;
  private int maxRequestsPerHost = 5;
  private @Nullable Runnable idleCallback;

  /** Executes calls. Created lazily. */
  private @Nullable ExecutorService executorService;

  /** Ready async calls in the order they'll be run. */
  private final Deque&lt;AsyncCall&gt; readyAsyncCalls = new ArrayDeque&lt;&gt;();

  /** Running asynchronous calls. Includes canceled calls that haven't finished yet. */
  private final Deque&lt;AsyncCall&gt; runningAsyncCalls = new ArrayDeque&lt;&gt;();

  /** Running synchronous calls. Includes canceled calls that haven't finished yet. */
  private final Deque&lt;RealCall&gt; runningSyncCalls = new ArrayDeque&lt;&gt;();

</code></pre>
<p>é¦–å…ˆçœ‹ä¸‹è¿™å‡ ä¸ªæˆå‘˜å˜é‡</p>
<table>
<thead>
<tr>
<th>æˆå‘˜å˜é‡</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>maxRequests</td>
<td>å¼‚æ­¥è¯·æ±‚ä¸­æœ€å¤§çš„è¯·æ±‚æ•°é‡</td>
</tr>
<tr>
<td>maxRequestsPerHost</td>
<td>è¯·æ±‚ä¸­æ”¯æŒæœ€å¤§çš„hostæ•°é‡</td>
</tr>
<tr>
<td>executorService</td>
<td>çº¿ç¨‹æ± </td>
</tr>
<tr>
<td>readyAsyncCalls</td>
<td>å¼‚æ­¥ä¸­å‡†å¤‡è¯·æ±‚é˜Ÿåˆ—</td>
</tr>
<tr>
<td>runningAsyncCalls</td>
<td>å¼‚æ­¥ä¸­æ­£åœ¨è¿è¡Œçš„è¯·æ±‚é˜Ÿåˆ—</td>
</tr>
<tr>
<td>runningSyncCalls</td>
<td>è¿è¡Œçš„åŒæ­¥è¯·æ±‚é˜Ÿåˆ—</td>
</tr>
</tbody>
</table>
<h2 id="ä¹‹å‰ç”¨åˆ°çš„å‡ ä¸ªé‡è¦æ–¹æ³•">ä¹‹å‰ç”¨åˆ°çš„å‡ ä¸ªé‡è¦æ–¹æ³•</h2>
<h3 id="enqueueæ–¹æ³•">enqueue()æ–¹æ³•</h3>
<p>è¿™ä¸ªæ–¹æ³•ä¹‹å‰è¯´è¿‡ä¸»è¦æ˜¯è¿›è¡Œå¼‚æ­¥è¯·æ±‚ã€‚è¿™é‡Œæœ‰ä¸€ä¸ª</p>
<pre><code> executorService().execute(call);
</code></pre>
<p>è¿™ä¸ªæ–¹æ³•</p>
<pre><code>  public synchronized ExecutorService executorService() {
    if (executorService == null) {
      executorService = new ThreadPoolExecutor(0, Integer.MAX_VALUE, 60, TimeUnit.SECONDS,
          new SynchronousQueue&lt;Runnable&gt;(), Util.threadFactory(&quot;OkHttp Dispatcher&quot;, false));
    }
    return executorService;
  }

</code></pre>
<p>è¿™ä¸ªæ–¹æ³•ä¸»è¦æ˜¯åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ã€‚</p>
<h3 id="finishedæ–¹æ³•">finishedæ–¹æ³•</h3>
<pre><code>  private &lt;T&gt; void finished(Deque&lt;T&gt; calls, T call, boolean promoteCalls) {
    int runningCallsCount;
    Runnable idleCallback;
    synchronized (this) {
      if (!calls.remove(call)) throw new AssertionError(&quot;Call wasn't in-flight!&quot;);
      if (promoteCalls) promoteCalls();
      runningCallsCount = runningCallsCount();
      idleCallback = this.idleCallback;
    }

    if (runningCallsCount == 0 &amp;&amp; idleCallback != null) {
      idleCallback.run();
    }
  }
</code></pre>
<ol>
<li>
<p>ç”±äºæœ‰ä¸¤ä¸ªé˜Ÿåˆ—ï¼Œå‡†å¤‡çš„å¯¹åˆ—è¦æƒ³åŠ å…¥è¿è¡Œé˜Ÿåˆ— å¯å®šè¦åœ¨è¿è¡Œé˜Ÿåˆ—åˆ é™¤å¯¹åº”çš„è¯·æ±‚ï¼Œ!calls.remove(call)è¿™ä¸ªæ–¹æ³•å°±æ˜¯å°†æ‰§è¡Œå®Œçš„å¼‚æ­¥è¯·æ±‚ï¼Œä»æ­£åœ¨æ‰§è¡Œçš„é˜Ÿåˆ—ä¸­åˆ é™¤ã€‚</p>
</li>
<li>
<p>promoteCalls()æ–¹æ³•ä¸»è¦å°±æ˜¯å°†readyè¯·æ±‚é˜Ÿåˆ—ç§»åˆ°runningè¯·æ±‚é˜Ÿåˆ—çš„æ–¹æ³•</p>
</li>
<li>
<p>runningCallsCount()è¿›è¡Œé‡æ–°è®¡ç®—è¯·æ±‚é˜Ÿåˆ—å’Œreadyé˜Ÿåˆ—çš„æ•°é‡</p>
</li>
</ol>
<h3 id="å…¶ä»–æ–¹æ³•">å…¶ä»–æ–¹æ³•</h3>
<p>è¿˜æœ‰äº›å…¶ä»–æ–¹æ³•ï¼Œå…¶å®ä¹Ÿæ¯”è¾ƒç®€å•å°±ä¸è´´æºç äº†ï¼Œå¦‚å–æ¶ˆæ‰€æœ‰è¯·æ±‚çš„æ–¹æ³•ï¼Œè·å–æœ€å¤§è¯·æ±‚æ•°é‡ã€è®¾ç½®æœ€å¤§è¯·æ±‚æ•°é‡ç­‰é…ç½®æ–¹æ³•ã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“ï¼š</h2>
<p>å…¶å®Dispatcherçš„ä»£ç å¹¶ä¸å¤æ‚ï¼Œä½†æ˜¯å´åœ¨è¿™ä¸ªç±»é‡Œå°è£…äº†å…³äºæ‰€æœ‰çš„è¯·æ±‚çš„ç®¡ç†ï¼Œè¿™è¦æ˜¯Dispatcherçš„æ ¸å¿ƒæ‰€åœ¨ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Androidçƒ­é—¨å¼€æºæ¡†æ¶-OkHttpæºç æ¢ç©¶ä¸‰]]></title>
        <id>http://xuanguofeng.com/post/OkHttp_No.3</id>
        <link href="http://xuanguofeng.com/post/OkHttp_No.3">
        </link>
        <updated>2017-12-25T06:59:42.000Z</updated>
        <summary type="html"><![CDATA[<p>æœ¬ç¯‡ç»§ç»­æ¢ç©¶OkHttpï¼Œè¿™æ¬¡ä¸»è¦çœ‹å¼‚æ­¥è¯·æ±‚æµç¨‹</p>
]]></summary>
        <content type="html"><![CDATA[<p>æœ¬ç¯‡ç»§ç»­æ¢ç©¶OkHttpï¼Œè¿™æ¬¡ä¸»è¦çœ‹å¼‚æ­¥è¯·æ±‚æµç¨‹</p>
<!-- more -->
<h2 id="å¼‚æ­¥è¯·æ±‚æµç¨‹">å¼‚æ­¥è¯·æ±‚æµç¨‹</h2>
<p>1.åˆ›å»ºOkHttpClientå’ŒRequestå¯¹è±¡</p>
<p>2.å°†Requestå°è£…æˆCallå¯¹è±¡</p>
<p>3.è°ƒç”¨Callçš„enqueue()å‘é€åŒæ­¥è¯·æ±‚</p>
<p>4.åœ¨callbackä¸­å¤„ç†æˆåŠŸå’Œå¤±è´¥çš„è¯·æ¬¾</p>
<h2 id="æºç æ‰§è¡Œæµç¨‹">æºç æ‰§è¡Œæµç¨‹</h2>
<h3 id="æµç¨‹åˆ†æ">æµç¨‹åˆ†æ</h3>
<p>åŒæ­¥ä¸»è¦é€šè¿‡call.enqueueæ–¹æ³•å»æ‰§è¡Œï¼Œè¿™ä¸ªæ–¹æ³•ä¸»è¦åœ¨RealCallä¸­</p>
<pre><code>
  @Override 
  public void enqueue(Callback responseCallback) {
      synchronized (this) {
      if (executed) throw new IllegalStateException(&quot;Already Executed&quot;);
      executed = true;
    }
    captureCallStackTrace();
    eventListener.callStart(this);
    client.dispatcher().enqueue(new AsyncCall(responseCallback));
  }


</code></pre>
<p>1ã€å…¶å®è¿™æ®µä»£ç çš„æµç¨‹åŸºæœ¬å’ŒåŒæ­¥çš„ä¸€æ · åªä¸è¿‡æ˜¯æœ€åè¦æ‰§è¡Œenqueueæ–¹æ³•ï¼Œè€ŒåŒæ­¥çš„æ˜¯é€šè¿‡ getResponseWithInterceptorChain();ç›´æ¥è·å–resultäº†ã€‚å½“ç„¶å¼‚æ­¥ä¹Ÿæ˜¯æ‰§è¡ŒgetResponseWithInterceptorChain();è·å–resultã€‚åªä¸è¿‡åœ¨è·å–resultä¹‹å‰åšäº†ä¸€äº›å¼‚æ­¥æ“ä½œã€‚</p>
<p>2ã€è·å–é€šè¿‡enqueue()æ–¹æ³•å¹¶ä¼ å…¥äº†ä¸€ä¸ªnew AsyncCall(responseCallback)è¿›è¡Œå¼‚æ­¥æ“ä½œï¼Œå…¶å®è¿™ä¸ªAsyncCallæ˜¯ä¸€ä¸ªRunnableã€‚è¿™æ—¶å¤§æ¦‚å°±æ˜ç™½äº†ã€‚</p>
<p>3ã€å…ˆçœ‹ä¸‹Dispatcheré‡Œçš„è¿™ä¸ªenqueueæ–¹æ³•ã€‚è¿™ä¸ªDispatcheræ˜¯ä¸€ä¸ªè°ƒåº¦å™¨æ ¸å¿ƒç±»ï¼Œä¸‹ä¸€èŠ‚å•ç‹¬æ•´ç†ã€‚</p>
<pre><code>
  synchronized void enqueue(AsyncCall call) {
    if (runningAsyncCalls.size() &lt; maxRequests &amp;&amp; runningCallsForHost(call) &lt; maxRequestsPerHost) {
      runningAsyncCalls.add(call);
      executorService().execute(call);
    } else {
      readyAsyncCalls.add(call);
    }
  }
</code></pre>
<p>è¿™é‡Œå…¶å®ä¹Ÿå¾ˆç®€ï¼Œç”±äºæ˜¯å¼‚æ­¥ï¼Œæœ‰ä¸€ä¸ªå¼‚æ­¥è¿è¡Œé˜Ÿåˆ—ï¼Œå’Œä¸€ä¸ªå‡†å¤‡é˜Ÿåˆ—ã€‚è¿™é‡Œä¼šè¿›è¡Œæ¡ä»¶åˆ¤æ–­ï¼Œå°±æ˜¯é¦–å…ˆåˆ¤æ–­ç›®å‰è¯·æ±‚é˜Ÿåˆ—é‡Œçš„è¯·æ±‚æ•°é‡æ˜¯ä¸æ˜¯å°äºæœ€å¤§çš„æ•°é‡ï¼Œæœ€å¤§å€¼ä¸º64ã€‚å¹¶ä¸”callå¯¹åº”çš„hostæ•°ç›®ä¸åº”è¶…è¿‡maxRequestsPerHostï¼ŒmaxRequestsPerHostçš„å€¼æ˜¯5ã€‚</p>
<p>å¦‚æœæ»¡è¶³æ¡ä»¶å°±æ·»åŠ åˆ°è¿è¡Œçš„é˜Ÿåˆ—ä¸­ï¼Œå¦‚æœä¸æ»¡è¶³å°±æ·»åŠ åˆ°å‡†å¤‡é˜Ÿåˆ—ä¸­ã€‚ç„¶åé€šè¿‡çº¿ç¨‹æ± å®ä¾‹executorServiceè¿›è¡Œæ‰§è¡Œã€‚</p>
<h3 id="asynccallåˆ†æ">AsyncCallåˆ†æ</h3>
<p>ä¸Šæ–‡æåˆ°AsyncCallå…¶å®æ˜¯NamedRunnableçš„å­ç±» è€Œ NamedRunnableåˆå®ç°Runnableæ¥å£ã€‚</p>
<pre><code>
/**
 * Runnable implementation which always sets its thread name.
 */
public abstract class NamedRunnable implements Runnable {
  protected final String name;

  public NamedRunnable(String format, Object... args) {
    this.name = Util.format(format, args);
  }

  @Override public final void run() {
    String oldName = Thread.currentThread().getName();
    Thread.currentThread().setName(name);
    try {
      execute();
    } finally {
      Thread.currentThread().setName(oldName);
    }
  }

  protected abstract void execute();
}

</code></pre>
<p>è¿™é‡Œçœ‹åˆ°å…¶å®åœ¨runæ–¹æ³•é‡Œæ‰§è¡Œäº†executeè¿™ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡ç‚¹åˆ†æNamedRunnableå®ç°ç±»çš„çš„executeæ–¹æ³•ã€‚</p>
<pre><code>  final class AsyncCall extends NamedRunnable {
    private final Callback responseCallback;

    AsyncCall(Callback responseCallback) {
      super(&quot;OkHttp %s&quot;, redactedUrl());
      this.responseCallback = responseCallback;
    }

    String host() {
      return originalRequest.url().host();
    }

    Request request() {
      return originalRequest;
    }

    RealCall get() {
      return RealCall.this;
    }

    @Override protected void execute() {
      boolean signalledCallback = false;
      try {
        Response response = getResponseWithInterceptorChain();
        if (retryAndFollowUpInterceptor.isCanceled()) {
          signalledCallback = true;
          responseCallback.onFailure(RealCall.this, new IOException(&quot;Canceled&quot;));
        } else {
          signalledCallback = true;
          responseCallback.onResponse(RealCall.this, response);
        }
      } catch (IOException e) {
        if (signalledCallback) {
          // Do not signal the callback twice!
          Platform.get().log(INFO, &quot;Callback failure for &quot; + toLoggableString(), e);
        } else {
          eventListener.callFailed(RealCall.this, e);
          responseCallback.onFailure(RealCall.this, e);
        }
      } finally {
        client.dispatcher().finished(this);
      }
    }
  }

</code></pre>
<p>å…¶å®executeçš„æµç¨‹å’ŒåŒæ­¥çš„ä¹ŸåŸºæœ¬å·®ä¸å¤šäº† æœ€ä¸»è¦è¿˜æ˜¯é€šè¿‡getResponseWithInterceptorChainï¼ˆï¼‰æ–¹æ³•è¿”å›Responseï¼ŒgetResponseWithInterceptorChainè¿™ä¸ªæ–¹æ³•åé¢ä¼šå•ç‹¬è¯¦ç»†è¯´æ˜ã€‚<br>
ç„¶åä¸»è¦æµç¨‹å°±æ˜¯å…ˆé€šè¿‡å›½æ‹¦æˆªå™¨åˆ¤æ–­æ˜¯å¦å–æ¶ˆè¯·æ±‚ï¼Œå¦‚æœå–æ¶ˆçš„è¯æ‰§è¡ŒonFailureè¿”å›ï¼Œå¦åˆ™è¿”å›onResponseå¹¶ä¼ å…¥responseã€‚</p>
<p>ç„¶åå°±æ˜¯å¼‚å¸¸å¤„ç†ä¹Ÿè¿”å›onFailureã€‚</p>
<p>æœ€åè¦æ‰§è¡Œfinishedã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“ï¼š</h2>
<p>å…¶å®åŒæ­¥å’Œå¼‚æ­¥çš„ä¸»è¦åŒºåˆ«åœ¨äºçº¿ç¨‹æ± çš„ä½¿ç”¨ï¼Œç„¶åå…¶ä»–æµç¨‹ä¹Ÿæ˜¯é€šè¿‡OkHttpä¸­çš„æ‹¦æˆªå™¨é“¾è¿›è¡Œè¿”å›å“åº”ã€‚åœ¨è¿™é‡Œå¯ä»¥ä½“ä¼šä¸‹è¿™ç§è®¾è®¡çš„å·§å¦™ä¹‹å¤„ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Androidçƒ­é—¨å¼€æºæ¡†æ¶-OkHttpæºç æ¢ç©¶äºŒ]]></title>
        <id>http://xuanguofeng.com/post/OkHttp_No.2</id>
        <link href="http://xuanguofeng.com/post/OkHttp_No.2">
        </link>
        <updated>2017-12-21T07:31:48.000Z</updated>
        <summary type="html"><![CDATA[<p>æœ¬ç¯‡ç»§ç»­æ¢ç©¶OkHttpï¼Œè¿™æ¬¡ä¸»è¦çœ‹åŒæ­¥è¯·æ±‚æµç¨‹</p>
]]></summary>
        <content type="html"><![CDATA[<p>æœ¬ç¯‡ç»§ç»­æ¢ç©¶OkHttpï¼Œè¿™æ¬¡ä¸»è¦çœ‹åŒæ­¥è¯·æ±‚æµç¨‹</p>
<!-- more-->
<h2 id="åŒæ­¥è¯·æ±‚æµç¨‹">åŒæ­¥è¯·æ±‚æµç¨‹</h2>
<h3 id="ä½¿ç”¨æµç¨‹">ä½¿ç”¨æµç¨‹</h3>
<p>1.åˆ›å»ºOkHttpClientå’ŒRequestå¯¹è±¡</p>
<p>2.å°†Requestå°è£…æˆCallå¯¹è±¡</p>
<p>3.è°ƒç”¨Callçš„execute()å‘é€åŒæ­¥è¯·æ±‚</p>
<h3 id="æºç æ‰§è¡Œæµç¨‹">æºç æ‰§è¡Œæµç¨‹</h3>
<p>åŒæ­¥ä¸»è¦é€šè¿‡call.executeæ–¹æ³•å»æ‰§è¡Œï¼Œè¿™ä¸ªæ–¹æ³•ä¸»è¦åœ¨RealCallä¸­</p>
<pre><code>  @Override public Response execute() throws IOException {
    synchronized (this) {
      if (executed) throw new IllegalStateException(&quot;Already Executed&quot;);
      executed = true;
    } //è§ è§£é‡Šå¤„1
    
    captureCallStackTrace();
    eventListener.callStart(this);//è§è§£é‡Šå¤„2
    try {
      client.dispatcher().executed(this);//è§è§£é‡Šå¤„3
      Response result = getResponseWithInterceptorChain();
      if (result == null) throw new IOException(&quot;Canceled&quot;);
      return result;
    } catch (IOException e) {
      eventListener.callFailed(this, e);
      throw e;
    } finally {
      client.dispatcher().finished(this);
    }
  }


</code></pre>
<p>è¿™æ®µä»£ç çš„æ­¥éª¤</p>
<p>1.é¦–å…ˆé€šè¿‡executedåˆ¤æ–­è¿™ä¸ªæ–¹æ³•æ˜¯å¦è¢«æ‰§è¡Œï¼Œæ‰§è¡Œè¿‡çš„è¯å°±æŠ›å‡ºå¼‚å¸¸ï¼Œæ²¡æœ‰æ‰§è¡Œçš„è¯å°±è®¾ç½®executedä¸ºtrue,é˜²æ­¢ä¸‹æ¬¡æ‰§è¡Œï¼Œè¿™ä¹ˆçœ‹æ¥æ¯ä¸ªcallåªèƒ½è¢«æ‰§è¡Œä¸€æ¬¡ï¼Œå¦‚æœæƒ³è¦ä¸€ä¸ªå®Œå…¨ä¸€æ ·çš„call,å¯ä»¥è¿›è¡Œcloneæ–¹æ³•å…‹éš†ã€‚</p>
<p>2.é€šè¿‡eventListener.callStart(this);æ–¹æ³•å¼€å¯äº†ä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨ï¼Œè¿™ä¸ªç›‘å¬å™¨çš„ä»‹ç»ä¹Ÿæœ‰ï¼Œä¸»è¦ç›‘æ§HTTPçš„è°ƒç”¨çš„æ•°é‡ã€å¤§å°å’ŒæŒç»­æ—¶é—´ç­‰ï¼Œè¿™ä¸ªç›‘å¬å™¨ï¼Œåœ¨å¼‚æ­¥è¯·æ±‚æ–¹æ³•ä¸­ä¹Ÿä¼šå¼€å¯ã€‚</p>
<p>3.client.dispatcher().executed(this);è¿™å¥è¯å…¶å®æ˜¯å°†è¯·æ±‚æ·»åŠ åˆ°åŒæ­¥è¯·æ±‚é˜Ÿåˆ—ä¸­]</p>
<pre><code> /** Used by {@code Call#execute} to signal it is in-flight. */
 synchronized void executed(RealCall call) {
   runningSyncCalls.add(call);
 }
</code></pre>
<p>è¿™ä¸ª runningSyncCallså…¶å®å°±æ˜¯ä¸€ä¸ªåŒæ­¥è¯·æ±‚é˜Ÿåˆ—é›†åˆã€‚dispatcheræ˜¯OkHttpClient.Builderçš„æˆå‘˜ï¼Œåé¢ä¼šå•ç‹¬åˆ†æã€‚</p>
<p>4.è°ƒç”¨ getResponseWithInterceptorChainè¿™ä¸ªæ–¹æ³•æ¥è·å–responseã€‚è¿™ä¸ªæ–¹æ³•å¯ä»¥å…ˆæµè§ˆä¸‹ åé¢ä¼šè¿›è¡Œåˆ†æã€‚</p>
<pre><code>Response getResponseWithInterceptorChain() throws IOException {
   // Build a full stack of interceptors.
   List&lt;Interceptor&gt; interceptors = new ArrayList&lt;&gt;();
   interceptors.addAll(client.interceptors());
   interceptors.add(retryAndFollowUpInterceptor);
   interceptors.add(new BridgeInterceptor(client.cookieJar()));
   interceptors.add(new CacheInterceptor(client.internalCache()));
   interceptors.add(new ConnectInterceptor(client));
   if (!forWebSocket) {
     interceptors.addAll(client.networkInterceptors());
   }
   interceptors.add(new CallServerInterceptor(forWebSocket));

   Interceptor.Chain chain = new RealInterceptorChain(interceptors, null, null, null, 0,
       originalRequest, this, eventListener, client.connectTimeoutMillis(),
       client.readTimeoutMillis(), client.writeTimeoutMillis());

   return chain.proceed(originalRequest);
 }
</code></pre>
<p>å…¶å®ä¸»è¦å°±æ˜¯é€šè¿‡ä¸€å±‚ä¸€å±‚çš„æ‹¦æˆªå™¨æ“ä½œï¼Œæ¯”å¦‚é‡è¯•æ‹¦æˆªå™¨ï¼Œç¼“å­˜æ‹¦æˆªå™¨ç­‰ï¼Œè¿™ä¹Ÿæ˜¯OkHttpçš„æ ¸å¿ƒæ€æƒ³ä¹‹ä¸€ï¼Œé€šè¿‡ä¸€ç³»åˆ—æ‹¦æˆªå™¨å¯ä»¥è¿›è¡Œå„ç§åŠŸèƒ½çš„æ‰©å±•å’Œå®ç°ã€‚åé¢ä¼šå•ç‹¬åˆ†æã€‚</p>
<p>5.å¦‚æœresultä¸ä¸ºnullå°†ç»“æœè¿”å›ï¼Œå¦‚æœæœ‰å¼‚å¸¸çš„è¯ æ‰§è¡Œç›‘å¬çš„failedæ–¹æ³•ã€‚æœ€åæ— è®ºå¦‚ä½•éƒ½è¦é€šè¿‡dispatcherçš„finishedæ–¹æ³•é€šçŸ¥dispatcheræ‰§è¡Œå®Œæ¯•ã€‚</p>
<p>æ³¨æ„ï¼šåŒæ­¥å‘é€è¯·æ±‚åï¼Œå°±ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ç›´åˆ°æ”¶åˆ°è¯·æ±‚ï¼Œ</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>è¿™æ ·ï¼Œå…¶å®åŒæ­¥è¯·æ±‚æµç¨‹çš„è¡¨é¢æºç åŸºæœ¬å·²ç»åˆ†æå®Œæ¯•äº†ï¼Œä½†æ˜¯åœ¨è¿™æ®µä»£ç åè¿˜éšè—ç€ä¸€äº›å…¶ä»–çš„æœºåˆ¶ï¼Œæˆ‘ä»¬åé¢åˆ†æå¼‚æ­¥çš„æ—¶å€™ä¼šåˆ†æåˆ°ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Androidçƒ­é—¨å¼€æºæ¡†æ¶-Okhttpæºç æ¢ç©¶ä¸€]]></title>
        <id>http://xuanguofeng.com/post/OkHttp_No.1</id>
        <link href="http://xuanguofeng.com/post/OkHttp_No.1">
        </link>
        <updated>2017-12-15T08:50:53.000Z</updated>
        <summary type="html"><![CDATA[<p>OkHttpæ˜¯ç›®å‰å¾ˆæµè¡Œçš„ç½‘ç»œè¯·æ±‚æ¡†æ¶ã€‚æºç ä¹Ÿè®¾è®¡å¾ˆä¼˜ç§€çš„æ€æƒ³ã€‚æœ‰å¿…è¦å»æ¢ç©¶ä¸€ä¸‹æºç ã€‚</p>
<p>ç”±äºç¯‡å¹…è¾ƒé•¿ï¼Œåˆ†ä¸ºäº”ç¯‡æ–‡ç« ã€‚æœ¬ç¯‡æ–‡ç« å°†è®¨è®ºOkHttpçš„æ‰§è¡Œæµç¨‹åˆ†æ</p>
]]></summary>
        <content type="html"><![CDATA[<p>OkHttpæ˜¯ç›®å‰å¾ˆæµè¡Œçš„ç½‘ç»œè¯·æ±‚æ¡†æ¶ã€‚æºç ä¹Ÿè®¾è®¡å¾ˆä¼˜ç§€çš„æ€æƒ³ã€‚æœ‰å¿…è¦å»æ¢ç©¶ä¸€ä¸‹æºç ã€‚</p>
<p>ç”±äºç¯‡å¹…è¾ƒé•¿ï¼Œåˆ†ä¸ºäº”ç¯‡æ–‡ç« ã€‚æœ¬ç¯‡æ–‡ç« å°†è®¨è®ºOkHttpçš„æ‰§è¡Œæµç¨‹åˆ†æ</p>
<!-- more -->
<h2 id="æ–‡ç« ç›®å½•">æ–‡ç« ç›®å½•</h2>
<p>ä¸€ã€OkHttpæ‰§è¡Œæµç¨‹åˆ†æ</p>
<p>äºŒã€åŒæ­¥è¯·æ±‚æµç¨‹åˆ†æ</p>
<p>ä¸‰ã€å¼‚æ­¥è¯·æ±‚æµç¨‹åˆ†æ</p>
<p>å››ã€ä»»åŠ¡è°ƒåº¦æ ¸å¿ƒdispatcher</p>
<p>äº”ã€OkHttpä¸­äº”å¤§æ‹¦æˆªå™¨æºç ä¸åŠŸèƒ½åˆ†æ</p>
<h2 id="okhttpæ‰§è¡Œæµç¨‹åˆ†æ">OkHttpæ‰§è¡Œæµç¨‹åˆ†æ</h2>
<h3 id="æµç¨‹å›¾">æµç¨‹å›¾</h3>
<figure data-type="image" tabindex="1"><img src="http://upload-images.jianshu.io/upload_images/1980287-7c800950f025a328.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æµç¨‹å›¾.png"></figure>
<h3 id="æµç¨‹åˆ†æ">æµç¨‹åˆ†æ</h3>
<h4 id="1-åˆ›å»ºokhttpclient">1ã€åˆ›å»ºOkHttpClient</h4>
<p>OkHttpClientæ˜¯ä¸€ä¸ªé€šè¿‡buildæ¨¡å¼å»æ„å»ºçš„ã€‚</p>
<pre><code>    public Builder() {
      dispatcher = new Dispatcher();
      protocols = DEFAULT_PROTOCOLS;
      connectionSpecs = DEFAULT_CONNECTION_SPECS;
      eventListenerFactory = EventListener.factory(EventListener.NONE);
      proxySelector = ProxySelector.getDefault();
      cookieJar = CookieJar.NO_COOKIES;
      socketFactory = SocketFactory.getDefault();
      hostnameVerifier = OkHostnameVerifier.INSTANCE;
      certificatePinner = CertificatePinner.DEFAULT;
      proxyAuthenticator = Authenticator.NONE;
      authenticator = Authenticator.NONE;
      connectionPool = new ConnectionPool();
      dns = Dns.SYSTEM;
      followSslRedirects = true;
      followRedirects = true;
      retryOnConnectionFailure = true;
      connectTimeout = 10_000;
      readTimeout = 10_000;
      writeTimeout = 10_000;
      pingInterval = 0;
    }
</code></pre>
<p>ç„¶åé€šè¿‡buildçš„buildæ–¹æ³•æ„å»º</p>
<pre><code>    public OkHttpClient build() {
      return new OkHttpClient(this);
    }
</code></pre>
<p>è¿™é‡Œä¸»è¦æ˜¯é€šè¿‡buildè®¾è®¡æ¨¡å¼é…ç½®ä¸€äº›å¸¸ç”¨çš„å‚æ•°ä¿¡æ¯ï¼Œå¦‚è¶…æ—¶æ—¶é—´ç­‰ã€‚</p>
<h4 id="2-åˆ›å»ºrequest">2ã€åˆ›å»ºRequest</h4>
<pre><code> public Builder() {
      this.method = &quot;GET&quot;;
      this.headers = new Headers.Builder();
 }

 Builder(Request request) {
      this.url = request.url;
      this.method = request.method;
      this.body = request.body;
      this.tag = request.tag;
      this.headers = request.headers.newBuilder();
    }

</code></pre>
<p>Requestä¹Ÿæ˜¯é€šè¿‡buildæ¨¡å¼é…ç½®ä¸€äº›è¯·æ±‚ä¿¡æ¯ç­‰ï¼Œå¦‚url,è¯·æ±‚æ–¹æ³•ï¼Œè¯·æ±‚ä½“ï¼Œè¯·æ±‚å¤´ç­‰ã€‚</p>
<h4 id="3-åˆ›å»ºcall">3ã€åˆ›å»ºCall</h4>
<pre><code>Call call = client.newCall(request);
</code></pre>
<p>ä¸»è¦æ˜¯é€šè¿‡client.newCallç„¶åä¼ å…¥ä¸€ä¸ªrequestæ¥è¿›è¡Œåˆ›å»ºã€‚</p>
<pre><code>@Override 
public Call newCall(Request request) {
    return RealCall.newRealCall(this, request, false);
  }
</code></pre>
<p>è¿™é‡Œå…¶å®æ˜¯åˆ›å»ºäº†ä¸€ä¸ªRealCallï¼ŒRealCallä¹Ÿæ˜¯OkHttpæ¡†æ¶ä¸»è¦æµç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œä¸»è¦æ˜¯é“¾æ¥requestå’ŒResponseçš„æ¡¥æ¢ï¼Œé€šè¿‡callè¿›è¡ŒåŒæ­¥å’Œå¼‚æ­¥æ–¹æ³•çš„æ‰§è¡Œã€‚åœ¨åŒæ­¥å’Œå¼‚æ­¥çš„æ‰§è¡Œæ–¹æ³•é‡Œä¼šè¿”å›responseã€‚ä¾‹å¦‚ï¼š</p>
<pre><code>  @Override public Response execute() throws IOException {
    synchronized (this) {
      if (executed) throw new IllegalStateException(&quot;Already Executed&quot;);
      executed = true;
    }
    captureCallStackTrace();
    eventListener.callStart(this);
    try {
      client.dispatcher().executed(this);
      Response result = getResponseWithInterceptorChain();
      if (result == null) throw new IOException(&quot;Canceled&quot;);
      return result;
    } catch (IOException e) {
      eventListener.callFailed(this, e);
      throw e;
    } finally {
      client.dispatcher().finished(this);
    }
  }

</code></pre>
<h4 id="4-é€šè¿‡callæ‰§è¡ŒåŒæ­¥æˆ–è€…å¼‚æ­¥è¯·æ±‚è·å–response">4ã€é€šè¿‡Callæ‰§è¡ŒåŒæ­¥æˆ–è€…å¼‚æ­¥è¯·æ±‚ï¼Œè·å–response</h4>
<pre><code> Response response = call.execute();
 System.out.println(response.body().string());
</code></pre>
<p>ä¸Šé¢å·²ç»è¯´è¿‡é€šè¿‡callçš„executeå¯ä»¥è¿›è¡ŒåŒæ­¥è¯·æ±‚ï¼Œç„¶åè·å–responseï¼Œè¿™ä¸ªresponseå°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„è¿”å›çš„ä¿¡æ¯ã€‚</p>
<p>ä¹Ÿå¯ä»¥é€šè¿‡call.enqueueæ–¹æ³•ä¼ å…¥ä¹Ÿä¸€ä¸ªç›‘å¬å™¨ï¼Œè¿›è¡Œå¼‚æ­¥è¯·æ±‚ã€‚</p>
<pre><code>call.enqueue(new Callback() {
    @Override
    public void onFailure(Call call, IOException e) {
       //è¿”å›å¤±è´¥çš„æƒ…å†µ             
       }

    @Override
    public void onResponse(Call call, Response response) throws IOException {
		//è°ƒç”¨æˆåŠŸçš„æƒ…å†µ
                }
            });
</code></pre>
<h4 id="5-å®Œæ•´çš„getè¯·æ±‚å’Œpostè¯·æ±‚ç¤ºä¾‹">5ã€å®Œæ•´çš„getè¯·æ±‚ï¼Œå’Œpostè¯·æ±‚ç¤ºä¾‹</h4>
<h5 id="get">get</h5>
<pre><code>OkHttpClient client = new OkHttpClient();

String run(String url) throws IOException {
  Request request = new Request.Builder()
      .url(url)
      .build();

  Response response = client.newCall(request).execute();
  return response.body().string();
}

</code></pre>
<h5 id="post">post</h5>
<pre><code>public static final MediaType JSON
    = MediaType.parse(&quot;application/json; charset=utf-8&quot;);

OkHttpClient client = new OkHttpClient();

String post(String url, String json) throws IOException {
  RequestBody body = RequestBody.create(JSON, json);
  Request request = new Request.Builder()
      .url(url)
      .post(body)
      .build();
  Response response = client.newCall(request).execute();
  return response.body().string();
}
</code></pre>
<h4 id="6-æ€»ç»“">6ã€æ€»ç»“</h4>
<p>è¿™ç¯‡åªæ˜¯ç®€å•åˆ†æOkHttpçš„ä½¿ç”¨æµç¨‹ï¼Œå…¶å®è¿˜æœ‰ä¸€éƒ¨åˆ†æ ¸å¿ƒçš„æµç¨‹æ˜¯åœ¨æºç ä¸­ä½“ç°çš„æ¯”å¦‚dispatcherè°ƒåº¦å™¨çš„ä½¿ç”¨æµç¨‹ï¼Œä¸æ‹¦æˆªå™¨çš„æ ¸å¿ƒåŠŸèƒ½ç­‰ï¼Œè¿™ä¸€éƒ¨åˆ†å°†åœ¨åé¢çš„æ€»ç»“ä¸­è¿›è¡Œå•ç‹¬åˆ†æã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Androidä¼˜åŒ–-ç»˜åˆ¶ä¼˜åŒ–]]></title>
        <id>http://xuanguofeng.com/post/Androidä¼˜åŒ–-ç»˜åˆ¶ä¼˜åŒ–</id>
        <link href="http://xuanguofeng.com/post/Androidä¼˜åŒ–-ç»˜åˆ¶ä¼˜åŒ–">
        </link>
        <updated>2017-12-13T13:24:56.000Z</updated>
        <summary type="html"><![CDATA[<p><strong>Androidç³»ç»Ÿæ˜¾ç¤ºåŸç†</strong><br>
Androidåº”ç”¨ç¨‹åºæŠŠç»è¿‡æµ‹é‡ï¼Œç»˜åˆ¶ï¼Œå¸ƒå±€çš„surfaceç¼“å­˜æ•°æ®ï¼Œé€šè¿‡SufraceFilngeræŠŠæ•°æ®æ¸²æŸ“åˆ°æ˜¾ç¤ºå±å¹•ä¸Šé€šè¿‡Androidçš„åˆ·æ–°æœºåˆ¶æ¥åˆ·æ–°æ•°æ®ã€‚ä¹Ÿå°±æ˜¯è¯´åº”ç”¨å±‚è´Ÿè´£ç»˜åˆ¶ï¼Œç³»ç»Ÿå±‚è´Ÿè´£æ¸²æŸ“ï¼Œé€šè¿‡è¿›ç¨‹é—´é€šä¿¡æŠŠåº”ç”¨å±‚éœ€è¦ç»˜åˆ¶çš„æ•°æ®ä¼ é€’åˆ°ç³»ç»Ÿå±‚æœåŠ¡ï¼Œç³»ç»Ÿå±‚æœåŠ¡ä»–é€šè¿‡åˆ·æ–°æœºåˆ¶æŠŠæ•°æ®æ›´æ–°åˆ°å±å¹•ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p><strong>Androidç³»ç»Ÿæ˜¾ç¤ºåŸç†</strong><br>
Androidåº”ç”¨ç¨‹åºæŠŠç»è¿‡æµ‹é‡ï¼Œç»˜åˆ¶ï¼Œå¸ƒå±€çš„surfaceç¼“å­˜æ•°æ®ï¼Œé€šè¿‡SufraceFilngeræŠŠæ•°æ®æ¸²æŸ“åˆ°æ˜¾ç¤ºå±å¹•ä¸Šé€šè¿‡Androidçš„åˆ·æ–°æœºåˆ¶æ¥åˆ·æ–°æ•°æ®ã€‚ä¹Ÿå°±æ˜¯è¯´åº”ç”¨å±‚è´Ÿè´£ç»˜åˆ¶ï¼Œç³»ç»Ÿå±‚è´Ÿè´£æ¸²æŸ“ï¼Œé€šè¿‡è¿›ç¨‹é—´é€šä¿¡æŠŠåº”ç”¨å±‚éœ€è¦ç»˜åˆ¶çš„æ•°æ®ä¼ é€’åˆ°ç³»ç»Ÿå±‚æœåŠ¡ï¼Œç³»ç»Ÿå±‚æœåŠ¡ä»–é€šè¿‡åˆ·æ–°æœºåˆ¶æŠŠæ•°æ®æ›´æ–°åˆ°å±å¹•ã€‚</p>
<!-- more -->
<h3 id="åº”ç”¨å±‚">åº”ç”¨å±‚</h3>
<p>viewçš„ç»˜åˆ¶æœ‰ä¸‰ä¸ªæ ¸å¿ƒæ­¥éª¤ï¼Œé€šè¿‡Measureå’ŒLayoutæ¥ç¡®å®šå½“å‰éœ€è¦ç»˜åˆ¶çš„Viewæ‰€åœ¨çš„å¤§å°å’Œä½ç½®ï¼Œé€šè¿‡ç»˜åˆ¶ï¼ˆDrawï¼‰åˆ°surface,é€’å½’æ–¹å¼è·å–Viewçš„å¤§å°å’Œä½ç½®ï¼Œå¹¶ä»¥æ·±åº¦ä½œä¸ºä¼˜å…ˆçº§ï¼Œå±‚çº§è¶Šæ·±ï¼Œå…ƒç´ è¶Šå¤šï¼Œè€—æ—¶ä¹Ÿå°±è¶Šé•¿ã€‚</p>
<h3 id="ç³»ç»Ÿå±‚">ç³»ç»Ÿå±‚</h3>
<p>ç³»ç»Ÿå±‚ä¸»è¦æ˜¯å°†è¦æ˜¾ç¤ºçš„æ•°æ®æ¸²æŸ“åˆ°å±å¹•ä¸Šï¼ŒCPUä¸»è¦è´Ÿè´£æ•°æ®è®¡ç®—å·¥ä½œï¼ŒGPUè´Ÿè´£æ¸²æŸ“ã€‚APIä¸å…è®¸CPUå’ŒGPUç›´æ¥é€šä¿¡ï¼Œ æ‰€ä»¥é€šè¿‡ä¸­é—´çš„ä¸€ä¸ªå›¾å½¢é©±åŠ¨å™¨æ¥è¿æ¥è¿™ä¸¤éƒ¨åˆ†ã€‚å›¾å½¢é©±åŠ¨ç»´æŠ¤äº†ä¸€ä¸ªé˜Ÿåˆ—ï¼ŒcpuæŠŠ diplay listæ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ï¼ŒGPUä»è¿™ä¸ªé˜Ÿåˆ—å–å‡ºæ•°æ®å¹¶è¿›è¡Œç»˜åˆ¶ï¼Œæœ€ç»ˆåœ¨å±å¹•æ˜¾ç¤ºå‡ºæ¥ã€‚</p>
<h2 id="androidé¡µé¢å¡é¡¿çš„åŸå› ">Androidé¡µé¢å¡é¡¿çš„åŸå› </h2>
<h3 id="ç•Œé¢ç»˜åˆ¶æ–¹é¢">ç•Œé¢ç»˜åˆ¶æ–¹é¢</h3>
<p>ä¸»è¦åŸå› æ˜¯ç»˜åˆ¶çš„å±‚çº§æ·±ã€é¡µé¢å¤æ‚ã€åˆ·æ–°ä¸åˆç†ã€ç”±äºè¿™äº›åŸå› å¯¼è‡´å¡é¡¿çš„åœºæ™¯æ›´å¤šå‡ºç°åœ¨UIå’Œå¯åŠ¨åçš„åˆå§‹ç•Œé¢ä»¥åŠè·³è½¬åˆ°é¡µé¢çš„ç»˜åˆ¶ä¸Šã€‚</p>
<h3 id="æ•°æ®å¤„ç†æ–¹é¢">æ•°æ®å¤„ç†æ–¹é¢</h3>
<p>åŸå› æ˜¯æ•°æ®çš„å¤„ç†é‡å¤ªå¤§ï¼Œä¸€èˆ¬åˆ†ä¸ºä¸‰ç§æƒ…å†µ<br>
æ•°æ®å¤„ç†åœ¨UIçº¿ç¨‹</p>
<p>æ•°æ®å¤„ç†å ç”¨CPUæå¯¼è‡´ä¸»çº¿ç¨‹æ‹¿ä¸åˆ°æ—¶é—´ç‰‡</p>
<p>å†…å­˜å¢åŠ å¯¼è‡´GCé¢‘ç¹</p>
<h2 id="ä¼˜åŒ–æ–¹æ³•">ä¼˜åŒ–æ–¹æ³•</h2>
<h3 id="å¸ƒå±€ä¼˜åŒ–">å¸ƒå±€ä¼˜åŒ–</h3>
<h4 id="merge-viewstub">merge viewStub</h4>
<p>https://xuanguofeng.github.io/2016/06/10/Android%E5%B8%83%E5%B1%80%E4%BC%98%E5%8C%96merge%E3%80%81ViewStub%E7%9A%84%E7%94%A8%E6%B3%95/</p>
<h4 id="reativelayoutå’Œlinearlayout">ReativeLayoutå’ŒLinearLayout</h4>
<p>ReativeLayoutå­˜åœ¨æ€§èƒ½ä½çš„é—®é¢˜ï¼ŒåŸå› æ˜¯ReativeLayoutä¼šå¯¹å­viewåšä¸¤æ¬¡æµ‹é‡ï¼Œå¦‚æœLinearLayoutä¸­æœ‰weightå±æ€§ï¼Œä¹Ÿéœ€è¦è¿›è¡Œä¸¤æ¬¡æµ‹é‡ï¼Œå› ä¸ºæ²¡æœ‰æ›´å¤šçš„ä¾èµ–å…³ç³»ï¼Œæ‰€æœ‰ä»ç„¶ä¼šæ¯”ReativeLayoutæ•ˆç‡é«˜ï¼Œä½†æ˜¯å¦‚æœLinearyLayoutåµŒå¥—è¿‡å¤šï¼Œå±‚æ¬¡è¿‡æ·±ç°å¢åŠ å†…å­˜æ¶ˆè€—ï¼Œç”šè‡³å¼•èµ·æº¢å‡ºç­‰é—®é¢˜ã€‚åœ¨å¸ƒå±€ä¸ŠRelativeLayoutä¸å¦‚LinearLayoutå¿«ã€‚å¦‚æœåµŒå¥—è¿‡å¤šçš„è¯è¦é€‰ç”¨RelativeLayoutï¼Œå¦‚æœä¼˜åŒ–æ‰ä¸¤å±‚ä»…ä»…å¢åŠ ä¸€æ¬¡æµ‹é‡ï¼Œè¿˜æ˜¯éå¸¸å€¼å¾—çš„ã€‚</p>
<p>æ€»ç»“ï¼š</p>
<p>å°½é‡ä½¿ç”¨â€‹â€‹RelativeLayoutå’ŒLinearLayout</p>
<p>å¸ƒå±€å±‚çº§ç›¸åŒæƒ…å†µä¸‹ï¼Œä½¿ç”¨â€‹LinearLayout</p>
<p>LinearLayoutå¦‚æœä¼šåµŒå¥—è¿‡å¤šä½¿ç”¨â€‹RelativeLayout</p>
<h3 id="é¿å…è¿‡åº¦ç»˜åˆ¶">é¿å…è¿‡åº¦ç»˜åˆ¶</h3>
<p>è¿‡åº¦é‡ç»˜æ˜¯æŒ‡åœ¨å±å¹•ä¸Šçš„æŸä¸ªåƒç´ åœ¨åŒä¸€å¸§çš„æ—¶é—´å†…è¢«ç»˜åˆ¶äº†å¤šæ¬¡ã€‚</p>
<p>ä¾‹å¦‚ï¼š<br>
LIstViewä¸­æŠŠImageViewçš„Backgroundè®¾ç½®ä¸ºTransparent,åªæœ‰å½“å›¾åƒæ²¡æœ‰è·å–åˆ°æ—¶ï¼Œæ‰è®¾ç½®å¯¹åº”Backgroundå ä½å›¾ï¼Œè¿™æ ·å¯ä»¥é¿å…ç»™Avatarè®¾ç½®èƒŒæ™¯å›¾è€Œå¯¼è‡´çš„è¿‡åº¦æ¸²æŸ“ã€‚</p>
<p>é¿å…è¿‡åº¦ç»˜åˆ¶çš„ä¸€äº›æ–¹æ³•ï¼š</p>
<p>1.ç§»é™¤XMLä¸­éå¿…é¡»çš„èƒŒæ™¯</p>
<p>2.ç§»é™¤windowé»˜è®¤çš„èƒŒæ™¯</p>
<p>3.æŒ‰éœ€æ˜¾ç¤ºç«™ä½èƒŒæ™¯å›¾ç‰‡ã€‚</p>
<p>4.è‡ªå®šä¹‰viewä¼˜åŒ–ï¼šå¯ä»¥é€šè¿‡canvas.clipRect()æ¥å¸®åŠ©ç³»ç»Ÿè¯†åˆ«é‚£äº›å¯è§çš„åŒºåŸŸã€‚â€‹â€‹S</p>
<pre><code>this.getWindow().setBackgroundDrawable(null);â€‹
</code></pre>
<h3 id="é¡µé¢åˆ·æ–°">é¡µé¢åˆ·æ–°</h3>
<p>è¦åˆç†çš„æ§åˆ¶é¡µé¢çš„åˆ·æ–°æœºåˆ¶ï¼Œå°½é‡å‡å°‘åˆ·æ–°æ¬¡æ•°å’Œç¼©å°åˆ·æ–°åŒºåŸŸã€‚</p>
<h3 id="å…³äºåŠ¨ç”»">å…³äºåŠ¨ç”»</h3>
<p>Androidæä¾›äº†3ç§åŠ¨ç”»æœºåˆ¶ï¼Œå…¶ä¸­å¸§åŠ¨ç”»æ˜¯æœ€æ¶ˆè€—å†…å­˜çš„ï¼Œæ•ˆæœä¹Ÿæœ€å·®ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸æ¨èä½¿ç”¨ï¼Œè¡¥é—´åŠ¨ç”»ä¹Ÿä¼šå¯¼è‡´viewé‡ç»˜é¢‘ç¹ï¼Œè€Œä¸”äº‹ä»¶ä¹Ÿä¸ä¼šè·ŸéšåŠ¨ç”»ï¼Œæ‰€ä»¥æ¨èåŸºäºæ€§èƒ½è€ƒè™‘æ¨èä½¿ç”¨å±æ€§åŠ¨ç”»ï¼Œå±æ€§åŠ¨ç”»é€’å½’çš„æ¬¡æ•°è¦æ˜æ˜¾å°äºè¡¥é—´åŠ¨ç”»ï¼Œä¹Ÿæ²¡æœ‰è¡¥é—´åŠ¨ç”»äº‹ä»¶çš„é—®é¢˜ã€‚</p>
<h3 id="ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿ">ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿ</h3>
<p>Android3.0åå¼•å…¥äº†ç¡¬ä»¶åŠ é€Ÿæ¦‚å¿µï¼Œç”¨æ¥æé«˜æ¸²æŸ“é€Ÿåº¦ï¼Œå¹¶è¾¾åˆ°æ›´é¡ºç•…çš„æ•ˆæœ</p>
<h3 id="å¯åŠ¨ä¼˜åŒ–">å¯åŠ¨ä¼˜åŒ–</h3>
<p>å¯åŠ¨ä¼˜åŒ–ä¸»è¦å°±æ˜¯åœ¨APPçš„å¯åŠ¨è¿‡ç¨‹ä¸­åšå°½é‡å°‘çš„äº‹æƒ…ï¼Œå¯åŠ¨ä¸»è¦å®Œæˆä¸‰ä»¶äº‹ï¼ŒUIå¸ƒå±€ã€ç»˜åˆ¶å’Œæ•°æ®å‡†å¤‡ï¼Œå¯åŠ¨é€Ÿåº¦å°±çš„ä¼˜åŒ–å°±æ˜¯è¦ä¼˜åŒ–è¿™ä¸ªä¸‰ä¸ªè¿‡ç¨‹ã€‚</p>
<h2 id="æ€§èƒ½åˆ†æå·¥å…·">æ€§èƒ½åˆ†æå·¥å…·</h2>
<h3 id="profile-gpu-rendering">Profile GPU Rendering</h3>
<p>è¿™ä¸ªå·¥å…·åœ¨å¼€å‘è€…é€‰é¡¹ä¸­å¯ä»¥æ‰“å¼€ï¼Œä¸»è¦åŠŸèƒ½ï¼š</p>
<p>å›¾å½¢æ£€æµ‹å·¥å…·ï¼Œèƒ½å®æ—¶åæ˜ å½“å‰ç»˜åˆ¶çš„è€—æ—¶ã€‚</p>
<p>æ¨ªè½´è¡¨ç¤ºæ—¶é—´ï¼Œçºµè½´è¡¨ç¤ºæ¯ä¸€å¸§çš„è€—æ—¶ã€‚</p>
<p>éšä¹‹æ—¶é—´æ¨ç§»ï¼Œä»å·¦åˆ°å³çš„åˆ·æ–°å‘ˆç°ã€‚</p>
<p>æä¾›äº†ä¸€ä¸ªæ ‡å‡†çš„è€—æ—¶ã€‚</p>
<h3 id="traceview">TraceView</h3>
<p>TraceViewæ˜¯Android SDKè‡ªå¸¦å·¥å…·ï¼Œç”¨æ¥åˆ†æå‡½æ•°è°ƒç”¨è¿‡ç¨‹ï¼Œå¯ä»¥å¯¹Androidçš„åº”ç”¨ç¨‹åºä»¥åŠFrameworkå±‚çš„ä»£ç è¿›è¡Œæ€§èƒ½åˆ†æã€‚</p>
<h3 id="hierarchy-viewer-å¸ƒå±€ä¼˜åŒ–å·¥å…·">Hierarchy Viewer å¸ƒå±€ä¼˜åŒ–å·¥å…·</h3>
<p>Hierarchy Viewerå·¥å…·æä¾›äº†ä¸€ä¸ªå¯è§†åŒ–ç•Œé¢æ˜¾ç¤ºå¸ƒå±€çš„å±‚æ¬¡ç»“æ„ï¼Œç”¨æ¥æ£€æµ‹LayoutåµŒå¥—åŠç»˜åˆ¶æ—¶é—´ï¼Œä»¥å¯è§†åŒ–çš„å¸ƒå±€è§’åº¦ç›´è§‚è·å–Layoutå¸ƒå±€è®¾è®¡å’Œå„ç§å±æ€§ä¿¡æ¯ï¼Œå¼€å‘è€…åœ¨å°æ¬§å¼å’Œå¸ƒå±€UIç•Œé¢å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä½¿ç”¨ã€‚</p>
<h3 id="è¿‡åº¦ç»˜åˆ¶æ£€æµ‹å·¥å…·">è¿‡åº¦ç»˜åˆ¶æ£€æµ‹å·¥å…·</h3>
<p>å¼€å‘è€…é€‰é¡¹ä¸­æ‰“å¼€ show GPU Overdrawé€‰é¡¹<br>
æè¿°æ–¹å¼ï¼š</p>
<p>æ— è‰²ï¼šæ²¡æœ‰è¿‡åº¦ç»˜åˆ¶ï¼Œæ¯ä¸ªåƒç´ ç»˜åˆ¶äº†1æ¬¡ã€‚</p>
<p>è“è‰²ï¼šæ¯ä¸ªåƒç´ å¤šç»˜åˆ¶äº†1æ¬¡ã€‚å¤§ç‰‡è“è‰²è¿˜æ˜¯å¯ä»¥æ¥å—çš„å¦‚æœæ•´ä¸ªçª—å£æ˜¯è“è‰²çš„ï¼Œå¯ä»¥å°è¯•ä¼˜åŒ–å‡å°‘ä¸€å±‚ç»˜åˆ¶ã€‚</p>
<p>ç»¿è‰²ï¼šæ¯ä¸ªåƒç´ å¤šç»˜åˆ¶äº†2æ¬¡ã€‚</p>
<p>æ·¡çº¢ï¼šæ¯ä¸ªåƒç´ å¤šç»˜åˆ¶äº†3æ¬¡ï¼Œä¸€èˆ¬æ¥è¯´è¿™ä¸ªåŒºåŸŸä¸è¶…è¿‡å±å¹•çš„1/4æ˜¯å¯ä»¥æ¥å—çš„ã€‚</p>
<p>æ·±çº¢ï¼šæ¯ä¸ªåƒç´ å¤šç»˜åˆ¶4æ¬¡æˆ–è€…æ›´å¤šã€‚ä¸¥é‡å½±å“æ€§èƒ½ï¼Œéœ€è¦ä¼˜åŒ–ï¼Œé¿å…æ·±çº¢è‰²åŒºåŸŸã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[é‡æ¸©javaåŸºç¡€-åå°„æœºåˆ¶]]></title>
        <id>http://xuanguofeng.com/post/é‡æ¸©javaåŸºç¡€-åå°„æœºåˆ¶</id>
        <link href="http://xuanguofeng.com/post/é‡æ¸©javaåŸºç¡€-åå°„æœºåˆ¶">
        </link>
        <updated>2017-12-13T06:31:22.000Z</updated>
        <summary type="html"><![CDATA[<p><strong>åå°„æ˜¯ä»€ä¹ˆï¼Ÿ</strong><br>
åœ¨è¿è¡ŒçŠ¶æ€ä¸­ï¼Œè·å–ä¸€ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ã€‚è¿™ç§åŠ¨æ€è·å–ä¿¡æ¯ä»¥åŠè°ƒç”¨å¯¹è±¡çš„æ–¹æ³•çš„åŠŸèƒ½ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p><strong>åå°„æ˜¯ä»€ä¹ˆï¼Ÿ</strong><br>
åœ¨è¿è¡ŒçŠ¶æ€ä¸­ï¼Œè·å–ä¸€ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ã€‚è¿™ç§åŠ¨æ€è·å–ä¿¡æ¯ä»¥åŠè°ƒç”¨å¯¹è±¡çš„æ–¹æ³•çš„åŠŸèƒ½ã€‚</p>
<!-- more-->
<h3 id="ä½¿ç”¨åå°„æœºåˆ¶çš„ä¸€äº›æ¡†æ¶">ä½¿ç”¨åå°„æœºåˆ¶çš„ä¸€äº›æ¡†æ¶ï¼Ÿ</h3>
<p>Retrofitä¸­çš„æ³¨è§£åŠŸèƒ½ã€EventBusï¼ŒåŠ¨æ€ç”Ÿæˆæ¡†æ¶ Gsonã€‚</p>
<h3 id="ä½¿ç”¨åå°„æŠ€æœ¯æŸ¥çœ‹ç±»ä¿¡æ¯">ä½¿ç”¨åå°„æŠ€æœ¯æŸ¥çœ‹ç±»ä¿¡æ¯</h3>
<h4 id="è·å–classå¯¹è±¡çš„ä¸‰ç§æ–¹æ³•">è·å–Classå¯¹è±¡çš„ä¸‰ç§æ–¹æ³•</h4>
<h5 id="ä½¿ç”¨objectgetclassæ–¹æ³•">ä½¿ç”¨Object.getClassæ–¹æ³•</h5>
<p>å¦‚æœæˆ‘ä»¬èƒ½çŸ¥é“ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„getClassæ–¹æ³•è·å¾—ä¸€ä¸ªClasså¯¹è±¡ã€‚<br>
ä¾‹å¦‚ï¼š</p>
<pre><code>Person person = new Person();
Class&lt;? extends Person&gt; aClass = person.getClass();
System.out.println(aClass.getName());

</code></pre>
<p>è¿™æ—¶å€™å°±ä¼šæ‰“å°è¿™ä¸ªå¯¹è±¡çš„å…¨åŒ…åï¼ŒaClassä¸­è¿˜æœ‰å…¶ä»–ä¿¡æ¯ã€‚</p>
<h5 id="ä½¿ç”¨classæ–¹æ³•">ä½¿ç”¨.classæ–¹æ³•</h5>
<pre><code>Class&lt;? extends Person&gt; aClass = Person.class;
System.out.println(aClass.getName());
System.out.println(int.class);

</code></pre>
<p>å¦‚æœæ²¡æœ‰è·å–æŸä¸ªç±»çš„å¯¹è±¡ï¼Œæ— æ³•ä½¿ç”¨getClassæ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥åœ¨ç±»ååŠ ä¸Š.classæ¥è·å–ï¼Œè¿™ç§æ–¹å¼å¯ä»¥ç”¨äºåŸºæœ¬æ•°æ®ç±»å‹ã€‚</p>
<h5 id="ä½¿ç”¨classfornameæ–¹æ³•">ä½¿ç”¨Class.forName()æ–¹æ³•</h5>
<p>è¿™ä¸ªæ–¹æ³•è¦ä½¿ç”¨ä¸€ä¸ªç±»çš„å®Œæ•´è·¯å¾„ï¼Œå°±å¯ä»¥ä½¿ç”¨Class.forName(&quot;ç±»çš„å®Œæ•´è·¯å¾„&quot;)æ¥å¾—åˆ°ç›¸åº”çš„Classã€‚</p>
<pre><code> try {
        Class mclass1 = Class.forName(&quot;main.fanshe.Person&quot;);
        System.out.println(mclass1.getName());
     } catch (ClassNotFoundException e) {
            e.printStackTrace();
     }
</code></pre>
<p>æ³¨æ„ï¼šä½¿ç”¨Classçš„newInstance()æ–¹æ³•æ¥åˆ›å»ºå¯¹åº”ç±»çš„å®ä¾‹ï¼Œéœ€è¦æœ‰é»˜è®¤çš„æ„é€ å™¨ï¼Œæ‰§è¡ŒnewInstance()æ–¹æ³•å®é™…ä¸Šå¸‚åˆ©ç”¨é»˜è®¤æ„é€ å™¨æ¥åˆ›å»ºè¯¥ç±»çš„å®ä¾‹ã€‚</p>
<pre><code>Class mclass1 = Class.forName(&quot;main.fanshe.Person&quot;);
Object o = mclass1.newInstance();
</code></pre>
<h4 id="é€šè¿‡åå°„è·å–æˆå‘˜å˜é‡">é€šè¿‡åå°„è·å–æˆå‘˜å˜é‡</h4>
<p>å¸¸ç”¨è·å–æˆå‘˜å±æ€§çš„æ–¹æ³•</p>
<pre><code>
Field[] declaredFields = mclass1.getDeclaredFields();//è·å–Classå¯¹è±¡çš„æ‰€æœ‰å±æ€§

Field[] fields = mclass1.getFields();//è·å–classå¯¹è±¡çš„publicå±æ€§

Field ageField = mclass1.getDeclaredField(&quot;age&quot;);//è·å–classæŒ‡å®šå±æ€§

Field desFiedl = mclass1.getField(&quot;name&quot;);//è·å–classæŒ‡å®šçš„publicå±æ€§


</code></pre>
<p>å¦‚æœè·å–åˆ°å±æ€§å¯ä»¥ç”¨è¿‡setæ–¹æ³•è¿›è¡Œä¿®æ”¹ä¾‹å¦‚ï¼š</p>
<pre><code> Field ageField = mclass1.getDeclaredField(&quot;age&quot;);//è·å–classæŒ‡å®šå±æ€§
 ageField.setInt(o,22);
</code></pre>
<p>å¦‚æœè¿™ä¸ªå±æ€§æ˜¯ç”¨privateä¿®é¥°çš„è¯,è¿™æ ·å†™çš„è¯ä»£ç ä¼šæŠ¥é”™</p>
<pre><code>java.lang.IllegalAccessException: Class main.fanshe.Main can not access a member of class main.fanshe.Person with modifiers &quot;private&quot;
	at sun.reflect.Reflection.ensureMemberAccess(Reflection.java:102)
	at java.lang.reflect.AccessibleObject.slowCheckMemberAccess(AccessibleObject.java:296)
	at java.lang.reflect.AccessibleObject.checkAccess(AccessibleObject.java:288)
	at java.lang.reflect.Field.setInt(Field.java:946)
	at main.fanshe.Main.main(Main.java:50)

</code></pre>
<p>è¿™æ—¶æˆ‘ä»¬è¦æ·»åŠ    ageField.setAccessible(true);è¿™ä¸ªæ–¹æ³•æ¥å£°æ˜è¿™ä¸ªå˜é‡æ˜¯å¯ä»¥è®¿é—®çš„å°±æ²¡é—®é¢˜äº†ï¼Œä½†æ˜¯ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ä¹Ÿå¯èƒ½ä¼šå¯¼è‡´äº›å…¶ä»–é—®é¢˜ï¼Œä¾‹å¦‚<br>
åœ¨è¿è¡Œæ—¶è™½ç„¶ä½ é€šè¿‡åå°„ä¿®æ”¹äº†å˜é‡ a çš„å€¼ï¼Œä½†å…¶ä»–éƒ¨åˆ†å¯èƒ½è¿˜åœ¨ä½¿ç”¨åŸæ¥çš„å€¼ã€‚</p>
<h4 id="é€šè¿‡åå°„è·å–æˆå‘˜æ–¹æ³•">é€šè¿‡åå°„è·å–æˆå‘˜æ–¹æ³•</h4>
<pre><code>Method[] methods = mclass1.getDeclaredMethods();//è·å–classå¯¹è±¡çš„æ‰€æœ‰å£°æ˜æ–¹æ³•
Method[] allMethods = mclass1.getMethods();//è·å–classå¯¹è±¡çš„æ‰€æœ‰publicå£°æ˜æ–¹æ³•
Method method = mclass1.getMethod(&quot;getAge&quot;);//æ ¹æ®æ–¹æ³•åè¿”å›æ–¹æ³•
Method method2 = mclass1.getMethod(&quot;getAge&quot;,String.class);//æ ¹æ®å¸¦æŒ‡å®šå½¢å‚åˆ—è¡¨çš„publicæ–¹æ³•
System.out.println(method.toString());
</code></pre>
<p>å¯ä»¥é€šè¿‡method.invoke(o);è¿™ä¸ªæ–¹æ³•è°ƒç”¨åå°„åˆ°çš„æ–¹æ³•ã€‚</p>
<h3 id="æ€»ç»“">æ€»ç»“</h3>
<p>åå°„è¿˜æœ‰å¥½å¤šå…¶ä»–æ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡æŸ¥è¯¢APIè·çŸ¥ï¼Œä¾‹å¦‚è·å–æ„é€ æ–¹æ³•ç­‰ï¼ŒåŠŸèƒ½è²Œä¼¼è¿˜æ˜¯æ¯”è¾ƒå¼ºå¤§çš„ï¼Œä½†æ˜¯åå°„çš„ä¸€äº›æ“ä½œå¯èƒ½ä¼šå¼•èµ·æ€§èƒ½æ¶ˆè€—ï¼Œä¾‹å¦‚ä¿®æ”¹æŸä¸ªæˆå‘˜å˜é‡çš„æ—¶å€™ï¼Œéœ€è¦å¼•å‘éªŒè¯è®¿é—®æƒé™ç­‰é¢å¤–æ“ä½œç­‰ã€‚æ‰€ä»¥ä½¿ç”¨åå°„çš„æ—¶å€™ä¹Ÿè®¸è¦è€ƒè™‘ä¸‹æ€§èƒ½æ–¹é¢çš„é—®é¢˜ã€‚</p>
<p>æœ¬ç¯‡æ–‡ç« å‚è€ƒï¼šhttp://blog.csdn.net/u011240877/article/details/54604212</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Androidä¼˜åŒ–-å†…å­˜ä¼˜åŒ–]]></title>
        <id>http://xuanguofeng.com/post/Androidä¼˜åŒ–-å†…å­˜ä¼˜åŒ–</id>
        <link href="http://xuanguofeng.com/post/Androidä¼˜åŒ–-å†…å­˜ä¼˜åŒ–">
        </link>
        <updated>2017-12-06T06:41:46.000Z</updated>
        <summary type="html"><![CDATA[<p>Javaå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸç»å†7ä¸ªé˜¶æ®µï¼Œåˆ†åˆ«æ˜¯åˆ›å»ºé˜¶æ®µã€åº”ç”¨é˜¶æ®µã€ä¸å¯è§é˜¶æ®µã€ä¸å¯è¾¾é˜¶æ®µã€æ”¶é›†é˜¶æ®µã€ç»ˆç»“é˜¶æ®µã€å¯¹è±¡æ§ä»¶é‡æ–°åˆ†é…é˜¶æ®µã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>Javaå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸç»å†7ä¸ªé˜¶æ®µï¼Œåˆ†åˆ«æ˜¯åˆ›å»ºé˜¶æ®µã€åº”ç”¨é˜¶æ®µã€ä¸å¯è§é˜¶æ®µã€ä¸å¯è¾¾é˜¶æ®µã€æ”¶é›†é˜¶æ®µã€ç»ˆç»“é˜¶æ®µã€å¯¹è±¡æ§ä»¶é‡æ–°åˆ†é…é˜¶æ®µã€‚</p>
<!-- more -->
<h2 id="ä¸€-androidå†…å­˜ç®¡ç†æœºåˆ¶">ä¸€ã€Androidå†…å­˜ç®¡ç†æœºåˆ¶</h2>
<h3 id="1-javaå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ">1ã€Javaå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ</h3>
<p>Javaå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸç»å†7ä¸ªé˜¶æ®µï¼Œåˆ†åˆ«æ˜¯åˆ›å»ºé˜¶æ®µã€åº”ç”¨é˜¶æ®µã€ä¸å¯è§é˜¶æ®µã€ä¸å¯è¾¾é˜¶æ®µã€æ”¶é›†é˜¶æ®µã€ç»ˆç»“é˜¶æ®µã€å¯¹è±¡æ§ä»¶é‡æ–°åˆ†é…é˜¶æ®µã€‚</p>
<h3 id="2-å†…å­˜å›æ”¶æœºåˆ¶">2ã€å†…å­˜å›æ”¶æœºåˆ¶</h3>
<h4 id="å†…å­˜çš„ä¸‰ä¸ªåŒºåŸŸ">å†…å­˜çš„ä¸‰ä¸ªåŒºåŸŸ</h4>
<p>å†…å­˜ä¼šæœ‰ä¸‰ä¸ªåŒºåŸŸï¼ŒYong Generation(å¹´è½»ä»£)ã€Old Generation(å¹´è€ä»£)ã€permanent Generationï¼ˆæŒä¹…ä»£ï¼‰ã€‚<br>
å…¶ä¸­å¹´è½»ä»£é‡Œé¢åˆåˆ†ä¸ºä¸‰ä¸ªåŒºï¼Œedenã€S0ã€S1ã€‚</p>
<p>å†…å­˜çš„å¤„ç†è¿‡ç¨‹ï¼š</p>
<p>1.å¯¹è±¡åˆ›å»ºååœ¨EdenåŒºåŸŸï¼Œ</p>
<p>2.æ‰§è¡ŒGCæ—¶ï¼Œå¦‚æœå¯¹è±¡ä»ç„¶å­˜è´§ï¼Œåˆ™å¤åˆ¶åˆ°S0åŒºã€‚</p>
<p>3.å½“S0åŒºæ»¡æ—¶ï¼Œæ”¹åŒºåŸŸå­˜æ´»å¯¹è±¡å°†å¤åˆ¶åˆ°S1åŒºï¼Œç„¶åS0æ¸…ç©ºï¼Œæ¥ä¸‹æ¥S0å’ŒS1è§’è‰²äº’æ¢ã€‚</p>
<p>4.å½“ç¬¬ä¸‰éƒ¨è¾¾åˆ°ä¸€å®šæ¬¡æ•°åï¼Œå­˜æ´»å¯¹è±¡å°†è¢«å¤åˆ¶åˆ°Old Generationã€‚</p>
<p>5.å½“è¿™ä¸ªå¯¹è±¡åœ¨Old GenerationåŒºåŸŸæŒºæºœçš„æ—¶é—´è¾¾åˆ°ä¸€å®šç¨‹åº¦æ—¶ï¼Œå®ƒä¼šè¢«ç§»åŠ¨åˆ°Old Generationï¼Œæœ€åç§¯ç´¯ä¸€å®šæ—¶é—´å†ç§»åŠ¨åˆ°Permaent GenerationåŒºåŸŸï¼ŒPermaent GenerationåŒºåŸŸä¹Ÿå­˜æ”¾ä¸€äº›é™æ€æ–‡ä»¶ã€‚</p>
<h4 id="gcå›æ”¶çš„ä¸€äº›ç®—æ³•">GCå›æ”¶çš„ä¸€äº›ç®—æ³•</h4>
<p>Copyingç®—æ³•ï¼šæ‰«æå‡ºå­˜æ´»çš„å¯¹è±¡ï¼Œå¹¶å¤åˆ¶åˆ°ä¸€å—æ–°çš„å®Œå…¨æœªä½¿ç”¨çš„æ§ä»¶ä¸­ï¼Œå¯¹åº”äºYoung Generationï¼Œå°±æ˜¯åœ¨Edenã€FromSpaceæˆ–ToSpaceä¹‹é—´copyã€‚</p>
<p>æ ‡è®°ç®—æ³•ï¼šæ‰«æå‡ºå­˜æ´»å¯¹è±¡ï¼Œç„¶åå†å›æ”¶æœªæ ‡è®°çš„å¯¹è±¡ï¼Œå›æ”¶åå¯¹ç©ºå‡ºçš„ç©ºé—´è¦ä¹ˆåˆå¹¶ï¼Œè¦ä¹ˆæ ‡è®°å‡ºæ¥ä¾¿äºä¸‹æ¬¡åˆ†é…ï¼Œä»¥å‡å°‘å†…å­˜ç¢ç‰‡å¸¦æ¥çš„æŸè€—ã€‚å¹´è€ä»£å¯¹è±¡å­˜æ´»æ—¶é—´è¾ƒé•¿è¾ƒç¨³å®šï¼Œä½¿ç”¨æ ‡è®°ç®—æ³•å›æ”¶ã€‚</p>
<h4 id="gcç±»å‹">GCç±»å‹</h4>
<p>1.kGcCauseForAllocï¼šåœ¨åˆ†é…å†…å­˜æ—¶å†…å­˜ä¸å¤Ÿæƒ…å†µä¸‹å¼•èµ·çš„GC,è¿™ç§æƒ…å†µä¸‹GCä¼šstop Worldã€‚Stop World æ˜¯ç”±äºå¹¶å‘GCæ—¶ï¼Œå…¶ä»–çº¿ç¨‹éƒ½ä¼šåœæ­¢ã€‚</p>
<p>2.kGcCauseBackgroundï¼šå½“å†…å­˜è¾¾åˆ°ä¸€å®šé˜ˆå€¼çš„æ—¶å€™å¼•å‘GCï¼Œè¿™ä¸ªæ—¶å€™æ˜¯ä¸€ä¸ªåå°GC,ä¸ä¼šå¼•èµ·Stop Worldã€‚</p>
<p>3.kGcCauseExplicitï¼šæ˜¾ç¤ºè°ƒç”¨æ—¶è¿›è¡Œçš„GCï¼Œå¦‚æœARTæ‰“å¼€äº†è¿™ä¸ªé€‰é¡¹ï¼Œåœ¨system.gcæ—¶ä¼šè¿›è¡ŒGCã€‚</p>
<h4 id="å…¶ä»–gcæ³¨æ„äº‹é¡¹">å…¶ä»–GCæ³¨æ„äº‹é¡¹</h4>
<p>1.å°½é‡ä¸å»æ˜¾å¼è°ƒç”¨ system.gc() å‡å°‘ä¸å¿…è¦çš„ç³»ç»Ÿå¼€é”€ï¼Œå½±å“åº”ç”¨çš„æµç•…åº¦ã€‚</p>
<p>2.å°½é‡å‡å°‘å†…å­˜æ³„éœ²ï¼Œé¿å…OOMã€‚</p>
<h2 id="äºŒ-androidå†…å­˜æ³„éœ²">äºŒã€Androidå†…å­˜æ³„éœ²</h2>
<h3 id="1-ä»€ä¹ˆæ˜¯å†…å­˜æ³„éœ²">1ã€ä»€ä¹ˆæ˜¯å†…å­˜æ³„éœ²ï¼Ÿ</h3>
<p>javaå¯¹è±¡æœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸï¼Œå½“è¿™ä¸ªå¯¹è±¡ä¸éœ€è¦å†ä½¿ç”¨æ—¶ï¼Œåº”è¯¥å®Œæ•´åœ°èµ°å®Œç”Ÿå‘½å‘¨æœŸï¼Œä½†å› ä¸ºæŸäº›åŸå› ï¼Œå¯¹è±¡è™½ç„¶å·²ç»ä¸å†ä½¿ç”¨ï¼Œä»ç„¶åœ¨å†…å­˜ä¸­å¹¶æ²¡æœ‰ç»“æŸæ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œè¿™å°±æ„å‘³ç€è¿™ä¸ªå¯¹è±¡å·²ç»æ³„éœ²äº†ã€‚</p>
<p>GCä¼šé€‰æ‹©ä¸€äº›è¿˜å­˜æ´»çš„å¯¹è±¡ä½œä¸ºå†…å­˜éå†çš„æ ¹èŠ‚ç‚¹ GC Roots,é€šè¿‡å¯¹GC Rootsçš„å¯è¾¾æ€§æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦å›æ”¶ã€‚<br>
<img src="http://upload-images.jianshu.io/upload_images/1980287-8efb0dcbc6134876.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>Androidç³»ç»Ÿè™šæ‹Ÿæœºçš„åƒåœ¾å›æ”¶æ˜¯é€šè¿‡è™šæ‹ŸæœºGCæœºåˆ¶æ¥å®ç°çš„ã€‚GCä¼šé€‰æ‹©ä¸€äº›å­˜æ´»çš„å¯¹è±¡ä½œä¸ºå†…å­˜ä¾¿åˆ©çš„è·ŸèŠ‚ç‚¹GC Roots,é€šè¿‡åˆ¤æ–­GC Rootsçš„å¯è¾¾æ€§æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦å›æ”¶ï¼Œå¦‚ä¸Šå›¾å…¶ä¸­ 1 2 3 4ç›´æ¥æˆ–é—´æ¥è¢«GC Rootså¼•ç”¨é“¾ç›¸è¿ï¼Œè¿™ç±»å¯¹è±¡è¢«è®¤ä¸ºè¿˜éœ€è¦ä½¿ç”¨çš„å¯¹è±¡ï¼Œå°±ä¸ä¼šè¢«å›æ”¶ã€‚5 6 7å°†ä¼šè¢«å›æ”¶ã€‚åˆ°é‚£æ—¶è¿™é‡Œå¦‚æœObject4 å¦‚æœä¸éœ€è¦ä½¿ç”¨çš„è¯è¿™æ—¶å€™ä¹Ÿä¸ä¼šè¢«å›æ”¶ï¼Œå°±å±äºå†…å­˜æ³„éœ²ã€‚</p>
<h3 id="2-å¸¸è§å†…å­˜æ³„éœ²åœºæ™¯ä»¥åŠæ³¨æ„äº‹é¡¹">2ã€å¸¸è§å†…å­˜æ³„éœ²åœºæ™¯ä»¥åŠæ³¨æ„äº‹é¡¹</h3>
<p>~ èµ„æºå‹å¯¹è±¡æœªå…³é—­<br>
~ æ³¨å†Œå¯¹è±¡æœªæ³¨é”€<br>
~ ç±»çš„é™æ€å˜é‡æŒæœ‰å¤§æ•°æ®å¯¹è±¡ å¦‚bitmap<br>
~ è´¹é™æ€å†…éƒ¨ç±»çš„é™æ€å®ä¾‹<br>
~ Handlerä¸´æ—¶æ€§å†…å­˜æ³„éœ²<br>
~ å®¹å™¨ä¸­çš„å¯¹è±¡æ²¡æœ‰æ¸…ç†é€ æˆçš„å†…å­˜æ³„éœ²</p>
<h3 id="3-å†…å­˜æ³„éœ²åˆ†æå·¥å…·">3ã€å†…å­˜æ³„éœ²åˆ†æå·¥å…·</h3>
<h4 id="leakcanary">leakcanary</h4>
<h2 id="ä¸‰-å¸¸è§æ³¨æ„äº‹é¡¹é¿å…å†…å­˜æ¶ˆè€—è¿‡å¤š">ä¸‰ã€å¸¸è§æ³¨æ„äº‹é¡¹é¿å…å†…å­˜æ¶ˆè€—è¿‡å¤š</h2>
<h3 id="1-autoboxingè‡ªåŠ¨è£…ç®±è¿‡ç¨‹">1ã€AutoBoxingè‡ªåŠ¨è£…ç®±è¿‡ç¨‹</h3>
<pre><code> Integer num=0;   
 for(int i=0;i&lt;100;i++){
     num+=i;
â€‹â€‹}â€‹â€‹
</code></pre>
<p>è¿™æ®µä»£ç æ¯æ¬¡å¾ªç¯ï¼Œè™šæ‹Ÿæœºéƒ½å¿…é¡»åˆ›å»ºä¸€ä¸ªæ–°çš„æ•´æ•°å¯¹è±¡ï¼Œå¹¶æŠŠå®ƒåŠ åˆ°å…¶ä»–æ•´æ•°å¯¹è±¡å‰é¢ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„æ•´æ•°å¯¹è±¡ï¼Œæ„å‘³ç€è¦æ¶ˆè€—æ›´å¤šæ€§èƒ½ã€‚intåªæœ‰4å­—èŠ‚ï¼Œè€ŒIntegerå¯¹è±¡æœ‰16å­—èŠ‚ã€‚</p>
<h3 id="2-å†…å®¹å¤ç”¨">2ã€å†…å®¹å¤ç”¨</h3>
<p>1ã€æœ‰æ•ˆåˆ©ç”¨ç³»ç»Ÿè‡ªå¸¦èµ„æºã€‚<br>
2ã€è§†å›¾å¤ç”¨ï¼Œå¦‚ViewHolderã€‚<br>
3ã€å¯¹è±¡æ± ã€‚<br>
4ã€Bitmapå¯¹è±¡å¤ç”¨ã€‚</p>
<h3 id="3-ä½¿ç”¨æœ€ä¼˜çš„æ•°æ®ç±»å‹">3ã€ä½¿ç”¨æœ€ä¼˜çš„æ•°æ®ç±»å‹</h3>
<p>1ã€å½“å¯¹è±¡çš„æ•°ç›®åœ¨1000ä»¥å†…ä¸”ç‰¹åˆ«å¤šè®¿é—®è€Œåˆ é™¤å’Œæ’å…¥ä¸é«˜çš„æ—¶å€™å°½é‡ç”¨ArrayMapæ›¿ä»£HashMapã€‚<br>
2ã€æšä¸¾çš„æœ€å¤§ä¼˜ç‚¹æ˜¯å®‰å…¨ã€æ˜“è¯»ï¼Œä½†æ˜¯å†…å­˜æ¶ˆè€—æ˜¯å®šä¹‰å¸¸é‡çš„ä¸‰å€ä»¥ä¸Šã€‚å¯ä»¥ä½¿ç”¨æ³¨è§£æ–¹å¼æ¥æ£€æŸ¥å®‰å…¨ã€‚<br>
3ã€ä½¿ç”¨IntDefå’ŒStringDefæ£€æŸ¥ç±»å‹å®‰å…¨ã€‚<br>
4ã€LruCacheå»ºè®®ä½¿ç”¨è¿™ä¸ªç¼“å­˜æœºåˆ¶ï¼Œä½†æ˜¯æ—¢ä¸èƒ½åˆ†é…å¤ªå¤§ï¼Œä¹Ÿä¸èƒ½åˆ†é…å¤ªå°ã€‚</p>
<h3 id="4-å›¾ç‰‡çš„å†…å­˜ä¼˜åŒ–">4ã€å›¾ç‰‡çš„å†…å­˜ä¼˜åŒ–</h3>
<p>è®¾ç½®ä½å›¾è§„æ ¼ï¼Œä½¿ç”¨inSampleSizeå®ç°ä½å›¾ç¼©æ”¾å’Œå‹ç¼©ã€‚ä½¿ç”¨ç¼“å­˜æœºåˆ¶ç­‰ã€‚</p>
<h2 id="å››-å†…å­˜åˆ†æå·¥å…·">å››ã€å†…å­˜åˆ†æå·¥å…·</h2>
<h3 id="1-memory-monitor">1ã€Memory Monitor</h3>
<p>è¿™ä¸ªæ˜¯ä¸€ä¸ªæˆ‘ä»¬å¼€å‘è¿‡ç¨‹ä¸­å¾ˆå¸¸ç”¨çš„å†…å­˜ã€CPUã€ç½‘ç»œçš„åˆ†æå·¥å…·ã€‚<br>
<img src="http://upload-images.jianshu.io/upload_images/1980287-b2d61b505b13594b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Memory Monitorç•Œé¢è§†å›¾"><br>
ç•Œé¢å¾ˆç›´è§‚ï¼Œå·¦ä¸Šè§’æœ‰è¿è¡Œçš„æœºå‹å’Œé¡¹ç›®åŒ…åï¼Œç„¶åæœ€ç›´è§‚çš„åŠ¨æ€å›¾ï¼Œåˆ†åˆ«æ˜¯CPUã€Memoryã€NetWorkã€‚ç‚¹è¿›å»å¯ä»¥è¿›å…¥çš„Memoryã€‚<br>
<img src="http://upload-images.jianshu.io/upload_images/1980287-a3955ca0cdf72b93.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Memory Monitorçš„Memoryå±€éƒ¨è§†å›¾"><br>
è¿™é‡Œå¯ä»¥æ¸…æ™°çš„çœ‹åˆ°é¢œè‰²å¯¹åº”åŒºåŸŸå ç”¨çš„å†…å­˜å¤§å°ã€‚<br>
<img src="http://upload-images.jianshu.io/upload_images/1980287-8be4a25bacfbb6eb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Memory Monitorçš„Memoryæ•´ä½“è§†å›¾"><br>
é€šè¿‡è¿™ä¸¤å¼ å›¾ å†…å­˜çš„å¤§éƒ¨åˆ†ä¿¡æ¯éƒ½èƒ½æŸ¥é˜…åˆ°ã€‚æˆ‘ä»¬åœ¨æ“ä½œAPPåŠ è½½å›¾ç‰‡ç­‰æ“ä½œæ—¶å€™èƒ½çœ‹åˆ°å†…å­˜ä¸Šå‡ã€å’Œä¸‹é™ï¼Œå¦‚æœæ“ä½œAPPåå‘ç°å†…å­˜ä¸ä¼šä¸‹é™å¯èƒ½å°±æ˜¯æˆ‘ä»¬æœ‰äº›å¯¹è±¡æ²¡æœ‰åŠæ—¶é‡Šæ”¾ï¼Œä¹Ÿæœ‰å¯èƒ½å¯¼è‡´å†…å­˜æ³„éœ²ã€‚<br>
è¿˜æœ‰å¯¹åº”çš„æ¨¡æ‹ŸGCï¼ŒæŸ¥çœ‹æ—¶é—´æ®µå…·ä½“å†…å­˜ä¿¡æ¯ä»¥åŠä¸€æ®µæ—¶é—´çš„å†…å­˜è¿½è¸ªç­‰å·¥å…·å¯ä»¥ä½¿ç”¨ã€‚å¯ä»¥å®šä½åˆ°å…·ä½“çš„ä»£ç è¡Œã€‚å¦‚ä¸‹å›¾ï¼š<br>
<img src="http://upload-images.jianshu.io/upload_images/1980287-4d3438bf2d4f6b55.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å…·ä½“ç±»è¯¦ç»†å†…å­˜ä¿¡æ¯å±•ç¤º"><br>
è¿™é‡Œæœ‰ä¸€ä¸ªShallow sizeè¿™ä¸ªå±æ€§çš„æ¦‚å¿µï¼š<br>
Shallow sizeå°±æ˜¯å¯¹è±¡æœ¬èº«å ç”¨å†…å­˜çš„å¤§å°ï¼Œä¸åŒ…å«å…¶å¼•ç”¨çš„å¯¹è±¡ã€‚å¸¸è§„å¯¹è±¡ï¼ˆéæ•°ç»„ï¼‰çš„Shallow sizeæœ‰å…¶æˆå‘˜å˜é‡çš„æ•°é‡å’Œç±»å‹å†³å®šã€‚æ•°ç»„çš„shallow sizeæœ‰æ•°ç»„å…ƒç´ çš„ç±»å‹ï¼ˆå¯¹è±¡ç±»å‹ã€åŸºæœ¬ç±»å‹ï¼‰å’Œæ•°ç»„é•¿åº¦å†³å®šã€‚</p>
<h3 id="2-heap-viewrer">2ã€Heap Viewrer</h3>
<p><img src="http://upload-images.jianshu.io/upload_images/1980287-2141af984975a2a8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Heap Viewrerå·¥å…·è§†å›¾ç•Œé¢"><br>
å¦‚æœæ˜¯Android Studioçš„è¯é€šè¿‡Tools-&gt;Android-&gt;Android Device Monitoræ‰¾åˆ°è¿™ä¸ªå·¥å…·ã€‚<br>
è¿›å…¥åé€‰æ‹©è¿è¡ŒAPPçš„åŒ…åç„¶åç‚¹å‡»update HeapæŒ‰é’®ï¼Œè¿™æ—¶å€™ä¼šåœ¨æ¯æ¬¡gcæ—¶å±•ç¤ºæ•°æ®ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥åœ¨åé¢æ‰‹åŠ¨GCï¼Œå¦‚æœåœ¨æ“ä½œé¡µé¢è¿™æ—¶å€™å¯èƒ½ä¼šå‘ç°å°å¡é¡¿ï¼Œå› ä¸ºåœ¨GCæ—¶ï¼Œå¯èƒ½å¯¼è‡´å…¶ä»–çº¿ç¨‹åœæ­¢å·¥ä½œï¼Œè¿™æ—¶å¯ä»¥æ¸…æ™°çœ‹åˆ°è¡¨ä¸­å†…å­˜ä¿¡æ¯ï¼š<br>
å¤´éƒ¨æ€»è§ˆè§†å›¾ï¼š</p>
<table>
<thead>
<tr>
<th>æ ‡é¢˜</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>Heap Size</td>
<td>å †æ ˆåˆ†é…ç»™APPçš„å†…å­˜å¤§å°ã€‚</td>
</tr>
<tr>
<td>Allocated</td>
<td>å·²åˆ†é…ä½¿ç”¨çš„å†…å­˜å¤§å°ã€‚</td>
</tr>
<tr>
<td>Free</td>
<td>ç©ºé—²çš„å†…å­˜å¤§å°ã€‚</td>
</tr>
<tr>
<td>%Used</td>
<td>Allocated/Heap Size çš„ä½¿ç”¨ç‡ã€‚</td>
</tr>
<tr>
<td>#Object</td>
<td>å¯¹è±¡æ•°é‡</td>
</tr>
</tbody>
</table>
<p>ä¸‹é¢è¯¦æƒ…è§†å›¾ï¼š</p>
<table>
<thead>
<tr>
<th>æ ‡é¢˜</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>free</td>
<td>ç©ºé—²çš„å¯¹è±¡</td>
</tr>
<tr>
<td>data object</td>
<td>æ•°æ®å¯¹è±¡ï¼ŒJavaç±»ç±»å‹å¯¹è±¡ï¼Œæ˜¯æœ€ä¸»è¦çš„è§‚å¯Ÿå¯¹è±¡ã€‚</td>
</tr>
<tr>
<td>class object</td>
<td>javaç±»ç±»å‹çš„å¼•ç”¨å¯¹è±¡ã€‚</td>
</tr>
<tr>
<td>1-byte array(byte[],boolean[])</td>
<td>ä¸€å­—èŠ‚çš„æ•°ç»„å¯¹è±¡ã€‚</td>
</tr>
<tr>
<td>2-byte array(short[],char[])</td>
<td>ä¸¤å­—èŠ‚çš„æ•°ç»„å¯¹è±¡ã€‚</td>
</tr>
<tr>
<td>4-byte array(object[],int[],float[])</td>
<td>4å­—èŠ‚çš„æ•°ç»„å¯¹è±¡ã€‚</td>
</tr>
<tr>
<td>8-byte array(long[],double[])</td>
<td>8å­—èŠ‚çš„æ•°ç»„å¯¹è±¡ã€‚</td>
</tr>
<tr>
<td>non-java object</td>
<td>éJavaå¯¹è±¡ã€‚</td>
</tr>
</tbody>
</table>
<p>æ¯ä¸ªç±»å‹çš„æ•°æ®å€¼å¯¹åº”ï¼š</p>
<table>
<thead>
<tr>
<th>æ ‡é¢˜</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>Count</td>
<td>æ•°é‡</td>
</tr>
<tr>
<td>Total Size</td>
<td>æ€»å…±å ç”¨çš„å†…å­˜çš„å¤§å°</td>
</tr>
<tr>
<td>Smallest</td>
<td>å°†å¯¹è±¡å ç”¨å†…å­˜ä»å°åˆ°å¤§æ’åˆ—ï¼Œæ’åœ¨ç¬¬ä¸€ä¸ªå¯¹è±¡å ç”¨å†…å­˜å¤§å°</td>
</tr>
<tr>
<td>Largest</td>
<td>å°†å¯¹è±¡å ç”¨å†…å­˜ä»å°åˆ°å¤§æ’åˆ—ï¼Œæ’åœ¨æœ€åä¸€ä¸ªå¯¹è±¡å ç”¨çš„å†…å­˜å¤§å°ã€‚</td>
</tr>
<tr>
<td>Median</td>
<td>å°†å¯¹è±¡å ç”¨å†…å­˜ä»å°åˆ°å¤§æ’åˆ—ï¼Œæ’åœ¨æ€»ç›‘çš„å¯¹è±¡å ç”¨çš„å†…å­˜å¤§å°ã€‚</td>
</tr>
<tr>
<td>Average</td>
<td>å¹³å‡å€¼</td>
</tr>
</tbody>
</table>
]]></content>
    </entry>
</feed>